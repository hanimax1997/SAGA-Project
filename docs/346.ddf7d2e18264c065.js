"use strict";(self.webpackChunkcoreSystem=self.webpackChunkcoreSystem||[]).push([[346],{9346:(kr,F,A)=>{A.r(F),A.d(F,{AppDateAdapter:()=>le,GestionAvenantVieModule:()=>Rr});var y=A(6895),D=A(3238),ue=A(4479),G=A(3567),S=A(2510),V=A(9523),T=A(5861),u=A(4006),P=A(7155),$=A(4128),ce=A(5017),me=A(5226),R=A.n(me),x=A(5439),C=A(2644),b=A(7340),w=A(8739),pe=A(6666),de=A(7843),_e=A(8692),fe=A(6274),e=A(4650),ve=A(5617),ge=A(3388),he=A(2473),Ce=A(7009),k=A(5412),Ae=A(8153),Pe=A(8056),qe=A(6944),xe=A(6127),O=A(5210),U=A(7179),z=A(852),K=A(1351),be=A(6436),W=A(3776),E=A(4850),J=A(7392),I=A(7084),L=A(8255),N=A(9549),X=A(284),Q=A(266),j=A(9602),ee=A(4385),B=A(4859),Y=A(6257),Re=A(6709),te=A(1572),ie=A(2768);const Se=["stepper"],Te=["fileInput"];function ye(i,s){1&i&&e._uU(0,"Informations contrat ")}function ke(i,s){1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2,"N\xb0 Attestation"),e.qZA(),e._UZ(3,"input",31),e.qZA())}function Ze(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.hij(" ",null==t||null==t.idMotif?null:t.idMotif.description," ")}}function Le(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2,"Motifs"),e.qZA(),e.TgZ(3,"mat-select",32),e.YNc(4,Ze,3,2,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(4),e.Q6J("ngForOf",t.avenant.motifs)}}function Ie(i,s){1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2,"Commentaire"),e.qZA(),e._UZ(3,"input",34),e.qZA())}function Ne(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2,"Date avenant"),e.qZA(),e._UZ(3,"input",35)(4,"mat-datepicker-toggle",36)(5,"mat-datepicker",null,37),e.qZA()),2&i){const t=e.MAs(6);e.xp6(3),e.Q6J("matDatepicker",t),e.xp6(1),e.Q6J("for",t)}}function Me(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.hij(" ",t.description," ")}}function we(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"mat-select",38),e.YNc(4,Me,3,2,"ng-container",14),e.qZA()()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.idAtrribut.attribut),e.xp6(1),e.s9C("formControlName",t.idAtrribut.nomBdd),e.xp6(1),e.Q6J("ngForOf",t.idAtrribut.reponses)}}function Ve(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",39),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.idAtrribut.attribut),e.xp6(1),e.s9C("formControlName",t.idAtrribut.nomBdd)}}function Oe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",27)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"input",40),e.NdJ("dateChange",function(){e.CHM(t);const o=e.oxw(4);let l;return e.KtG(o.getDateExpiration(null==(l=o.formApplicationAvenant.get("duree"))?null:l.value))}),e.qZA(),e._UZ(4,"mat-datepicker-toggle",36)(5,"mat-datepicker",null,41),e.qZA()}if(2&i){const t=e.MAs(6),n=e.oxw().$implicit,o=e.oxw(3);let l;e.xp6(2),e.Oqu(n.idAtrribut.attribut),e.xp6(1),e.s9C("formControlName",n.idAtrribut.nomBdd),e.Q6J("matDatepicker",t)("min","dateEffet"==n.idAtrribut.nomBdd?null==(l=o.formApplicationAvenant.get("dateEffet"))?null:l.value:""),e.xp6(1),e.Q6J("for",t)}}function Ye(i,s){if(1&i&&(e.ynx(0),e.YNc(1,we,5,3,"mat-form-field",24),e.YNc(2,Ve,4,2,"mat-form-field",24),e.YNc(3,Oe,7,5,"mat-form-field",24),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf","Liste of values"==(null==t.idAtrribut.type?null:t.idAtrribut.type.description)),e.xp6(1),e.Q6J("ngIf","String"==(null==t.idAtrribut.type?null:t.idAtrribut.type.description)||"Number"==(null==t.idAtrribut.type?null:t.idAtrribut.type.description)),e.xp6(1),e.Q6J("ngIf","date"==(null==t.idAtrribut.type?null:t.idAtrribut.type.description))}}function De(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.idAgence),e.xp6(1),e.hij(" ",t.nomAgence," ")}}function Ue(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",42),e.NdJ("mouseup",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.redirectConsultation())}),e._uU(2,"Annuler"),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.getAllPackByProduit(1))}),e._uU(4," Suivant "),e.qZA()()}}function Ee(i,s){1&i&&e._UZ(0,"mat-spinner",43)}function Je(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Suivant "),e.qZA())}function Qe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",42),e.NdJ("mouseup",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.redirectConsultation())}),e._uU(2,"Annuler"),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.calculPrime())}),e.YNc(4,Ee,1,0,"mat-spinner",18),e.YNc(5,Je,2,0,"span",19),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(4),e.Q6J("ngIf",t.loaderCalcul),e.xp6(1),e.Q6J("ngIf",!t.loaderCalcul)}}function Ge(i,s){if(1&i&&(e.TgZ(0,"mat-step",20),e.YNc(1,ye,1,0,"ng-template",9),e.TgZ(2,"mat-accordion",10)(3,"form",21,22)(5,"div",23),e.YNc(6,ke,4,0,"mat-form-field",24),e.YNc(7,Le,5,1,"mat-form-field",24),e.YNc(8,Ie,4,0,"mat-form-field",24),e.YNc(9,Ne,7,2,"mat-form-field",24),e.qZA(),e.TgZ(10,"mat-expansion-panel",25)(11,"mat-expansion-panel-header")(12,"mat-panel-title"),e._uU(13," Informations contrat "),e.qZA()(),e.TgZ(14,"div",26),e.YNc(15,Ye,4,3,"ng-container",14),e.TgZ(16,"mat-form-field",27)(17,"mat-label"),e._uU(18,"Agence"),e.qZA(),e.TgZ(19,"mat-select",28),e.YNc(20,De,3,2,"ng-container",14),e.qZA()()()()(),e.YNc(21,Ue,5,0,"div",29),e.YNc(22,Qe,6,2,"ng-template",null,30,e.W1O),e.qZA()()),2&i){const t=e.MAs(23),n=e.oxw(2);e.Q6J("stepControl",n.formApplicationAvenant)("editable",!0),e.xp6(3),e.Q6J("formGroup",n.formApplicationAvenant),e.xp6(3),e.Q6J("ngIf",null==n.avenant?null:n.avenant.attestation),e.xp6(1),e.Q6J("ngIf",0!=(null==n.avenant||null==n.avenant.motifs?null:n.avenant.motifs.length)),e.xp6(1),e.Q6J("ngIf","Autre"==(null==n.formApplicationAvenant.value||null==n.formApplicationAvenant.value.motif||null==n.formApplicationAvenant.value.motif.idMotif?null:n.formApplicationAvenant.value.motif.idMotif.description)),e.xp6(1),e.Q6J("ngIf","A01"!=(null==n.avenant?null:n.avenant.code)&&"A03"!=(null==n.avenant?null:n.avenant.code)&&"A04"!=(null==n.avenant?null:n.avenant.code)),e.xp6(1),e.Q6J("expanded",!0),e.xp6(5),e.Q6J("ngForOf",n.avenant.attributs),e.xp6(5),e.Q6J("ngForOf",n.agences),e.xp6(1),e.Q6J("ngIf",0!=(null==n.avenant||null==n.avenant.paramRisque?null:n.avenant.paramRisque.length)||(null==n.avenant?null:n.avenant.packAffecte)||(null==n.avenant?null:n.avenant.garantieAffecte))("ngIfElse",t)}}function je(i,s){1&i&&e._uU(0,"Consultation des risques ")}function Be(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," N\xb0.Risque "),e.qZA())}function He(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.idRisque," ")}}function Fe(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Risque "),e.qZA())}function $e(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function ze(i,s){1&i&&e._UZ(0,"tr",55)}function Ke(i,s){1&i&&e._UZ(0,"tr",56)}const ne=function(){return[5,10]};function We(i,s){if(1&i&&(e.TgZ(0,"mat-step",8),e.YNc(1,je,1,0,"ng-template",9),e.TgZ(2,"div")(3,"table",44),e.ynx(4,45),e.YNc(5,Be,2,0,"th",46),e.YNc(6,He,2,1,"td",47),e.BQk(),e.ynx(7,48),e.YNc(8,Fe,2,0,"th",46),e.YNc(9,$e,2,1,"td",47),e.BQk(),e.YNc(10,ze,1,0,"tr",49),e.YNc(11,Ke,1,0,"tr",50),e.qZA(),e._UZ(12,"mat-paginator",51),e.TgZ(13,"div",15)(14,"button",16),e._uU(15," Retour"),e.qZA(),e.TgZ(16,"button",52),e._uU(17," Suivant"),e.qZA()()()()),2&i){const t=e.oxw(2);e.Q6J("editable",!0),e.xp6(3),e.Q6J("dataSource",t.dataSourceConsultRisque),e.xp6(7),e.Q6J("matHeaderRowDef",t.displayedColumnsRisque),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsRisque),e.xp6(1),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(6,ne))}}function Xe(i,s){1&i&&e._uU(0,"Informations risque ")}function et(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," N\xb0.Risque "),e.qZA())}function tt(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.idRisque," ")}}function it(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Risque "),e.qZA())}function nt(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function ot(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Action "),e.qZA())}function at(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",54)(1,"button",60)(2,"mat-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",61,62)(6,"button",63),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(4);return e.KtG(a.editRisque(l.idRisque,l.description))}),e.TgZ(7,"mat-icon"),e._uU(8,"source_notes"),e.qZA(),e.TgZ(9,"span"),e._uU(10,"Modifier information "),e.qZA()()()()}if(2&i){const t=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",t)}}function rt(i,s){1&i&&e._UZ(0,"tr",55)}function st(i,s){1&i&&e._UZ(0,"tr",56)}function lt(i,s){if(1&i&&(e.TgZ(0,"div")(1,"table",44),e.ynx(2,45),e.YNc(3,et,2,0,"th",46),e.YNc(4,tt,2,1,"td",47),e.BQk(),e.ynx(5,48),e.YNc(6,it,2,0,"th",46),e.YNc(7,nt,2,1,"td",47),e.BQk(),e.ynx(8,59),e.YNc(9,ot,2,0,"th",46),e.YNc(10,at,11,1,"td",47),e.BQk(),e.YNc(11,rt,1,0,"tr",49),e.YNc(12,st,1,0,"tr",50),e.qZA(),e._UZ(13,"mat-paginator",51),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("dataSource",t.dataSourceParamRisque),e.xp6(10),e.Q6J("matHeaderRowDef",t.displayedColumnsParamRisque),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsParamRisque),e.xp6(1),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(5,ne))}}function ut(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"p",64),e._uU(2,"choisissez la m\xe9thode qui vous convient le mieux pour g\xe9rer les risques : importez un fichier Excel ou remplissez notre formulaire en ligne."),e.qZA(),e.TgZ(3,"div",65)(4,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.formStep=2)}),e.TgZ(5,"span",66),e._uU(6," ios_share "),e.qZA(),e._uU(7," Importer mod\xe9le"),e.qZA(),e.TgZ(8,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.formStep=1)}),e.TgZ(9,"span",66),e._uU(10," edit_note "),e.qZA(),e._uU(11," Formulaire"),e.qZA()(),e.TgZ(12,"button",16),e._uU(13,"Retour"),e.qZA()()}}function ct(i,s){1&i&&(e.TgZ(0,"div",74),e._uU(1," Risque modifi\xe9."),e.qZA())}function mt(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.idParam),e.xp6(1),e.hij(" ",t.description," ")}}function pt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function dt(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function _t(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"mat-select",81),e.NdJ("selectionChange",function(o){e.CHM(t);const l=e.oxw().$implicit,a=e.oxw(6);return e.KtG(a.getRelation(null==l.paramRisque||null==l.paramRisque.typeChamp?null:l.paramRisque.typeChamp.description,l.paramRisque.isParent,l.paramRisque.idParamRisque,o.value))}),e.YNc(4,mt,3,2,"ng-container",14),e.qZA(),e.YNc(5,pt,2,0,"mat-error",82),e.YNc(6,dt,2,1,"mat-error",82),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw(6);let o,l;e.xp6(2),e.Oqu(t.paramRisque.libelle),e.xp6(1),e.s9C("formControlName",t.paramRisque.codeParam),e.xp6(1),e.Q6J("ngForOf",t.paramRisque.categorie.paramDictionnaires),e.xp6(1),e.Q6J("ngIf",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.required),e.xp6(1),e.Q6J("ngIf",null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.bloquant)}}function ft(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function vt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs n'est pas conforme "),e.qZA())}function gt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," La baisse du capital n'est pas permise "),e.qZA())}function ht(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function Ct(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",84),e.YNc(4,ft,2,0,"mat-error",82),e.YNc(5,vt,2,0,"mat-error",82),e.YNc(6,gt,2,0,"mat-error",82),e.YNc(7,ht,2,1,"mat-error",82),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(6);let o,l,a,r;e.xp6(2),e.Oqu(t.paramRisque.libelle),e.xp6(1),e.s9C("formControlName",t.paramRisque.codeParam),e.Q6J("type","L02"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)||"L07"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)?"text":"number"),e.xp6(1),e.Q6J("ngIf",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.required),e.xp6(1),e.Q6J("ngIf",(null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.pattern)||(null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.maxlength)||(null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.minlength)),e.xp6(1),e.Q6J("ngIf",null==(a=n.formParamRisque.get(t.paramRisque.codeParam))||null==a.errors?null:a.errors.min),e.xp6(1),e.Q6J("ngIf",null==(r=n.formParamRisque.get(t.paramRisque.codeParam))||null==r.errors?null:r.errors.bloquant)}}function At(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function Pt(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function qt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"input",85),e.NdJ("dateChange",function(o){e.CHM(t);const l=e.oxw(7);return e.KtG(l.onChangeDateDepart(o))}),e.qZA(),e._UZ(4,"mat-datepicker-toggle",36)(5,"mat-datepicker",null,86),e.YNc(7,At,2,0,"mat-error",82),e.YNc(8,Pt,2,1,"mat-error",82),e.qZA()}if(2&i){const t=e.MAs(6),n=e.oxw().$implicit,o=e.oxw(6);let l,a;e.xp6(2),e.Oqu(n.paramRisque.libelle),e.xp6(1),e.s9C("formControlName",n.paramRisque.codeParam),e.Q6J("matDatepicker",t)("min","P211"===n.paramRisque.codeParam?o.minDateDepart:"")("max","P211"===n.paramRisque.codeParam?o.maxDateDepart:""),e.xp6(1),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",null==(l=o.formParamRisque.get(n.paramRisque.codeParam))||null==l.errors?null:l.errors.required),e.xp6(1),e.Q6J("ngIf",null==(a=o.formParamRisque.get(n.paramRisque.codeParam))||null==a.errors?null:a.errors.bloquant)}}function xt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function bt(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function Rt(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e._UZ(3,"input",87)(4,"mat-datepicker-toggle",36)(5,"mat-datepicker",null,86),e.YNc(7,xt,2,0,"mat-error",82),e.YNc(8,bt,2,1,"mat-error",82),e.qZA()),2&i){const t=e.MAs(6),n=e.oxw().$implicit,o=e.oxw(6);let l,a;e.xp6(2),e.Oqu(n.paramRisque.libelle),e.xp6(1),e.s9C("formControlName",n.paramRisque.codeParam),e.Q6J("matDatepicker",t)("min","P212"===n.paramRisque.codeParam?o.minDateRetour:""),e.xp6(1),e.Q6J("for",t),e.xp6(3),e.Q6J("ngIf",null==(l=o.formParamRisque.get(n.paramRisque.codeParam))||null==l.errors?null:l.errors.required),e.xp6(1),e.Q6J("ngIf",null==(a=o.formParamRisque.get(n.paramRisque.codeParam))||null==a.errors?null:a.errors.bloquant)}}function St(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function Tt(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function yt(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"mat-select",38)(4,"mat-option",33),e._uU(5,"Oui "),e.qZA(),e.TgZ(6,"mat-option",33),e._uU(7,"Non "),e.qZA()(),e.YNc(8,St,2,0,"mat-error",82),e.YNc(9,Tt,2,1,"mat-error",82),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(6);let o,l;e.xp6(2),e.hij("",t.paramRisque.libelle," "),e.xp6(1),e.s9C("formControlName",t.paramRisque.codeParam),e.xp6(1),e.Q6J("value",!0),e.xp6(2),e.Q6J("value",!1),e.xp6(2),e.Q6J("ngIf",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.required),e.xp6(1),e.Q6J("ngIf",null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.bloquant)}}function kt(i,s){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2).$implicit;e.Q6J("value","P182"===n.paramRisque.codeParam?""+t.idPays:""+t.id),e.xp6(1),e.hij(" ",t.description," ")}}function Zt(i,s){if(1&i&&(e.ynx(0),e.YNc(1,kt,2,2,"mat-option",88),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf","DZA"!==t.codePays)}}function Lt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function It(i,s){if(1&i&&(e.TgZ(0,"mat-error",83),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(6);let o;e.xp6(1),e.hij(" ",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.msg," ")}}function Nt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2),e.qZA(),e.TgZ(3,"mat-select",81),e.NdJ("selectionChange",function(o){e.CHM(t);const l=e.oxw().$implicit,a=e.oxw(6);return e.KtG(a.getRelation(null==l.paramRisque||null==l.paramRisque.typeChamp?null:l.paramRisque.typeChamp.description,l.isParent,l.idParamRisque,o.value.id))}),e.YNc(4,Zt,2,1,"ng-container",14),e.qZA(),e.YNc(5,Lt,2,0,"mat-error",82),e.YNc(6,It,2,1,"mat-error",82),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw(6);let o,l;e.xp6(2),e.hij("",t.paramRisque.libelle," "),e.xp6(1),e.s9C("formControlName",t.paramRisque.codeParam),e.xp6(1),e.Q6J("ngForOf",t.paramRisque.reponses),e.xp6(1),e.Q6J("ngIf",null==(o=n.formParamRisque.get(t.paramRisque.codeParam))||null==o.errors?null:o.errors.required),e.xp6(1),e.Q6J("ngIf",null==(l=n.formParamRisque.get(t.paramRisque.codeParam))||null==l.errors?null:l.errors.bloquant)}}function Mt(i,s){if(1&i&&(e.ynx(0),e.YNc(1,_t,7,5,"mat-form-field",78),e.YNc(2,Ct,8,7,"mat-form-field",78),e.YNc(3,qt,9,8,"mat-form-field",79),e.YNc(4,Rt,9,7,"mat-form-field",79),e.YNc(5,yt,10,6,"mat-form-field",78),e.YNc(6,Nt,7,5,"mat-form-field",78),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf","L01"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)&&"P56"!=t.paramRisque.codeParam&&"P98"!=t.paramRisque.codeParam&&"P25"!=t.paramRisque.codeParam&&"P26"!=t.paramRisque.codeParam),e.xp6(1),e.Q6J("ngIf",("L02"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)||"L03"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)||"L07"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code))&&"P56"!=t.paramRisque.codeParam&&"P98"!=t.paramRisque.codeParam&&"P25"!=t.paramRisque.codeParam&&"P26"!=t.paramRisque.codeParam),e.xp6(1),e.Q6J("ngIf","P211"==t.paramRisque.codeParam&&"L06"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)),e.xp6(1),e.Q6J("ngIf","P55"!=t.paramRisque.codeParam&&"L06"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)&&"P211"!=t.paramRisque.codeParam),e.xp6(1),e.Q6J("ngIf","L04"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code)),e.xp6(1),e.Q6J("ngIf","L08"==(null==t.paramRisque||null==t.paramRisque.typeChamp?null:t.paramRisque.typeChamp.code))}}function wt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(6);return e.KtG(o.editMatricule())}),e._uU(2,"Modifier"),e.qZA()()}}function Vt(i,s){if(1&i&&(e.TgZ(0,"mat-expansion-panel",75)(1,"mat-expansion-panel-header")(2,"mat-panel-title",76),e._uU(3),e.qZA()(),e.TgZ(4,"div",26),e.YNc(5,Mt,7,6,"ng-container",14),e.YNc(6,wt,3,0,"div",77),e.qZA()()),2&i){const t=s.$implicit,n=s.index,o=e.oxw(5);e.Q6J("expanded",!0),e.xp6(3),e.hij(" Informations ",null==t[n]||null==t[n].paramRisque||null==t[n].paramRisque.categorieParamRisque?null:t[n].paramRisque.categorieParamRisque.description," "),e.xp6(2),e.Q6J("ngForOf",t),e.xp6(1),e.Q6J("ngIf",o.risqueSelected)}}function Ot(i,s){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.description,"")}}function Yt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function Dt(i,s){1&i&&(e.TgZ(0,"mat-error",83),e._uU(1," ce champs est obligatoire "),e.qZA())}function Ut(i,s){if(1&i&&(e.TgZ(0,"mat-form-field",80)(1,"mat-label"),e._uU(2,"Nouveau groupe"),e.qZA(),e._UZ(3,"input",94),e.YNc(4,Dt,2,0,"mat-error",82),e.qZA()),2&i){const t=e.oxw(6);let n;e.xp6(4),e.Q6J("ngIf",null==(n=t.formParamRisque.get("newGroupe"))||null==n.errors?null:n.errors.required)}}function Et(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(6);e.xp6(1),e.hij("Pack: ",t.selectedGroup.descriptionPack,"")}}function Jt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-expansion-panel",89)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e._uU(3," Groupe "),e.qZA()(),e.TgZ(4,"div",23)(5,"mat-form-field",90)(6,"mat-label"),e._uU(7,"Groupes"),e.qZA(),e.TgZ(8,"mat-select",91),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(5);return e.KtG(l.selectedGroup=o)}),e.TgZ(9,"mat-option",92),e._uU(10,"Nouveau groupe"),e.qZA(),e.YNc(11,Ot,2,2,"mat-option",93),e.qZA(),e.YNc(12,Yt,2,0,"mat-error",82),e.qZA(),e.YNc(13,Ut,5,1,"mat-form-field",78),e.qZA(),e.YNc(14,Et,2,1,"span",19),e.qZA()}if(2&i){const t=e.oxw(5);let n,o;e.Q6J("expanded",!0),e.xp6(8),e.Q6J("ngModel",t.selectedGroup),e.xp6(3),e.Q6J("ngForOf",t.groupArray),e.xp6(1),e.Q6J("ngIf",null==(n=t.formParamRisque.get("groupe"))||null==n.errors?null:n.errors.required),e.xp6(1),e.Q6J("ngIf","new"==(null==(o=t.formParamRisque.get("groupe"))?null:o.value)),e.xp6(1),e.Q6J("ngIf",null==t.selectedGroup?null:t.selectedGroup.descriptionPack)}}function Qt(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Risque N\xb0 "),e.qZA())}function Gt(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.risqueNum," ")}}function jt(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Immatriculation "),e.qZA())}function Bt(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.P38," ")}}function Ht(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Groupe "),e.qZA())}function Ft(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.groupe," ")}}function $t(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Action"),e.qZA())}function zt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",54)(1,"button",99)(2,"mat-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",100,62)(6,"button",63),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(6);return e.KtG(a.openDialog(l.risqueNum))}),e.TgZ(7,"mat-icon"),e._uU(8,"zoom_in"),e.qZA(),e.TgZ(9,"span"),e._uU(10,"Consulter risque"),e.qZA()(),e.TgZ(11,"button",63),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(6);return e.KtG(a.deleteRisque(l.risqueNum))}),e.TgZ(12,"mat-icon"),e._uU(13,"delete"),e.qZA(),e.TgZ(14,"span"),e._uU(15,"Supprimer risque"),e.qZA()()()()}if(2&i){const t=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",t)}}function Kt(i,s){1&i&&e._UZ(0,"tr",55)}function Wt(i,s){1&i&&e._UZ(0,"tr",56)}function Xt(i,s){if(1&i&&(e.TgZ(0,"table",95),e.ynx(1,96),e.YNc(2,Qt,2,0,"th",46),e.YNc(3,Gt,2,1,"td",47),e.BQk(),e.ynx(4,97),e.YNc(5,jt,2,0,"th",46),e.YNc(6,Bt,2,1,"td",47),e.BQk(),e.ynx(7,98),e.YNc(8,Ht,2,0,"th",46),e.YNc(9,Ft,2,1,"td",47),e.BQk(),e.ynx(10,59),e.YNc(11,$t,2,0,"th",46),e.YNc(12,zt,16,1,"td",47),e.BQk(),e.YNc(13,Kt,1,0,"tr",49),e.YNc(14,Wt,1,0,"tr",50),e.qZA()),2&i){const t=e.oxw(5);e.Q6J("dataSource",t.dataSourceRisque),e.xp6(13),e.Q6J("matHeaderRowDef",t.displayedColumnsRisqueAdd),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsRisqueAdd)}}function ei(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",16),e._uU(2,"Retour"),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(5);return e.KtG(o.changeRisque())}),e._uU(4," Suivant "),e.qZA()()}}function ti(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",16),e._uU(2,"Retour"),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(6);return e.KtG(o.calculPrime())}),e._uU(4,"Suivant "),e.qZA()()}}function ii(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(7);return e.KtG(o.submitRisques())}),e._uU(2,"Ajouter "),e.qZA()()}}function ni(i,s){if(1&i&&e.YNc(0,ii,3,0,"div",77),2&i){const t=e.oxw(6);e.Q6J("ngIf","A23"!=(null==t.avenant?null:t.avenant.code)&&"A24"!=(null==t.avenant?null:t.avenant.code)&&"A25"!=(null==t.avenant?null:t.avenant.code))}}function oi(i,s){if(1&i&&(e.YNc(0,ti,5,0,"div",29),e.YNc(1,ni,1,1,"ng-template",null,101,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(5);e.Q6J("ngIf","A25"!=(null==n.avenant?null:n.avenant.code))("ngIfElse",t)}}function ai(i,s){if(1&i&&(e.TgZ(0,"form",21,22)(2,"div",23),e.YNc(3,ct,2,0,"div",69),e.TgZ(4,"mat-accordion",10),e.YNc(5,Vt,7,4,"mat-expansion-panel",70),e.YNc(6,Jt,15,6,"mat-expansion-panel",71),e.YNc(7,Xt,15,3,"table",72),e.qZA()(),e.YNc(8,ei,5,0,"div",29),e.YNc(9,oi,3,2,"ng-template",null,73,e.W1O),e.qZA()),2&i){const t=e.MAs(10),n=e.oxw(4);e.Q6J("formGroup",n.formParamRisque),e.xp6(3),e.Q6J("ngIf",n.risqueEdited),e.xp6(2),e.Q6J("ngForOf",n.paraRisqueProduitCategory),e.xp6(1),e.Q6J("ngIf",n.multiRisqueProduct&&!n.multiRisqueAvenant),e.xp6(1),e.Q6J("ngIf",n.multiRisqueProduct&&0!=n.dataSourceRisque.data.length),e.xp6(1),e.Q6J("ngIf","A08"!=(null==n.avenant?null:n.avenant.code)&&"A17"!=(null==n.avenant?null:n.avenant.code)&&"A23"!=(null==n.avenant?null:n.avenant.code)&&"A24"!=(null==n.avenant?null:n.avenant.code))("ngIfElse",t)}}function ri(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"button",102),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(4);return e.KtG(o.formStep=0)}),e._uU(2,"Retour"),e.qZA(),e.TgZ(3,"button",103),e._uU(4,"Suivant"),e.qZA()()}}function si(i,s){if(1&i&&(e.TgZ(0,"mat-accordion",10),e.YNc(1,ai,11,7,"form",67),e.YNc(2,ri,5,0,"div",68),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.formRisqueReady),e.xp6(1),e.Q6J("ngIf",t.multiRisqueProduct&&0!=t.dataSourceRisque.data.length)}}function li(i,s){if(1&i&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t," ")}}function ui(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"div",109)(2,"ul",110)(3,"span"),e._uU(4),e.qZA(),e.YNc(5,li,2,1,"li",14),e.qZA()(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(4),e.hij("ligne ",t.ligne," "),e.xp6(1),e.Q6J("ngForOf",t.description)}}function ci(i,s){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,ui,6,2,"ng-container",19),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",0!=t.description.length)}}function mi(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",104)(1,"div",23)(2,"p"),e._uU(3,"Veuillez importer le mod\xe8le."),e.qZA()(),e.TgZ(4,"div",23)(5,"div",105)(6,"button",106),e._uU(7,"T\xe9l\xe9charg\xe9 mod\xe9le"),e.qZA(),e.TgZ(8,"input",107,108),e.NdJ("change",function(o){e.CHM(t);const l=e.oxw(3);return e.KtG(l.onFileSelected(o))}),e.qZA(),e.YNc(10,ci,2,1,"div",14),e.qZA()(),e.TgZ(11,"button",102),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.formStep=0)}),e._uU(12,"Retour"),e.qZA(),e.TgZ(13,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.generateCalcul(),e.KtG(o.loaderTarif=!0)}),e._uU(14,"Suivant"),e.qZA()()}if(2&i){const t=e.oxw(3);e.xp6(10),e.Q6J("ngForOf",t.fileControle)}}function pi(i,s){if(1&i&&(e.TgZ(0,"mat-step",8),e.YNc(1,Xe,1,0,"ng-template",9),e.YNc(2,lt,14,6,"div",19),e.YNc(3,ut,14,0,"div",19),e.YNc(4,si,3,2,"mat-accordion",57),e.YNc(5,mi,15,1,"div",58),e.qZA()),2&i){const t=e.oxw(2);e.Q6J("editable",!0),e.xp6(2),e.Q6J("ngIf",t.multiRisqueAvenant&&"20A"!=(null==t.contrat?null:t.contrat.produit.codeProduit)),e.xp6(1),e.Q6J("ngIf","A20"==t.avenant.code&&0==t.formStep),e.xp6(1),e.Q6J("ngIf","A23"==t.avenant.code||"A24"==t.avenant.code||"A25"==t.avenant.code||(!t.multiRisqueAvenant||t.risqueSelected)&&("A20"==t.avenant.code&&1==t.formStep||"A20"!=t.avenant.code)),e.xp6(1),e.Q6J("ngIf",2==t.formStep)}}function di(i,s){1&i&&e._uU(0,"Informations pack")}function _i(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.idPack0),e.xp6(1),e.hij(" ",t.description," ")}}function fi(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",136),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(4);return e.KtG(o.generateCalcul())}),e.TgZ(1,"mat-icon",137),e._uU(2," autorenew "),e.qZA(),e._uU(3," Calculer"),e.qZA()}}function vi(i,s){if(1&i&&(e.TgZ(0,"div",109),e._uU(1),e.qZA()),2&i){const t=e.oxw(4);e.xp6(1),e.Oqu(t.errorTarif.msg)}}function gi(i,s){if(1&i&&(e.TgZ(0,"div",109),e._uU(1),e.qZA()),2&i){const t=e.oxw(4);e.xp6(1),e.Oqu(t.errorHandler.msg)}}function hi(i,s){1&i&&(e.TgZ(0,"div",109),e._uU(1,"Veuillez remplir tous les champs des garanties obligatoires/coch\xe9es"),e.qZA())}function Ci(i,s){1&i&&e._UZ(0,"th",53)}function Ai(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",54)(1,"mat-checkbox",138),e.NdJ("click",function(o){const a=e.CHM(t).$implicit,r=e.oxw(4);return o.stopPropagation(),e.KtG(r.garantieSelectedIds.push(a.idGarantie))})("change",function(o){const a=e.CHM(t).$implicit,r=e.oxw(4);return e.KtG(o?r.checkAlertVol(a,o.checked):null)}),e.qZA()()}if(2&i){const t=s.$implicit,n=s.dataIndex,o=e.oxw(4);e.xp6(1),e.Q6J("checked",t.checked)("formControl",o.getControl(n,"checked"))}}function Pi(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1,"Garantie "),e.qZA())}function qi(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function xi(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Plafond"),e.qZA())}function bi(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function Ri(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.hij(" ",e.lcZ(3,2,e.xi3(4,4,t.valeur,"1.0-0"))," ")}}function Si(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Plafond"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,Ri,5,7,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(4);e.xp6(3),e.Q6J("formControl",l.getControl(n,"plafond")),e.xp6(1),e.Q6J("ngForOf",o.plafond)}}function Ti(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Plafond"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(4);e.xp6(3),e.Q6J("formControl",n.getControl(t,"plafond"))}}function yi(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(4).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.plafond[0].valeur,"1.0-0")))}}function ki(i,s){1&i&&e._uU(0," - ")}function Zi(i,s){if(1&i&&(e.YNc(0,yi,4,6,"span",12),e.YNc(1,ki,1,0,"ng-template",null,144,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(3).$implicit;e.Q6J("ngIf","0"!=n.plafond[0].valeur)("ngIfElse",t)}}function Li(i,s){if(1&i&&(e.YNc(0,Ti,4,1,"mat-form-field",12),e.YNc(1,Zi,3,2,"ng-template",null,142,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.plafond[0].descriptionvVal)("ngIfElse",t)}}function Ii(i,s){if(1&i&&(e.YNc(0,Si,5,2,"mat-form-field",12),e.YNc(1,Li,3,2,"ng-template",null,140,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.plafond.length>1)("ngIfElse",t)}}function Ni(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,bi,2,0,"span",12),e.YNc(2,Ii,3,2,"ng-template",null,139,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.plafond.length)("ngIfElse",n)}}function Mi(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Franchise "),e.qZA())}function wi(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function Vi(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.hij(" ",e.lcZ(3,2,e.xi3(4,4,t.valeur,"1.0-0"))," ")}}function Oi(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Franchise"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,Vi,5,7,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(4);e.xp6(3),e.Q6J("formControl",l.getControl(n,"franchise")),e.xp6(1),e.Q6J("ngForOf",o.franchise)}}function Yi(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Franchise"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(4);e.xp6(3),e.Q6J("formControl",n.getControl(t,"franchise"))}}function Di(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.franchise[0].valeur,"1.0-0")))}}function Ui(i,s){if(1&i&&(e.YNc(0,Yi,4,1,"mat-form-field",12),e.YNc(1,Di,4,6,"ng-template",null,147,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.franchise[0].descriptionvVal)("ngIfElse",t)}}function Ei(i,s){if(1&i&&(e.YNc(0,Oi,5,2,"mat-form-field",12),e.YNc(1,Ui,3,2,"ng-template",null,146,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.franchise.length>1)("ngIfElse",t)}}function Ji(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,wi,2,0,"span",12),e.YNc(2,Ei,3,2,"ng-template",null,145,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.franchise.length)("ngIfElse",n)}}function Qi(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Formule "),e.qZA())}function Gi(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"-"),e.qZA())}function ji(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.AsE(" ",e.lcZ(3,3,e.xi3(4,5,t.valeur,"1.0-0"))," ",null==t?null:t.unite," ")}}function Bi(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Formule"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,ji,5,8,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(4);e.xp6(3),e.Q6J("formControl",l.getControl(n,"formule")),e.xp6(1),e.Q6J("ngForOf",o.formule)}}function Hi(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Formule"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(4);e.xp6(3),e.Q6J("formControl",n.getControl(t,"formule"))}}function Fi(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.formule[0].valeur,"1.0-0")))}}function $i(i,s){if(1&i&&(e.YNc(0,Hi,4,1,"mat-form-field",12),e.YNc(1,Fi,4,6,"ng-template",null,150,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.formule[0].descriptionvVal)("ngIfElse",t)}}function zi(i,s){if(1&i&&(e.YNc(0,Bi,5,2,"mat-form-field",12),e.YNc(1,$i,3,2,"ng-template",null,149,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.formule.length>1)("ngIfElse",t)}}function Ki(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Gi,2,0,"span",12),e.YNc(2,zi,3,2,"ng-template",null,148,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.formule.length)("ngIfElse",n)}}function Wi(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Prime N-1 "),e.qZA())}function Xi(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.TgZ(4,"sup"),e._uU(5,"DA"),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,e.xi3(3,3,t.primePre,"1.0-0"))," ")}}function en(i,s){1&i&&e._uU(0,"/")}function tn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Xi,6,6,"ng-container",12),e.YNc(2,en,1,0,"ng-template",null,152,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",null!=t.primePre)("ngIfElse",n)}}function nn(i,s){1&i&&(e.ynx(0,151),e.YNc(1,Wi,2,0,"th",46),e.YNc(2,tn,4,2,"td",47),e.BQk())}function on(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Bonus/Malus "),e.qZA())}function an(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.primeBonus," ")}}function rn(i,s){1&i&&e._uU(0,"/")}function sn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,an,2,1,"ng-container",12),e.YNc(2,rn,1,0,"ng-template",null,154,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",null!=t.primeBonus)("ngIfElse",n)}}function ln(i,s){1&i&&(e.ynx(0,153),e.YNc(1,on,2,0,"th",46),e.YNc(2,sn,4,2,"td",47),e.BQk())}function un(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Prime nette "),e.qZA())}function cn(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.TgZ(4,"sup"),e._uU(5,"DZD"),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,e.xi3(3,3,t.prime,"1.2-2"))," ")}}function mn(i,s){1&i&&e._uU(0,"-")}function pn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,cn,6,6,"ng-container",12),e.YNc(2,mn,1,0,"ng-template",null,152,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3),o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",o.tarifReady&&null!=t.prime)("ngIfElse",n)}}function dn(i,s){1&i&&e._UZ(0,"th",53)}function _n(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",157),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,l=e.oxw(4);return e.KtG(l.expandedElement=l.expandedElement===o?null:o)}),e.TgZ(1,"mat-icon"),e._uU(2),e.qZA()()}if(2&i){const t=e.oxw().$implicit,n=e.oxw(4);e.xp6(2),e.Oqu(n.expandedElement===t?"indeterminate_check_box":"add_box")}}function fn(i,s){if(1&i&&(e.TgZ(0,"td",155),e.YNc(1,_n,3,1,"button",156),e.qZA()),2&i){const t=s.$implicit,n=e.oxw(4);e.ekj("example-expanded-row",n.expandedElement===t),e.xp6(1),e.Q6J("ngIf",0!=t.sousGarantieList.data.length)}}function vn(i,s){1&i&&e._UZ(0,"th",53)}function gn(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",54)(1,"mat-checkbox",138),e.NdJ("click",function(o){const a=e.CHM(t).$implicit,r=e.oxw(6);return o.stopPropagation(),e.KtG(r.sousGarantieSelectedIds.push(a.idSousGarantie))})("change",function(o){const a=e.CHM(t).$implicit,r=e.oxw(6);return e.KtG(o?r.selection.toggle(a):null)}),e.qZA()()}if(2&i){const t=s.dataIndex,n=e.oxw(6);e.xp6(1),e.Q6J("checked",!1)("formControl",n.getSousGarantieControl(t,"checked"))}}function hn(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1,"Sous garantie "),e.qZA())}function Cn(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function An(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1,"plafond "),e.qZA())}function Pn(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"/"),e.qZA())}function qn(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.hij(" ",e.lcZ(3,2,e.xi3(4,4,t.valeur,"1.0-0"))," ")}}function xn(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Plafond"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,qn,5,7,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(6);e.xp6(3),e.Q6J("formControl",l.getSousGarantieControl(n,"plafond")),e.xp6(1),e.Q6J("ngForOf",o.plafond)}}function bn(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Plafond"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(6);e.xp6(3),e.Q6J("formControl",n.getSousGarantieControl(t,"plafond"))}}function Rn(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.plafond[0].valeur,"1.0-0")))}}function Sn(i,s){if(1&i&&(e.YNc(0,bn,4,1,"mat-form-field",12),e.YNc(1,Rn,4,6,"ng-template",null,142,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.plafond[0].descriptionvVal)("ngIfElse",t)}}function Tn(i,s){if(1&i&&(e.YNc(0,xn,5,2,"mat-form-field",12),e.YNc(1,Sn,3,2,"ng-template",null,140,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.plafond.length>1)("ngIfElse",t)}}function yn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Pn,2,0,"span",12),e.YNc(2,Tn,3,2,"ng-template",null,139,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.plafond.length)("ngIfElse",n)}}function kn(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Franchise "),e.qZA())}function Zn(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"/"),e.qZA())}function Ln(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.hij(" ",e.lcZ(3,2,e.xi3(4,4,t.valeur,"1.0-0"))," ")}}function In(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Franchise"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,Ln,5,7,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(6);e.xp6(3),e.Q6J("formControl",l.getSousGarantieControl(n,"franchise")),e.xp6(1),e.Q6J("ngForOf",o.franchise)}}function Nn(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Franchise"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(6);e.xp6(3),e.Q6J("formControl",n.getSousGarantieControl(t,"franchise"))}}function Mn(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.franchise[0].valeur,"1.0-0")))}}function wn(i,s){if(1&i&&(e.YNc(0,Nn,4,1,"mat-form-field",12),e.YNc(1,Mn,4,6,"ng-template",null,147,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.franchise[0].descriptionvVal)("ngIfElse",t)}}function Vn(i,s){if(1&i&&(e.YNc(0,In,5,2,"mat-form-field",12),e.YNc(1,wn,3,2,"ng-template",null,146,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.franchise.length>1)("ngIfElse",t)}}function On(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Zn,2,0,"span",12),e.YNc(2,Vn,3,2,"ng-template",null,145,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.franchise.length)("ngIfElse",n)}}function Yn(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Formule "),e.qZA())}function Dn(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1,"/"),e.qZA())}function Un(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.ALo(3,"money"),e.ALo(4,"number"),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.valeur),e.xp6(1),e.AsE(" ",e.lcZ(3,3,e.xi3(4,5,t.valeur,"1.0-0"))," ",null==t?null:t.unite," ")}}function En(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Formule"),e.qZA(),e.TgZ(3,"mat-select",141),e.YNc(4,Un,5,8,"ng-container",14),e.qZA()()),2&i){const t=e.oxw(2),n=t.dataIndex,o=t.$implicit,l=e.oxw(6);e.xp6(3),e.Q6J("formControl",l.getSousGarantieControl(n,"formule")),e.xp6(1),e.Q6J("ngForOf",o.formule)}}function Jn(i,s){if(1&i&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"Formule"),e.qZA(),e._UZ(3,"input",143),e.qZA()),2&i){const t=e.oxw(3).dataIndex,n=e.oxw(6);e.xp6(3),e.Q6J("formControl",n.getSousGarantieControl(t,"formule"))}}function Qn(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,e.xi3(3,3,t.formule[0].valeur,"1.0-0")))}}function Gn(i,s){if(1&i&&(e.YNc(0,Jn,4,1,"mat-form-field",12),e.YNc(1,Qn,4,6,"ng-template",null,150,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw(2).$implicit;e.Q6J("ngIf","input"==n.formule[0].descriptionvVal)("ngIfElse",t)}}function jn(i,s){if(1&i&&(e.YNc(0,En,5,2,"mat-form-field",12),e.YNc(1,Gn,3,2,"ng-template",null,149,e.W1O)),2&i){const t=e.MAs(2),n=e.oxw().$implicit;e.Q6J("ngIf",n.formule.length>1)("ngIfElse",t)}}function Bn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Dn,2,0,"span",12),e.YNc(2,jn,3,2,"ng-template",null,148,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf",0==t.formule.length)("ngIfElse",n)}}function Hn(i,s){if(1&i&&(e.TgZ(0,"th",53),e._uU(1),e.qZA()),2&i){const t=e.oxw(6);e.xp6(1),e.hij(" ","95"==t.codeProduit?"Prime nette":""," ")}}function Fn(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"money"),e.ALo(3,"number"),e.TgZ(4,"sup"),e._uU(5,"DZD"),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,e.xi3(3,3,t.prime,"1.0-0"))," ")}}function $n(i,s){1&i&&e._uU(0,"-")}function zn(i,s){if(1&i&&(e.TgZ(0,"td",54),e.YNc(1,Fn,6,6,"ng-container",12),e.YNc(2,$n,1,0,"ng-template",null,152,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3),o=e.oxw(6);e.xp6(1),e.Q6J("ngIf",o.tarifReady&&"95"==o.codeProduit&&null!=t.prime)("ngIfElse",n)}}function Kn(i,s){1&i&&e._UZ(0,"th",53)}function Wn(i,s){1&i&&e._UZ(0,"td",54)}function Xn(i,s){1&i&&e._UZ(0,"tr",162)}function eo(i,s){1&i&&e._UZ(0,"tr",56)}function to(i,s){if(1&i&&(e.TgZ(0,"table",160),e.ynx(1,116),e.YNc(2,vn,1,0,"th",46),e.YNc(3,gn,2,2,"td",47),e.BQk(),e.ynx(4,117),e.YNc(5,hn,2,0,"th",46),e.YNc(6,Cn,2,1,"td",47),e.BQk(),e.ynx(7,118),e.YNc(8,An,2,0,"th",46),e.YNc(9,yn,4,2,"td",47),e.BQk(),e.ynx(10,119),e.YNc(11,kn,2,0,"th",46),e.YNc(12,On,4,2,"td",47),e.BQk(),e.ynx(13,120),e.YNc(14,Yn,2,0,"th",46),e.YNc(15,Bn,4,2,"td",47),e.BQk(),e.ynx(16,59),e.YNc(17,Hn,2,1,"th",46),e.YNc(18,zn,4,2,"td",47),e.BQk(),e.ynx(19,161),e.YNc(20,Kn,1,0,"th",46),e.YNc(21,Wn,1,0,"td",47),e.BQk(),e.YNc(22,Xn,1,0,"tr",126),e.YNc(23,eo,1,0,"tr",50),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(4);e.Q6J("dataSource",t.sousGarantieList),e.xp6(22),e.Q6J("matHeaderRowDef",n.DisplayedColumnsSousGarantie),e.xp6(1),e.Q6J("matRowDefColumns",n.DisplayedColumnsSousGarantie)}}function io(i,s){if(1&i&&(e.TgZ(0,"td",54)(1,"div",158),e.YNc(2,to,24,3,"table",159),e.qZA()()),2&i){const t=s.$implicit,n=e.oxw(4);e.uIk("colspan",n.displayedColumns.length),e.xp6(1),e.Q6J("@detailExpand",t==n.expandedElement?"expanded":"collapsed"),e.xp6(1),e.Q6J("ngIf",n.loadTable)}}function no(i,s){1&i&&e._UZ(0,"tr",162)}function oo(i,s){1&i&&e._UZ(0,"tr",56)}function ao(i,s){1&i&&e._UZ(0,"tr",163)}function ro(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," ID "),e.qZA())}function so(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.idListParamRisque," ")}}function lo(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Description "),e.qZA())}function uo(i,s){if(1&i&&(e.TgZ(0,"td",54),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function co(i,s){1&i&&(e.TgZ(0,"th",53),e._uU(1," Action "),e.qZA())}function mo(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",54)(1,"button",170)(2,"mat-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",100,62)(6,"button",63),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(6);return e.KtG(a.getListParamRisque(l.idListParamRisque,l.idGarantie))}),e.TgZ(7,"mat-icon"),e._uU(8,"zoom_in"),e.qZA(),e.TgZ(9,"span"),e._uU(10,"Consulter la liste "),e.qZA()()()()}if(2&i){const t=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",t)}}function po(i,s){1&i&&e._UZ(0,"tr",55)}function _o(i,s){1&i&&e._UZ(0,"tr",56)}const fo=function(){return[5,10,20]};function vo(i,s){if(1&i&&(e.TgZ(0,"div",165)(1,"table",166),e.ynx(2,167),e.YNc(3,ro,2,0,"th",46),e.YNc(4,so,2,1,"td",47),e.BQk(),e.ynx(5,168),e.YNc(6,lo,2,0,"th",46),e.YNc(7,uo,2,1,"td",47),e.BQk(),e.ynx(8,59),e.YNc(9,co,2,0,"th",46),e.YNc(10,mo,11,1,"td",47),e.BQk(),e.YNc(11,po,1,0,"tr",49),e.YNc(12,_o,1,0,"tr",50),e.qZA(),e._UZ(13,"mat-paginator",169),e.qZA()),2&i){const t=e.oxw(5);e.xp6(1),e.Q6J("dataSource",t.dataSourceListOfListes),e.xp6(10),e.Q6J("matHeaderRowDef",t.displayedColumnsListOfList),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsListOfList),e.xp6(1),e.Q6J("pageSize",5)("pageSizeOptions",e.DdM(5,fo))}}function go(i,s){if(1&i&&(e.TgZ(0,"mat-expansion-panel",75)(1,"mat-expansion-panel-header")(2,"mat-panel-title",76),e._uU(3," Consulter les listes "),e.qZA()(),e.YNc(4,vo,14,6,"div",164),e.qZA()),2&i){const t=e.oxw(4);e.Q6J("expanded",!0),e.xp6(4),e.Q6J("ngIf",0!=t.dataSourceListOfListes.data.length)}}function ho(i,s){if(1&i&&(e.TgZ(0,"div",130)(1,"div",131)(2,"span",132),e._uU(3,"Montant pruning:"),e.qZA(),e.TgZ(4,"span",133),e._uU(5),e.ALo(6,"money"),e.ALo(7,"number"),e.TgZ(8,"sup"),e._uU(9,"DA"),e.qZA()()()()),2&i){const t=e.oxw(4);e.xp6(5),e.hij("",e.lcZ(6,1,e.xi3(7,3,t.PrimeAfterPruning,"1.0-0"))," ")}}function Co(i,s){if(1&i&&(e.TgZ(0,"div",130)(1,"div",131)(2,"span",132),e._uU(3,"Montant Bonus/Malus:"),e.qZA(),e.TgZ(4,"span",133),e._uU(5),e.ALo(6,"money"),e.ALo(7,"number"),e.TgZ(8,"sup"),e._uU(9,"DA"),e.qZA()()()()),2&i){const t=e.oxw(4);e.xp6(5),e.hij("",e.lcZ(6,1,e.xi3(7,3,t.PrimeBonusMalus,"1.0-0"))," ")}}function Ao(i,s){1&i&&e._UZ(0,"mat-spinner",43)}function Po(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Suivant"),e.qZA())}function qo(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(4);return e.KtG(o.nextPrime())}),e.YNc(1,Ao,1,0,"mat-spinner",18),e.YNc(2,Po,2,0,"span",19),e.qZA()}if(2&i){const t=e.oxw(4);e.xp6(1),e.Q6J("ngIf",t.loaderCalcul),e.xp6(1),e.Q6J("ngIf",!t.loaderCalcul)}}function xo(i,s){1&i&&e._UZ(0,"mat-spinner",43)}function bo(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Suivant "),e.qZA())}function Ro(i,s){if(1&i&&(e.TgZ(0,"button",52),e.YNc(1,xo,1,0,"mat-spinner",18),e.YNc(2,bo,2,0,"span",19),e.qZA()),2&i){const t=e.oxw(5);e.xp6(1),e.Q6J("ngIf",t.loaderCalcul),e.xp6(1),e.Q6J("ngIf",!t.loaderCalcul)}}function So(i,s){if(1&i&&e.YNc(0,Ro,3,2,"button",171),2&i){const t=e.oxw(4);e.Q6J("ngIf",!t.calcul)}}const To=function(){return["expandedDetail"]};function yo(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"form",21,22)(2,"div",23),e.ynx(3),e.TgZ(4,"div",111)(5,"mat-form-field",80)(6,"mat-label"),e._uU(7,"Pack"),e.qZA(),e.TgZ(8,"mat-select",112),e.NdJ("selectionChange",function(o){e.CHM(t);const l=e.oxw(3);return e.KtG(l.getPack(o.value,!1,!1))}),e.YNc(9,_i,3,2,"ng-container",14),e.qZA()(),e.YNc(10,fi,4,0,"button",113),e.qZA(),e.YNc(11,vi,2,1,"div",114),e.YNc(12,gi,2,1,"div",114),e.YNc(13,hi,2,0,"div",114),e.TgZ(14,"table",115),e.ynx(15,116),e.YNc(16,Ci,1,0,"th",46),e.YNc(17,Ai,2,2,"td",47),e.BQk(),e.ynx(18,117),e.YNc(19,Pi,2,0,"th",46),e.YNc(20,qi,2,1,"td",47),e.BQk(),e.ynx(21,118),e.YNc(22,xi,2,0,"th",46),e.YNc(23,Ni,4,2,"td",47),e.BQk(),e.ynx(24,119),e.YNc(25,Mi,2,0,"th",46),e.YNc(26,Ji,4,2,"td",47),e.BQk(),e.ynx(27,120),e.YNc(28,Qi,2,0,"th",46),e.YNc(29,Ki,4,2,"td",47),e.BQk(),e.YNc(30,nn,3,0,"ng-container",121),e.YNc(31,ln,3,0,"ng-container",122),e.ynx(32,59),e.YNc(33,un,2,0,"th",46),e.YNc(34,pn,4,2,"td",47),e.BQk(),e.ynx(35,123),e.YNc(36,dn,1,0,"th",46),e.YNc(37,fn,2,3,"td",124),e.BQk(),e.ynx(38,125),e.YNc(39,io,3,3,"td",47),e.BQk(),e.YNc(40,no,1,0,"tr",126),e.YNc(41,oo,1,0,"tr",50),e.YNc(42,ao,1,0,"tr",127),e.qZA(),e.YNc(43,go,5,2,"mat-expansion-panel",128),e.TgZ(44,"div",129)(45,"div",130)(46,"div",131)(47,"span",132),e._uU(48,"Prime Net:"),e.qZA(),e.TgZ(49,"span",133),e._uU(50),e.ALo(51,"money"),e.ALo(52,"number"),e.TgZ(53,"sup"),e._uU(54,"DA"),e.qZA()()()(),e.YNc(55,ho,10,6,"div",134),e.YNc(56,Co,10,6,"div",134),e.qZA(),e.BQk(),e.qZA(),e.TgZ(57,"div",15)(58,"button",102),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.calcul=!0)}),e._uU(59,"Retour"),e.qZA(),e.YNc(60,qo,3,2,"button",135),e.YNc(61,So,1,1,"ng-template",null,13,e.W1O),e.qZA()()}if(2&i){const t=e.MAs(62),n=e.oxw(3);e.Q6J("formGroup",n.formApplicationAvenant),e.xp6(8),e.Q6J("value",n.contrat.groupeList[0].pack.idPack0)("disabled",!(null!=n.avenant&&n.avenant.packAffecte)),e.xp6(1),e.Q6J("ngForOf",n.packs),e.xp6(1),e.Q6J("ngIf",0!=(null==n.avenant||null==n.avenant.paramRisque?null:n.avenant.paramRisque.length)||(null==n.avenant?null:n.avenant.packAffecte)||(null==n.avenant?null:n.avenant.garantieAffecte)),e.xp6(1),e.Q6J("ngIf",n.errorTarif.error),e.xp6(1),e.Q6J("ngIf",n.errorHandler.error),e.xp6(1),e.Q6J("ngIf",n.errorPackForm),e.xp6(1),e.Q6J("dataSource",n.dataSource),e.xp6(16),e.Q6J("ngIf","A13"==(null==n.avenant?null:n.avenant.code)&&"45A"==n.codeProduit),e.xp6(1),e.Q6J("ngIf","A13"==(null==n.avenant?null:n.avenant.code)&&"45A"==n.codeProduit),e.xp6(9),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(25,To)),e.xp6(1),e.Q6J("ngIf",0!=n.dataSourceListOfListes.data.length&&0!=n.dataSource.data.length),e.xp6(7),e.hij("",e.lcZ(51,20,e.xi3(52,22,n.PrimeTotaleTarif,"1.0-0"))," "),e.xp6(5),e.Q6J("ngIf","A13"==(null==n.avenant?null:n.avenant.code)&&"45A"==n.codeProduit),e.xp6(1),e.Q6J("ngIf","A13"==(null==n.avenant?null:n.avenant.code)&&"45A"==n.codeProduit),e.xp6(4),e.Q6J("ngIf",!n.calcul&&"A13"!=(null==n.avenant?null:n.avenant.code)&&"A18"!=(null==n.avenant?null:n.avenant.code)&&"A22"!=(null==n.avenant?null:n.avenant.code))("ngIfElse",t)}}function ko(i,s){1&i&&(e.TgZ(0,"mat-header-cell"),e._uU(1,"Groupe"),e.qZA())}function Zo(i,s){if(1&i&&(e.TgZ(0,"mat-cell"),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Oqu(t.descriptionGroupe)}}function Lo(i,s){1&i&&(e.TgZ(0,"mat-header-cell"),e._uU(1,"Pack"),e.qZA())}function Io(i,s){if(1&i&&(e.TgZ(0,"mat-option",33),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t.idPack0),e.xp6(1),e.Oqu(t.description)}}function No(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-cell")(1,"mat-select",178),e.NdJ("ngModelChange",function(o){const a=e.CHM(t).$implicit;return e.KtG(a.pack=o)})("selectionChange",function(o){const a=e.CHM(t).$implicit,r=e.oxw(4);return e.KtG(r.getPackMulti(o.value,a.idGroupe))}),e.YNc(2,Io,2,2,"mat-option",93),e.qZA()()}if(2&i){const t=s.$implicit,n=e.oxw(4);e.xp6(1),e.MGl("placeholder","veuillez choisir le pack assign\xe9 au groupe: ",t.group,"")("name","pack",t.group,""),e.Q6J("ngModel",t.pack)("disabled",1==t.newGroupe&&"A06"!=n.avenant.code),e.xp6(1),e.Q6J("ngForOf",n.packs)}}function Mo(i,s){1&i&&e._UZ(0,"mat-header-row")}function wo(i,s){1&i&&e._UZ(0,"mat-row")}function Vo(i,s){1&i&&(e.TgZ(0,"div",15)(1,"button",16),e._uU(2,"Retour"),e.qZA(),e.TgZ(3,"button",52),e._uU(4,"Suivant "),e.qZA()())}function Oo(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"mat-table",172),e.ynx(2,98),e.YNc(3,ko,2,0,"mat-header-cell",173),e.YNc(4,Zo,2,1,"mat-cell",174),e.BQk(),e.ynx(5,175),e.YNc(6,Lo,2,0,"mat-header-cell",173),e.YNc(7,No,3,5,"mat-cell",174),e.BQk(),e.YNc(8,Mo,1,0,"mat-header-row",176),e.YNc(9,wo,1,0,"mat-row",177),e.qZA(),e.TgZ(10,"div",15)(11,"button",16),e._uU(12,"Retour"),e.qZA(),e.TgZ(13,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return o.generateCalcul(),e.KtG(o.loaderTarif=!0)}),e._uU(14,"Suivant "),e.qZA()(),e.YNc(15,Vo,5,0,"div",77),e.qZA()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("dataSource",t.dataSourceGroupePack),e.xp6(7),e.Q6J("matHeaderRowDef",t.displayedColumnsGroupePack),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsGroupePack),e.xp6(6),e.Q6J("ngIf","A23"==(null==t.avenant?null:t.avenant.code))}}function Yo(i,s){if(1&i&&(e.TgZ(0,"mat-step",20),e.YNc(1,di,1,0,"ng-template",9),e.TgZ(2,"mat-accordion",10),e.YNc(3,yo,63,26,"form",67),e.YNc(4,Oo,16,4,"div",19),e.qZA()()),2&i){const t=e.oxw(2);e.Q6J("stepControl",t.formApplicationAvenant)("editable",!0),e.xp6(3),e.Q6J("ngIf",!t.multiRisqueProduct),e.xp6(1),e.Q6J("ngIf",t.multiRisqueProduct)}}function Do(i,s){1&i&&e._uU(0,"R\xe9duction")}function Uo(i,s){if(1&i&&(e.TgZ(0,"div",109),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Oqu(t.errorHandler.msg)}}function Eo(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.idConvention),e.xp6(1),e.hij(" ",t.nomConvention," ")}}function Jo(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",33),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t.idReduction),e.xp6(1),e.hij(" ",t.nomReduction," ")}}function Qo(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-step",8),e.YNc(1,Do,1,0,"ng-template",9),e.TgZ(2,"p"),e._uU(3,"Veuillez choisir une Convention/R\xe9duction"),e.qZA(),e.YNc(4,Uo,2,1,"div",114),e.TgZ(5,"form",179),e.NdJ("ngSubmit",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.submitReduction())}),e.TgZ(6,"mat-form-field",80)(7,"mat-label"),e._uU(8," Convention"),e.qZA(),e.TgZ(9,"mat-select",180),e.NdJ("valueChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.defaultConvention=o)})("selectionChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.getReductionByConvention(o.value))}),e.TgZ(10,"mat-option",33),e._uU(11," Aucune Convention "),e.qZA(),e.YNc(12,Eo,3,2,"ng-container",14),e.qZA()(),e.TgZ(13,"mat-form-field",80)(14,"mat-label"),e._uU(15," R\xe9duction"),e.qZA(),e.TgZ(16,"mat-select",181),e.NdJ("valueChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.defaultReduction=o)}),e.TgZ(17,"mat-option",33),e._uU(18," Aucune Reduction "),e.qZA(),e.YNc(19,Jo,3,2,"ng-container",14),e.qZA()(),e.TgZ(20,"div",182)(21,"button",183)(22,"span"),e._uU(23,"Suivant"),e.qZA()(),e.TgZ(24,"button",184),e._uU(25,"Retour"),e.qZA()()()()}if(2&i){const t=e.oxw(2);e.Q6J("editable",!0),e.xp6(4),e.Q6J("ngIf",t.errorHandler.error),e.xp6(1),e.Q6J("formGroup",t.formReduction),e.xp6(4),e.Q6J("value",t.defaultConvention),e.xp6(1),e.Q6J("value","aucuneConvention"),e.xp6(2),e.Q6J("ngForOf",t.conventions),e.xp6(4),e.Q6J("value",t.defaultReduction),e.xp6(1),e.Q6J("value","aucuneReduction"),e.xp6(2),e.Q6J("ngForOf",t.reductions)}}function Go(i,s){1&i&&e._uU(0,"R\xe9sum\xe9")}function jo(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function Bo(i,s){if(1&i&&(e.ynx(0),e.YNc(1,jo,9,7,"ng-container",19),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",101==t.idPrime)}}function Ho(i,s){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,Bo,2,1,"ng-container",14),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.retourCalcul.primeList)}}function Fo(i,s){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2,"Prime Nette"),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()()()),2&i){const t=e.oxw(2);e.xp6(4),e.hij("",e.lcZ(5,1,e.xi3(6,3,t.PrimeTotale,"1.0-0"))," ")}}function $o(i,s){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()()()),2&i){const t=s.$implicit;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function zo(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"td",185),e._uU(2),e.qZA(),e.TgZ(3,"td",185),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function Ko(i,s){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,zo,9,7,"ng-container",19),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",186==t.idPrime)}}function Wo(i,s){1&i&&e._UZ(0,"mat-spinner",43)}function Xo(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Appliquer "),e.qZA())}function ea(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"h2",2)(2,"mat-icon",3),e.NdJ("mouseup",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.redirectConsultation())}),e._uU(3,"arrow_circle_left"),e.qZA(),e._uU(4),e.qZA(),e._UZ(5,"mat-divider"),e.TgZ(6,"mat-stepper",4,5),e.YNc(8,Ge,24,12,"mat-step",6),e.YNc(9,We,18,7,"mat-step",7),e.YNc(10,pi,6,5,"mat-step",7),e.YNc(11,Yo,5,4,"mat-step",6),e.YNc(12,Qo,26,9,"mat-step",7),e.TgZ(13,"mat-step",8),e.YNc(14,Go,1,0,"ng-template",9),e.TgZ(15,"mat-accordion",10)(16,"table",11),e.YNc(17,Ho,2,1,"tr",12),e.YNc(18,Fo,9,6,"ng-template",null,13,e.W1O),e.YNc(20,$o,9,7,"tr",14),e.YNc(21,Ko,2,1,"tr",14),e.qZA(),e.TgZ(22,"div",15)(23,"button",16),e._uU(24,"Retour"),e.qZA(),e.TgZ(25,"button",17),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.submitApplicationAvenant())}),e.YNc(26,Wo,1,0,"mat-spinner",18),e.YNc(27,Xo,2,0,"span",19),e.qZA()()()()()()}if(2&i){const t=e.MAs(19),n=e.oxw();e.xp6(4),e.hij(" Application ",n.avenant.description," "),e.xp6(2),e.Q6J("linear",!0),e.xp6(2),e.Q6J("ngIf",0!=(null==n.avenant||null==n.avenant.motifs?null:n.avenant.motifs.length)),e.xp6(1),e.Q6J("ngIf",n.multiRisqueAvenant&&0==(null==n.avenant||null==n.avenant.paramRisque?null:n.avenant.paramRisque.length)),e.xp6(1),e.Q6J("ngIf",0!=(null==n.avenant||null==n.avenant.paramRisque?null:n.avenant.paramRisque.length)),e.xp6(1),e.Q6J("ngIf",0!=(null==n.avenant.paramRisque?null:n.avenant.paramRisque.length)&&"A08"!=(null==n.avenant?null:n.avenant.code)&&"A17"!=(null==n.avenant?null:n.avenant.code)&&"A23"!=(null==n.avenant?null:n.avenant.code)&&"A24"!=(null==n.avenant?null:n.avenant.code)&&2!=n.formStep),e.xp6(1),e.Q6J("ngIf",n.reductionExist),e.xp6(1),e.Q6J("editable",!0),e.xp6(4),e.Q6J("ngIf","A13"!=(null==n.avenant?null:n.avenant.code)&&"A18"!=(null==n.avenant?null:n.avenant.code)&&"A22"!=(null==n.avenant?null:n.avenant.code))("ngIfElse",t),e.xp6(3),e.Q6J("ngForOf",n.retourCalcul.taxeList),e.xp6(1),e.Q6J("ngForOf",n.retourCalcul.primeList),e.xp6(5),e.Q6J("ngIf",n.loaderApplication),e.xp6(1),e.Q6J("ngIf",!n.loaderApplication)}}const H=new Date;function Z(i){var s=new Date(i.value);return H.getFullYear()-s.getFullYear()<18?{ageInf18:!0}:H.getFullYear()-s.getFullYear()>106?{ageSup107:!0}:null}let ta=(()=>{class i{constructor(t,n,o,l,a,r,c,p,m,d,f,v,_,g,h,q,M,Sr,Tr,yr){this.conventionService=t,this.reductionService=n,this.cryptoService=o,this._snackBar=l,this.dataTransferService=a,this.dialog=r,this.personneService=c,this.formBuilder=p,this.dureeService=m,this.agencesService=d,this.paramRisqueService=f,this.route=v,this.avenantService=_,this.formBuilderAuth=g,this.router=h,this.contratService=q,this.packService=M,this.devisService=Sr,this.vehiculeService=Tr,this.genericService=yr,this.sousGarantieTab=[],this.sousGarantieExist=!1,this.franchiseExist=!1,this.plafondExist=!1,this.formuleExist=!1,this.maxContenue=1e7,this.displayedColumnsListOfList=["idList","description","action"],this.typeClients=[],this.packCompletList=[],this.selection=new ce.Ov(!0,[]),this.avenantSave=!1,this.tarifReady=!1,this.errorHandler={error:!1,msg:""},this.errorTarif={error:!1,msg:""},this.roles=[],this.risqueSelected=!1,this.garantieTab=[],this.garantieAll=[],this.ancientPack=[],this.newGaranties=[],this.valeurVenale=0,this.errorPackForm=!1,this.loadTable=!1,this.garantieSelectedIds=[],this.loaderTarif=!1,this.paraRisqueProduitCategory=[],this.marques=[],this.modeles=[],this.wilayas=[],this.agences=[],this.durees=[],this.communes_sous=[],this.communes_assure=[],this.communes_cond=[],this.genres=[],this.situations=[],this.professions=[],this.warningMessage=[],this.controleDevis=[],this.categories=["A","B","C","D","E","F"],this.isAssure=!1,this.isConducteur=!1,this.isConducteurAssure=!1,this.displayedColumnsGroupePack=["groupe","pack"],this.groupesPacks=[],this.sousGarantieSelectedIds=[],this.risqueConsult={},this.paramElement={},this.devis={},this.devisAccess={},this.assure={},this.souscripteur={},this.conducteur={},this.retourApplication={},this.retourCalcul={},this.oneRisqueInfo=[],this.DisplayedColumnsSousGarantie=["select","garantie","plafond","franchise","formule","action","more"],this.displayedColumnsParamRisque=["idRisque","paramRisque","action"],this.displayedColumnsRisque=["idRisque","paramRisque"],this.displayedColumnsRisqueAdd=["risqueNum","NDImmatriculation","groupe","action"],this.PrimeTotale=0,this.packs=[],this.informationsPack=[],this.jsonAvenant={},this.loaderApplication=!1,this.loaderCalcul=!1,this.loaderpack=!1,this.calcul=!1,this.now=new Date,this.multiRisqueProduct=!1,this.multiRisqueAvenant=!1,this.groupArray=[],this.dataSourceRisque=new P.by,this.controleRisque=[],this.risqueIndexBody=0,this.risqueIndex=0,this.risqueGroupe=[],this.multiRisqueArray=[],this.filterReduction=pe.P,this.defaultConvention="aucuneConvention",this.defaultReduction="aucuneReduction",this.reductionExist=!1,this.returnedTarif={},this.risqueEdited=!1,this.formStep=0,this.fileSuccess=!1,this.displayedColumnsListParamRisque=[],this.listParamRisque=[],this.dataSourceListParamRisque=[],this.paramRisqueList=[],this.paraRisqueType=[],this.idsListParams=[],this.codesListParams=[],this.paramListTest=[],this.paramList=[],this.dataSourceListOfListes=new P.by,this.indexGarantieMrp=0,this.indexSousGarantieMrp=0,this.labelNom="Nom",this.isCourtier=sessionStorage.getItem("roles")?.includes("COURTIER"),this.isBEA=sessionStorage.getItem("roles")?.includes("CDC_BEA"),this.agencePersonne=parseInt(sessionStorage.getItem("agence")||"0"),this.tkn=JSON.parse(sessionStorage.getItem("access_token")||"")?.access_token}getTypeClient(){this.genericService.getParam(JSON.parse(sessionStorage.getItem("dictionnaire")||"{}").find(t=>"C24"==t.code).idCategorie).subscribe({next:t=>{this.typeClients=t},error:t=>{console.log(t)}})}getAllParamRisque(){let t=!1;this.paramRisqueService.getParamByProduit(this.idProduit).subscribe({next:o=>{this.paramRisqueService.getWorkFlowByProduit(this.idProduit,45).subscribe({next:l=>{o.map(a=>{let r={},c=null,p=null;l.filter(m=>{a.paramRisque.idParamRisque==m.paramRisque.idParamRisque&&(t=!0,c=m.enabled,p=m.obligatoire)}),r.idParamRisque=a.paramRisque.idParamRisque,r.libelle=a.paramRisque.libelle,r.formName=a.paramRisque.libelle.split(" ").map(m=>m.charAt(0).toUpperCase()+m.substring(1)).join("").replace(/[\xb0']/g,""),r.orderChamp=a.paramRisque.orderChamp,r.position=a.paramRisque.position,r.typeChamp=a.paramRisque.typeChamp,r.sizeChamp=a.paramRisque.sizeChamp,r.codeParam=a.paramRisque.codeParam,r.reponses=a.paramRisque.categorie?.paramDictionnaires,r.typeValeur=a.iddictionnaire,r.defaultValue=a.valeur,r.obligatoire=p,r.enable=c,r.category=a.paramRisque.categorieParamRisque?.description,r.parent=a.paramRisque.paramRisqueParent,r.isParent=a.paramRisque.isParent,"valeur minimum"==a?.iddictionnaire?.description&&(r.valeurMin=a.valeur),"valeur maximum"==a?.iddictionnaire?.description&&(r.valeurMax=a.valeur),this.paraRisqueType.push(r)})},error:l=>{console.log(l)}})},error:o=>{console.log(o)}})}getListParamRisque(t,n){this.paramRisqueService.getListParamRisque(t).subscribe(o=>{this.listParamRisque=[],this.displayedColumnsListParamRisque=[],this.idsListParams=[],this.codesListParams=[],this.formListParamRisque=this.formBuilder.group({}),o.map(l=>{this.idListParamList=l.idListParamRisque.idListParamRisque,this.listParamRisque.push(this.paraRisqueType.find(a=>a.idParamRisque==l.idParamRisqueFils.idParamRisque))}),this.listParamRisque.map(l=>{this.formListParamRisque.addControl(l.formName,new u.NI(l.defaultValue,0!=l.sizeChamp&&null!=l.sizeChamp?[u.kI.required,u.kI.minLength(l.sizeChamp),u.kI.maxLength(l.sizeChamp)]:[u.kI.required])),"L08"==l.typeChamp.code&&null==l.paramRisqueParent&&this.paramRisqueService.getTableParamParent(l.idParamRisque).subscribe({next:a=>{l.reponses="P279"==l.codeParam?a.filter(r=>1==r.is_professionnel):a},error:a=>{console.log(a)}}),this.displayedColumnsListParamRisque.push(l.formName),this.idsListParams.push(l.idParamRisque),this.codesListParams.push(l.codeParam)}),this.lengthColumnsListParamRisque=this.displayedColumnsListParamRisque.length,this.openDialogList(n)})}openDialogList(t){this.dialog.open(_e.I,{width:"60%",data:{displayedColumnsListParamRisque:this.displayedColumnsListParamRisque,idListParamList:this.idListParamList,listParamRisque:this.listParamRisque,formListParamRisque:this.formListParamRisque,garantie:this.garantieAll.find(o=>o.idGarantie==t),dataSourceListParamRisque:this.dataSourceListParamRisque}}).afterClosed().subscribe(o=>{if(o){const l=JSON.parse(JSON.stringify(o.data));this.dataSourceListParamRisque=l;const a=this.idsListParams,r=this.codesListParams;this.displayedColumnsListParamRisque.splice(-1,1),this.paramList=l.filter(d=>this.displayedColumnsListParamRisque.every(f=>d.hasOwnProperty(f))).map(d=>{let f=[],v=Object.keys(d),_=null,g="debase";for(let h=0;h<v.length;h++)"Liste of values"==this.listParamRisque.find(q=>q.formName==v[h])?.typeChamp?.description?(_=d[v[h]].idParam,g=d[v[h]].code):(_=null,g="From Table"==this.listParamRisque.find(q=>q.formName==v[h])?.typeChamp?.description?d[v[h]].code:"date"!=this.listParamRisque.find(q=>q.formName==v[h])?.typeChamp?.description&&34==this.listParamRisque.find(q=>q.formName==v[h])?.idParamRisque?String(Number(d[v[h]])):d[v[h]]),f.push({idParam:a[h],codeParam:r[h],reponse:{idReponse:_,description:g}});return f});const c={idListParamRisque:this.idListParamList,idGarantie:t,paramList:[]};this.paramList.map(d=>{c.paramList.push({prime:"",paramListsValues:d})});let p=this.devis.list.findIndex(d=>d.idListParamRisque==c.idListParamRisque),m="G53"==this.garantieAll.find(d=>d.idGarantie==t)?.codeGarantie?"Effectifs":"Mat\xe9riel informatique";if(-1!=p)this.devis.list[p]=c,this.dataSourceListOfListes.data[p]={idListParamRisque:this.idListParamList,idGarantie:t,description:m};else{this.devis.list.push(c);const d=[...this.dataSourceListOfListes.data,{idListParamRisque:this.idListParamList,idGarantie:t,description:m}];this.dataSourceListOfListes.data=d}this.formListParamRisque.reset(),""!=t&&(-1==this.garantieAll.findIndex(d=>d.idGarantie==t)&&this.indexSousGarantieMrp++,this.checkListSousGaranties(this.garantieAll[this.indexGarantieMrp].sousGarantieList,this.formPackGaranties.controls.find(d=>d.controls.idPackComplet.value==this.garantieAll[this.indexGarantieMrp].idPackComplet)?.controls?.souGarantieArray))}else{let l=this.devis.list.findIndex(a=>a.idListParamRisque==this.idListParamList);-1!=l&&(this.devis.list[l].idGarantie=t),""!=t&&(-1==this.garantieAll.findIndex(a=>a.idGarantie==t)&&this.indexSousGarantieMrp++,this.checkListSousGaranties(this.garantieAll[this.indexGarantieMrp].sousGarantieList,this.formPackGaranties.controls.find(a=>a.controls.idPackComplet.value==this.garantieAll[this.indexGarantieMrp].idPackComplet)?.controls?.souGarantieArray))}})}openDialogMRP(){this.indexSousGarantieMrp=0,this.indexGarantieMrp<this.garantieAll.length&&this.formPackGaranties.controls.find(t=>t.controls.idPackComplet.value==this.garantieAll[this.indexGarantieMrp].idPackComplet)?.controls.checked.value&&(this.garantieAll[this.indexGarantieMrp].list&&("G53"!=this.garantieAll[this.indexGarantieMrp].codeGarantie||this.garantieAll.some(t=>"G53"===t.codeGarantie))?this.getListParamRisque(this.garantieAll[this.indexGarantieMrp].idListParamRisque,this.garantieAll[this.indexGarantieMrp].idGarantie):(this.indexSousGarantieMrp=0,this.checkListSousGaranties(this.garantieAll[this.indexGarantieMrp].sousGarantieList,this.formPackGaranties.controls.find(t=>t.controls.idPackComplet.value==this.garantieAll[this.indexGarantieMrp].idPackComplet)?.controls?.souGarantieArray)))}checkListSousGaranties(t,n){this.indexSousGarantieMrp<t.length?t[this.indexSousGarantieMrp].list&&n.controls.find(o=>o.controls.idPackComplet.value==t[this.indexSousGarantieMrp].idPackComplet)?.controls.checked.value?this.getListParamRisque(t[this.indexSousGarantieMrp].idListParamRisque,t[this.indexSousGarantieMrp].idSousGarantie):(this.indexSousGarantieMrp++,this.checkListSousGaranties(t,n)):(this.indexGarantieMrp++,this.openDialogMRP())}isAllSelected(){return this.selection.selected.length===this.dataSource.data.length}getSousGarantieControl(t,n){return this.formPackGaranties.at(this.actualControlGarantie).get("souGarantieArray").at(t).get(n)}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.data.forEach(t=>{this.formPackGaranties.controls.map(n=>{n.value.idPackComplet==t.idPackComplet&&(n.controls.checked.value=!0)}),this.selection.select(t)})}getControl(t,n){return this.actualControlGarantie=t,this.formPackGaranties.at(t).get(n)}changeAccess(){this.devisService.updateAccessDevis({idDevisAccess:this.devisAccess?.idDevisAccess,devis:this.devisAccess.devis,accessContrat:1,accessAvenant:1}).subscribe({next:n=>{},error:n=>{console.log(n)}})}redirectConsultation(){this.router.navigate(["consultation-avenants/vie/"+this.codeProduit+"/"+this.idContrat])}checkAccess(){this.devisService.getAccessByDevis(this.contrat?.idDevis).subscribe({next:t=>{this.devisAccess=t,t?.accessAvenant?this.devisService.updateAccessDevis({idDevisAccess:t?.idDevisAccess,devis:t?.devis,accessContrat:1,accessAvenant:0}).subscribe({next:o=>{},error:o=>{console.log(o)}}):R().fire({title:"Une personne est en train de faire un avenant sur cette police.",icon:"warning",allowOutsideClick:!1,confirmButtonText:"Ok",width:400}).then(n=>{n.isConfirmed&&this.router.navigate(["consultation-avenants/"+this.codeProduit+"/"+this.idContrat])})},error:t=>{console.log(t)}})}ngOnInit(){this.risquesInvolved=this.dataTransferService.getDataRisquesArray(),this.codeProduit=this.route.snapshot.paramMap.get("codeProduit"),this.idTypeAvenant=this.route.snapshot.paramMap.get("idTypeAvenant"),this.idContrat=this.route.snapshot.paramMap.get("idContrat"),this.idProduit=JSON.parse(sessionStorage.getItem("products")||"{}").find(t=>t.codeProduit==this.codeProduit)?.idProduit,this.getInfoProduit(),this.formApplicationAvenant=this.formBuilderAuth.group({idTypeAvenant:[this.idTypeAvenant],idContrat:[this.idContrat],dateAvenant:[{value:new Date,disabled:!0}],motif:["",[u.kI.required]],commentaire:[""],agence:[this.isCourtier||this.isBEA?this.agencePersonne:"",[u.kI.required]]}),this.formListParamRisque=this.formBuilder.group({}),this.formParamRisque=this.formBuilderAuth.group({}),this.formReduction=this.formBuilder.group({reduction:["aucuneReduction"],convention:["aucuneConvention"]}),this.getTypeClient(),this.getAgence(),this.getDuree(),this.getGenre(),this.getSituation(),this.getProfession(),this.getIdPays("DZA"),this.getMarque(),this.getAllPack(),this.getRoles(),this.getAllParamRisque(),this.isCourtier||this.isBEA?this.formApplicationAvenant.get("agence")?.disable():this.formApplicationAvenant.get("agence")?.enable()}changeTypeClient(t){this.typeClient=this.typeClients.find(n=>n.idParam==t)?.description,"personne morale"==this.typeClient?(this.formCreationAssure.get("nom")?.setValidators([]),this.formCreationAssure.get("prenom")?.setValidators([]),this.formCreationAssure.get("dateNaissance")?.setValidators([]),this.formCreationAssure.get("nom").disable(),this.formCreationAssure.get("prenom").disable(),this.formCreationAssure.get("dateNaissance").disable(),this.formCreationAssure.get("raisonSocial")?.setValidators([u.kI.required,u.kI.maxLength(40)]),this.formCreationAssure.get("raisonSocial").enable(),this.formCreationAssure.get("nif")?.setValidators([u.kI.required,u.kI.pattern(C.e.NIF)]),this.formCreationAssure.get("nif").enable(),this.formCreationAssure.get("email")?.setValidators([u.kI.required,u.kI.pattern(C.e.email)]),this.formCreationAssure?.get("nom")?.setValue(null),this.formCreationAssure?.get("prenom")?.setValue(null),this.formCreationAssure?.get("dateNaissance")?.setValue(null)):(this.formCreationAssure.get("nom")?.setValidators([u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]),this.formCreationAssure.get("prenom")?.setValidators([u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]),this.formCreationAssure.get("dateNaissance")?.setValidators([u.kI.required,Z]),this.formCreationAssure.get("nom").enable(),this.formCreationAssure.get("prenom").enable(),this.formCreationAssure.get("dateNaissance").enable(),this.formCreationAssure.get("email")?.setValidators([u.kI.pattern(C.e.email)]),this.formCreationAssure.get("raisonSocial")?.setValidators([]),this.formCreationAssure.get("raisonSocial").disable(),this.formCreationAssure?.get("raisonSocial")?.setValue(null),this.formCreationAssure.get("nif")?.setValidators([]),this.formCreationAssure.get("nif").disable(),this.formCreationAssure?.get("nif")?.setValue(null)),this.formCreationAssure.get("nif").updateValueAndValidity(),this.formCreationAssure.get("raisonSocial").updateValueAndValidity(),this.formCreationAssure.get("nom").updateValueAndValidity(),this.formCreationAssure.get("prenom").updateValueAndValidity(),this.formCreationAssure.get("dateNaissance").updateValueAndValidity(),this.formCreationAssure.get("email").updateValueAndValidity()}getInfoProduit(){this.genericService.getPorduitById(this.idProduit).subscribe({next:t=>{this.multiRisqueProduct="Oui"==t.param_Produit_Reponses.filter(n=>"multirisque"==n.idParamProduit.libelle)[0].reponse.description},error:t=>{console.log(t)}})}getAgence(){this.agencesService.getAllAgence().subscribe({next:t=>{this.agences=t},error:t=>{console.log(t)}})}getDuree(){this.dureeService.getAllDuree().subscribe({next:t=>{this.durees=t},error:t=>{console.log(t)}})}getRelation(t,n,o,l){if(1==n)if("Liste of values"==t)this.paramRisqueService.getParamRelation(o,l).subscribe({next:a=>{this.paraRisqueProduitCategory[0].filter(r=>{r.paramRisque.idParamRisque==a[0].idParamRisque&&(r.paramRisque.categorie.paramDictionnaires=a[0].categorie.paramDictionnaires)})},error:a=>{console.log(a)}});else{let a=this.avenant.paramRisque.find(r=>r.parent?.idParamRisque==o)?.idParamRisque;a&&this.paramRisqueService.getTableParamChild(a,l).subscribe({next:r=>{this.avenant.paramRisque.filter(c=>{c.idParamRisque==a&&(c.reponses=r,this.formParamRisque.controls[c.formName].enable())})},error:r=>{console.log(r)}})}}getAllPack(){this.packService.getPackByProduit(this.idProduit).subscribe({next:t=>{this.packs=t,this.getContrat()},error:t=>{console.log(t)}})}getAllPackByProduit(t){this.getPack(this.contrat.groupeList[0].pack.idPack0,!1,!1),this.myStepper.next()}getPack(t,n,o){this.tarifReady=!1,this.loaderpack=!0,this.errorHandler.error=!1,this.errorHandler.msg="",this.devis.pack=t,this.devis.idPack=t,this.newGaranties=[],this.packService.getPackById(t).subscribe({next:l=>{this.garantieTab=[],this.garantieAll=l.garantie,this.valeurVenale=null!=this.formParamRisque.value?.P40?this.formParamRisque.value?.P40:this.oneRisqueInfo?.find(a=>"P40"==a.codeRisque)?.reponse.valeur,this.DisplayedColumnsSousGarantie=["select","garantie","plafond","franchise","formule","action","more"],this.franchiseExist=!1,this.plafondExist=!1,this.formuleExist=!1,this.groupesPacks=[{group:this.contrat.groupeList[0].idGroupe,pack:l}],this.risqueGroupe[0].idPack=t,this.contratService.getPackIdRisque(this.idContrat,this.contrat.groupeList[0].risques[0].idRisque).subscribe({next:a=>{if("95"==this.route.snapshot.paramMap.get("codeProduit")&&a.garantieList.some(r=>"G53"===r.codeGarantie)){let r=this.garantieAll.map(c=>c.codeGarantie).indexOf("G45");-1!==r&&this.garantieAll.splice(r,1)}else{let r=this.garantieAll.map(c=>c.codeGarantie).indexOf("G53");-1!==r&&this.garantieAll.splice(r,1)}if(!a.garantieList.some(r=>"G51"===r.codeGarantie)){let r=this.garantieAll.map(c=>c.codeGarantie).indexOf("G51");-1!==r&&this.garantieAll.splice(r,1)}this.garantieAll.filter(r=>{let c=[],p=[],m=[];r.sousGarantieList?.filter(f=>{this.sousGarantieExist=!0;let v=[],_=[],g=[];f.categorieList.filter(h=>{switch(h.description){case"plafond":"input valeur venale"==h.descriptionvVal&&"45A"==this.route.snapshot.paramMap.get("codeProduit")&&(h.valeur=this.valeurVenale),v.push(h),this.plafondExist=!0;break;case"formule":_.push(h),this.formuleExist=!0;break;case"franchise":g.push(h),this.franchiseExist=!0}}),this.sousGarantieTab.push({idSousGarantie:f.idSousGarantie,codeSousGarantie:f.codeSousGarantie,idListParamRisque:f.idListParamRisque,idPackComplet:f.idPackComplet,description:f.description,obligatoire:f.obligatoire,prime:"",plafond:v,formule:_,franchise:g})}),r.categorieList.filter(f=>{switch(f.description){case"plafond":"input valeur venale"==f.descriptionvVal&&"45A"==this.route.snapshot.paramMap.get("codeProduit")&&(f.valeur=this.valeurVenale),c.push(f);break;case"formule":p.push(f);break;case"franchise":m.push(f),this.franchiseExist=!0}});let d=a.garantieList?.find(f=>f.idGarantie==r.idGarantie);this.garantieTab.push({idGarantie:r.idGarantie,idPackComplet:r.idPackComplet,codeGarantie:r.codeGarantie,idListParamRisque:r.idListParamRisque,description:r.description,obligatoire:r.obligatoire,primePre:n?Number(d?.prime).toFixed(2):"",prime:"",bonus:"",plafond:c,formule:p,franchise:m,sousGarantieList:new P.by(this.sousGarantieTab)}),this.sousGarantieTab=[]}),this.garantieTab.sort((r,c)=>Number(c.obligatoire)-Number(r.obligatoire)),this.dataSource=new P.by(this.garantieTab),this.formPackGaranties=new u.Oe(this.dataSource.data.map(r=>{let c=a.garantieList?.find(p=>p.idGarantie==r.idGarantie);return new u.cw(n?{idPackComplet:new u.NI(r.idPackComplet),franchise:new u.NI({value:c?.categorieList?.find(p=>18==p.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idfranchise:new u.NI({value:r.franchise,disabled:"input"!=r.franchise.descriptionvVal}),plafond:new u.NI({value:c?.categorieList?.find(p=>7==p.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idplafond:new u.NI({value:r.plafond,disabled:!0}),formule:new u.NI({value:c?.categorieList?.find(p=>19==p.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idformule:new u.NI({value:r.formule,disabled:!0}),checked:new u.NI({value:r.obligatoire||null!=c,disabled:r.obligatoire||!this.avenant?.garantieAffecte||null!=c}),souGarantieArray:new u.Oe(r.sousGarantieList.data.map(p=>{let m=c?.sousGarantieList?.find(d=>d.idSousGarantie==p.idSousGarantie);return new u.cw({idPackComplet:new u.NI(p.idPackComplet),franchise:new u.NI({value:m?.categorieList?.find(d=>18==d.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idfranchise:new u.NI({value:p.franchise,disabled:"input"!=p.franchise.descriptionvVal}),plafond:new u.NI({value:m?.categorieList?.find(d=>7==d.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idplafond:new u.NI({value:p.plafond,disabled:!0}),formule:new u.NI({value:m?.categorieList?.find(d=>19==d.idCategorie)?.valeur,disabled:!this.avenant?.garantieAffecte}),idformule:new u.NI({value:p.formule,disabled:!0}),checked:new u.NI({value:p.obligatoire||null!=m,disabled:p.obligatoire||!this.avenant?.garantieAffecte||null!=m})})}))}:{idPackComplet:new u.NI(r.idPackComplet),franchise:new u.NI({value:"",disabled:!1}),idfranchise:new u.NI({value:r.franchise,disabled:"input"!=r.franchise.descriptionvVal}),plafond:new u.NI({value:"",disabled:!1}),idplafond:new u.NI({value:r.plafond,disabled:!0}),formule:new u.NI({value:"",disabled:!1}),idformule:new u.NI({value:r.formule,disabled:!0}),checked:new u.NI({value:r.obligatoire,disabled:r.obligatoire}),souGarantieArray:new u.Oe(r.sousGarantieList.data.map(p=>new u.cw({idPackComplet:new u.NI(p.idPackComplet),franchise:new u.NI({value:"",disabled:!1}),idfranchise:new u.NI({value:p.franchise,disabled:"input"!=p.franchise.descriptionvVal}),plafond:new u.NI({value:"",disabled:!1}),idplafond:new u.NI({value:p.plafond,disabled:!0}),formule:new u.NI({value:"",disabled:!1}),idformule:new u.NI({value:p.formule,disabled:!0}),checked:new u.NI({value:!0,disabled:p.obligatoire})})))})})),this.formPackGaranties.valueChanges.subscribe(()=>{this.errorPackForm=!1}),this.loadTable=!0,this.loaderpack=!1,o&&this.objectDevis(!0)},error:a=>{this.loaderTarif=!1,this.handleError(a)}})},error:l=>{console.log(l)}})}getContrat(){this.jsonAvenant.packCompletList=[],this.contratService.getContratById(this.idContrat).subscribe({next:t=>{this.contrat=t,this.typeClient=this.contrat?.typeClient?.description,this.minDateRetour=new Date(this.contrat?.dateEffet);const n=new Date;this.maxDateDepart=new Date(n.setFullYear(n.getFullYear()+1)),this.minDateDepart=new Date,this.jsonAvenant.produit=t.produit.idCodeProduit,"S09"==this.contrat.statue.code&&this.redirectConsultation(),null!=this.contrat.convention&&this.getReductionByConvention(this.contrat.convention),this.multiRisqueProduct&&this.contrat.groupeList.map(c=>{(0===this.groupArray.length||!this.groupArray.some(p=>p.idGroupe===c.idGroupe))&&this.groupArray.push({description:c.description,idGroupe:c.idGroupe,idPack:c.pack?.idPack0,descriptionPack:c.pack?.description,new:0})});var l=this.contrat.paramsRisqueContratList?.reduce((c,p)=>{let m=p.idListParamRisque.idListParamRisque;return c.hasOwnProperty(m)?c[m].push(p):c[m]=[p],c},{});l=Object.values(l);var a=[];l.map(c=>{a.push(c.reduce((p,m)=>{let d=m.paramGrp;return p.hasOwnProperty(d)?p[d].push(m):p[d]=[m],p},[]))}),a=Object.values(a);let r=[];a.map(c=>{let m,p={idListParamRisque:"",paramList:[]};c.map(d=>{m={prime:"",paramListsValues:[]},p.idListParamRisque=d[0].idListParamRisque.idListParamRisque;let f={};d.forEach(v=>{let _=v.risque.libelle.split(" ").map(g=>g.charAt(0).toUpperCase()+g.substring(1)).join("");if("Liste of values"===v?.risque?.typeChamp?.description){let g=this.paraRisqueType.find(h=>h.codeParam==v?.risque.codeParam)?.reponses;f={...f,[_]:g.find(h=>h.idParam==v.response.idReponse)}}else if("From Table"==v?.risque?.typeChamp?.description)f={...f,[_]:v.response.description};else if("date"!=v?.risque?.typeChamp?.description)if(34==v.risque.idParamRisque)f={...f,[_]:v.response.description};else if("Marque"==v?.risque?.libelle||"Mod\xe8le"==v?.risque?.libelle){let g=this.paraRisqueType.find(h=>h.codeParam==v?.risque.codeParam)?.reponses;f={...f,[_]:g.find(h=>h.idParam==v.response.idReponse)}}else f={...f,[_]:v.response.description};else f={...f,[_]:v.response.description};m.paramListsValues.push({idParam:v.risque.idParamRisque,reponse:v.response})}),this.dataSourceListParamRisque.push(f),m.prime=this.contrat.listPrimes?.find(v=>v.idListParamRisque==d[0].idListParamRisque.idListParamRisque&&v.paramGrp==d[0].paramGrp)?.prime,p.paramList.push(m)}),r.push(p)}),this.getParamAvenant(),this.devis.list=r,this.PrimeTotale=this.contrat?.primeList?.find(c=>101==c.typePrime?.idParam)?.prime,this.ancientPack=this.contrat.groupeList,this.getAllConventions(),this.getAllReductions(),t.convention&&(this.defaultConvention=t.convention,this.formReduction?.get("convention")?.setValue(t.convention)),t.reduction&&(this.defaultReduction=t.reduction,this.formReduction?.get("reduction")?.setValue(t.reduction))},error:t=>{console.log(t)}})}getIdPays(t){this.genericService.getPays().subscribe({next:n=>{this.idPays=n.find(o=>o.codePays==t).idPays,this.getWilaya()},error:n=>{console.log(n)}})}getWilaya(){this.genericService.getAllWilayas(this.idPays).subscribe({next:t=>{this.wilayas=t},error:t=>{console.log(t)}})}getCommune(t,n){this.genericService.getAllCommuneByWilaya(t).subscribe({next:o=>{switch(n){case"Souscripteur":this.communes_sous=o;break;case"Assure":this.communes_assure=o;break;case"Conducteur":this.communes_cond=o}},error:o=>{console.log(o)}})}getGenre(){this.genericService.getParam(JSON.parse(sessionStorage.getItem("dictionnaire")||"{}").find(t=>"C6"==t.code).idCategorie).subscribe({next:t=>{this.genres=t},error:t=>{console.log(t)}})}getSituation(){this.genericService.getParam(JSON.parse(sessionStorage.getItem("dictionnaire")||"{}").find(t=>"C1"==t.code).idCategorie).subscribe({next:t=>{this.situations=t},error:t=>{console.log(t)}})}getProfession(){this.genericService.getProfession().subscribe({next:t=>{this.professions=t},error:t=>{console.log(t)}})}getMarque(){this.vehiculeService.getAllMarque().subscribe({next:t=>{this.marques=t},error:t=>{console.log(t)}})}getModeleByMarque(t){this.vehiculeService.getModelByMarque(t).subscribe({next:n=>{this.modeles=n},error:n=>{console.log(n)}})}changeRoleClient(t,n){if(t)switch(n){case"Souscripteur":this.isAssure=!0,this.formCreationSouscripteur=this.formCreationAssure,this.getCommune(this.formCreationAssure.value.wilaya,"Souscripteur");break;case"Conducteur":this.isConducteur=!0,this.isConducteurAssure=!1,this.formCreationConducteur=this.formBuilder.group({codeClient:[""==this.formCreationSouscripteur?.value?.codeClient?null:{value:this.formCreationSouscripteur?.value?.codeClient,disabled:!0}],nom:[""==this.formCreationSouscripteur?.value?.nom?null:{value:this.formCreationSouscripteur?.value?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[""==this.formCreationSouscripteur?.value?.prenom?null:{value:this.formCreationSouscripteur?.value?.prenom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[""==this.formCreationSouscripteur?.value?.dateNaissance?null:{value:this.formCreationSouscripteur?.value?.dateNaissance,disabled:"A21"!=this.avenant.code}],telephone:[{value:this.formCreationSouscripteur?.value?.telephone,disabled:!1},[u.kI.required,u.kI.minLength(this.formCreationSouscripteur?.value?.telephone.length),u.kI.maxLength(this.formCreationSouscripteur?.value?.telephone.length)]],email:[{value:this.formCreationSouscripteur?.value?.email,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:this.formCreationSouscripteur?.value?.adresse,disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:this.formCreationSouscripteur?.value?.wilaya,disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:this.formCreationSouscripteur?.value?.commune,disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:this.formCreationSouscripteur?.value?.situation,disabled:!1}],profession:[{value:this.formCreationSouscripteur?.value?.profession,disabled:!1},[u.kI.required]],numeroPermis:[{value:"",disabled:"A21"!=this.avenant.code},[u.kI.required]],categoriePermis:[{value:"",disabled:!1},[u.kI.required]]}),this.getCommune(this.formCreationConducteur.value.wilaya,"Conducteur");break;case"ConducteurAssure":this.isConducteurAssure=!0,this.isConducteur=!1,this.formCreationConducteur=this.formBuilder.group({codeClient:[""==this.formCreationAssure?.get("codeClient")?.value?null:{value:this.formCreationAssure?.get("codeClient")?.value,disabled:!0}],nom:[""==this.formCreationAssure?.get("nom")?.value?null:{value:this.formCreationAssure?.get("nom")?.value,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[""==this.formCreationAssure?.get("prenom")?.value?null:{value:this.formCreationAssure?.get("prenom")?.value,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[""==this.formCreationAssure?.get("dateNaissance")?.value?null:{value:this.formCreationAssure?.get("dateNaissance")?.value,disabled:"A21"!=this.avenant.code}],telephone:[{value:this.formCreationAssure?.get("telephone")?.value,disabled:!1},[u.kI.required,u.kI.minLength(this.formCreationAssure?.get("telephone")?.value.length),u.kI.maxLength(this.formCreationAssure?.get("telephone")?.value.length)]],email:[{value:this.formCreationAssure?.get("email")?.value,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:this.formCreationAssure?.get("adresse")?.value,disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:this.formCreationAssure?.get("wilaya")?.value,disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:this.formCreationAssure?.get("commune")?.value,disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:this.formCreationAssure?.get("situation")?.value,disabled:!1}],profession:[{value:this.formCreationAssure?.get("profession")?.value,disabled:!1},[u.kI.required]],numeroPermis:[{value:"",disabled:"A21"!=this.avenant.code},[u.kI.required]],categoriePermis:[{value:"",disabled:!1},[u.kI.required]]}),this.getCommune(this.formCreationConducteur.value.wilaya,"Conducteur")}else switch(n){case"Souscripteur":this.isAssure=!1,this.formCreationSouscripteur=this.formBuilder.group({codeClient:[""==this.souscripteur?.idClient||"A21"==this.avenant.code?null:this.souscripteur?.idClient],nom:["A21"==this.avenant.code?"":this.souscripteur?.nom,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:["A21"==this.avenant.code?"":this.souscripteur?.prenom1,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:["A21"==this.avenant.code?"":this.souscripteur?.dateNaissance,[u.kI.required,Z]],nin:[{value:"A21"==this.avenant.code?"":this.souscripteur?.nin,disabled:!1},[u.kI.pattern(C.e.NIN)]],telephone:[{value:"A21"==this.avenant.code?"":this.souscripteur?.contactList?.find(o=>"CNT1"==o?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:"A21"==this.avenant.code?"":this.souscripteur?.contactList?.find(o=>"CNT2"==o?.typeContact?.code)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:"A21"==this.avenant.code?"":0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList[0].description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:"A21"==this.avenant.code?"":0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList[0].wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:"A21"==this.avenant.code?"":0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList[0].commune?.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],genre:[{value:"A21"==this.avenant.code?"":this.souscripteur?.sexe?.idParam,disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:"A21"==this.avenant.code?"":this.souscripteur?.situationFamiliale?.idParam,disabled:!1}],profession:[{value:"A21"==this.avenant.code?"":0!=this.souscripteur?.professionSecteurList?.length&&this.souscripteur?.professionSecteurList?this.souscripteur?.professionSecteurList[0]?.profession?.idProfession:"",disabled:!1}]});break;case"Conducteur":this.isConducteur=!1,this.formCreationConducteur=this.formBuilder.group({codeClient:[""==this.conducteur?.idClient||"A21"==this.avenant.code?null:{value:this.conducteur?.idClient,disabled:!0}],nom:[{value:"A21"==this.avenant.code?"":this.conducteur?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[{value:"A21"==this.avenant.code?"":this.conducteur?.prenom1,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[{value:"A21"==this.avenant.code?"":this.conducteur?.dateNaissance,disabled:"A21"!=this.avenant.code},[u.kI.required,Z]],telephone:[{value:"A21"==this.avenant.code?"":this.conducteur?.contactList?.find(o=>"CNT1"==o?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:"A21"==this.avenant.code?"":this.conducteur?.contactList?.find(o=>"CNT2"==o?.typeContact?.icode)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].commune?.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:"A21"==this.avenant.code?"":this.conducteur?.situationFamiliale?.idParam,disabled:!1}],profession:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.professionSecteurList[0].profession?.idProfession:"",disabled:!1}],numeroPermis:[{value:"A21"==this.avenant.code?"":this.conducteur?.documentList.find(o=>"D02"==o?.typeDocument?.code)?.description,disabled:"A21"!=this.avenant.code},[u.kI.required]],categoriePermis:[{value:"A21"==this.avenant.code?"":this.conducteur?.documentList.find(o=>"D02"==o?.typeDocument?.code)?.sousCategorie,disabled:!1},[u.kI.required]]});break;case"ConducteurAssure":this.isConducteurAssure=!1,this.formCreationConducteur=this.formBuilder.group({codeClient:[""==this.conducteur?.idClient||"A21"==this.avenant.code?null:{value:this.conducteur?.idClient,disabled:!0}],nom:[{value:"A21"==this.avenant.code?"":this.conducteur?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[{value:"A21"==this.avenant.code?"":this.conducteur?.prenom1,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[{value:"A21"==this.avenant.code?"":this.conducteur?.dateNaissance,disabled:"A21"!=this.avenant.code},[u.kI.required,Z]],telephone:[{value:"A21"==this.avenant.code?"":this.conducteur?.contactList?.find(o=>"CNT1"==o?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:"A21"==this.avenant.code?"":this.conducteur?.contactList?.find(o=>"CNT2"==o?.typeContact?.code)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].commune?.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:"A21"==this.avenant.code?"":this.conducteur?.situationFamiliale?.idParam,disabled:!1}],profession:[{value:"A21"==this.avenant.code?"":0!=this.conducteur?.adressesList?.length?this.conducteur?.professionSecteurList[0].profession?.idProfession:"",disabled:!1}],numeroPermis:[{value:"A21"==this.avenant.code?"":this.conducteur?.documentList.find(o=>"D02"==o?.typeDocument?.code)?.description,disabled:"A21"!=this.avenant.code},[u.kI.required]],categoriePermis:[{value:"A21"==this.avenant.code?"":this.conducteur?.documentList.find(o=>"D02"==o?.typeDocument?.code)?.sousCategorie,disabled:!1},[u.kI.required]]})}}onChangeDateDepart(t){const n=new Date(this.contrat.dateEffet),a=(new Date(this.contrat.dateExpiration).getTime()-n.getTime())/864e5,r=new Date(t.value);r.setDate(r.getDate()+a),this.formParamRisque.get("P212")?.setValue(r)}getParamAvenant(){this.avenantService.getAvenantById(this.idTypeAvenant).subscribe({next:t=>{if(this.avenant=t,"A25"==this.avenant.code&&(this.jsonAvenant.nouveau=!0,this.contrat.groupeList[0].risques.map(o=>{this.getParamContratByIdRisque(o.idRisque)})),this.avenant.dateOuverte&&this.formApplicationAvenant?.get("dateAvenant")?.enable(),"A18"!=this.avenant?.code&&"A13"!=this.avenant?.code)"A21"!=this.avenant?.code?(this.formReduction?.get("convention")?.disable(),this.formReduction?.get("reduction")?.disable()):(this.formReduction?.get("convention")?.enable(),this.formReduction?.get("reduction")?.enable());else{let o=new Date>new Date(new Date(this.contrat.dateExpiration).getTime()+864e5)?new Date:new Date(new Date(this.contrat.dateExpiration).getTime()+864e5);this.formApplicationAvenant?.get("dateAvenant")?.setValue(o),this.formApplicationAvenant?.get("dateAvenant")?.enable(),this.getDateExpiration(this.contrat?.duree?.id_duree),this.formReduction?.get("convention")?.enable(),this.formReduction?.get("reduction")?.enable()}if(this.reductionExist=t.reduction,this.multiRisqueAvenant=this.avenant.multirisque,console.log("this.reductionExist ",this.reductionExist),this.multiRisqueAvenant?("A11"==this.avenant.code&&(this.risquesInvolved=[this.risquesInvolved]),this.risquesInvolved.length>1?this.dataSourceConsultRisque=new P.by(this.risquesInvolved):(this.dataSourceConsultRisque=new P.by,this.dataSourceConsultRisque.data=[],this.dataSourceConsultRisque.data.push(this.risquesInvolved[0]))):this.multiRisqueProduct||(this.risquesInvolved=[{idGroupe:this.contrat.groupeList[0].idGroupe,description:this.contrat.groupeList[0].description,idRisque:this.contrat.groupeList[0].risques[0].idRisque}],this.groupesPacks=[{group:this.contrat.groupeList[0].idGroupe,pack:this.contrat.groupeList[0].pack}]),this.displayedColumns="A13"==this.avenant?.code&&"45A"==this.codeProduit?["select","garantie","plafond","franchise","formule","prime","bonus","action","sousGarantie"]:["select","garantie","plafond","franchise","formule","action","sousGarantie"],this.formApplicationAvenant.addControl("agence",new u.NI(this.contrat?.agence.idAgence,[u.kI.required])),this.avenant?.duree&&this.formApplicationAvenant.addControl("duree",new u.NI(this.contrat?.duree.id_duree,[u.kI.required])),("A18"==this.avenant?.code||"A21"==this.avenant?.code)&&this.formApplicationAvenant.get("duree")?.disable(),"A21"==this.avenant?.code&&this.formApplicationAvenant.get("agence")?.disable(),(0!=this.avenant?.paramRisque?.length&&"A08"!=this.avenant?.code||this.avenant?.packAffecte||this.avenant?.garantieAffecte)&&(this.calcul=!0),this.multiRisqueProduct&&0!=this.avenant?.paramRisque?.length&&(this.dataSourceParamRisque=new P.by(this.risquesInvolved),this.dataSourceParamRisque.paginator=this.paginator),this.avenant?.attestation&&"45L"!=this.codeProduit&&this.formApplicationAvenant.addControl("attestation",new u.NI("",[u.kI.required])),this.avenant.attributs.forEach(o=>{let l;if("A13"!=this.avenant.code&&"A18"!=this.avenant.code||"dateEffet"!=o.idAtrribut.nomBdd?"A24"==this.avenant.code||(l=new Date):l=new Date>new Date(new Date(this.contrat.dateExpiration).getTime()+864e5)?new Date:new Date(new Date(this.contrat.dateExpiration).getTime()+864e5),this.formApplicationAvenant.addControl(o.idAtrribut.nomBdd,new u.NI("date"==o?.idAtrribut?.type?.description?{value:l,disabled:o.idAtrribut.figee}:{value:"",disabled:o.idAtrribut.figee})),("A13"==this.avenant.code||"A18"==this.avenant.code)&&"dateEffet"==o.idAtrribut.nomBdd&&this.getDateExpiration(this.contrat?.duree?.id_duree),"A24"==this.avenant.code||"A25"==this.avenant.code){let a=this.avenant.attributs.filter(r=>"dateExpiration"==r.idAtrribut.nomBdd)[0].idAtrribut.nomBdd;this.formApplicationAvenant.get(a)?.setValue(this.contrat.dateExpiration),a=this.avenant.attributs.filter(r=>"dateEffet"==r.idAtrribut.nomBdd)[0].idAtrribut.nomBdd,this.formApplicationAvenant.get(a)?.setValue(this.contrat.dateEffet),this.formApplicationAvenant.get(a)?.disable()}}),this.avenant.attributs.reverse(),this.multiRisqueProduct){const o=new Date(this.contrat.dateEffet);new Date(this.contrat.dateExpiration).getTime(),o.getTime();let p,c=this.contrat.groupeList[0].pack.idPack0;this.avenant.paramRisque.forEach(m=>{"Liste of values"==m?.paramRisque?.typeChamp?.description?this.formParamRisque.addControl(m?.paramRisque?.codeParam,new u.NI({value:p?.idParamReponse?.idParam,disabled:m.grise},[u.kI.required])):("From Table"==m?.paramRisque?.typeChamp?.description&&null==m.paramRisque.paramRisqueParent&&("P182"==m.paramRisque.codeParam?this.packService.getDestinationFromPack(c).subscribe({next:d=>{m.paramRisque.reponses=d},error:d=>{console.log(d)}}):this.paramRisqueService.getTableParamParent(m.paramRisque.idParamRisque).subscribe({next:d=>{m.paramRisque.reponses="P279"==m.paramRisque.codeParam?d.filter(f=>1==f.is_professionnel):d},error:d=>{console.log(d)}})),"P25"==p?.paramRisque?.codeParam?(this.getModeleByMarque(p?.idParamReponse?.idParam),this.formParamRisque.addControl(m?.paramRisque?.codeParam,new u.NI({value:""+p?.idParamReponse?.idParam,disabled:m.grise},[u.kI.required]))):this.formParamRisque.addControl(m?.paramRisque?.codeParam,new u.NI("P26"==p?.paramRisque?.codeParam?{value:""+p?.idParamReponse?.idParam,disabled:m.grise}:{value:p?.valeur,disabled:m.grise},[u.kI.required])))}),this.formParamRisque.addControl("groupe",new u.NI("",[])),this.formParamRisque.addControl("newGroupe",new u.NI("",[])),this.formRisqueReady=!0}else this.contratService.getParamContratByIdRisque(this.contrat.idContrat,this.contrat.groupeList[0].idGroupe,this.contrat.groupeList[0].risques[0].idRisque).subscribe({next:o=>{let l;this.oneRisqueInfo=o,this.avenant.paramRisque.forEach(a=>{l=o.find(r=>r?.codeRisque==a?.paramRisque?.codeParam),"Liste of values"==l?.typeChamp?(this.formParamRisque.addControl(a?.paramRisque?.codeParam,new u.NI({value:l?.reponse?.idParamReponse.idParam,disabled:a.grise},[u.kI.required])),this.getRelation(a?.paramRisque?.typeChamp,a.paramRisque.isParent,a.paramRisque.idParamRisque,l?.reponse?.idParamReponse?.idParam)):("From Table"==l?.typeChamp&&null==a.paramRisque.paramRisqueParent&&this.paramRisqueService.getTableParamParent(a.paramRisque.idParamRisque).subscribe({next:r=>{a.paramRisque.reponses="P279"==a.paramRisque.codeParam?r.filter(c=>1==c.is_professionnel):r},error:r=>{console.log(r)}}),"P25"==l?.codeRisque?(this.getModeleByMarque(l?.reponse?.idParamReponse.idParam),this.formParamRisque.addControl(a?.paramRisque?.codeParam,new u.NI({value:""+l?.reponse?.idParamReponse.idParam,disabled:a.grise},[u.kI.required]))):this.formParamRisque.addControl(a?.paramRisque?.codeParam,"P26"==l?.codeRisque?new u.NI({value:""+l?.reponse?.idParamReponse.idParam,disabled:a.grise},[u.kI.required]):new u.NI({value:l?.reponse.valeur,disabled:a.grise},"96"==this.codeProduit&&"A07"==this.avenant?.code?[u.kI.required,u.kI.min(l?.reponse.valeur)]:[u.kI.required]))),this.paraRisqueType.map(r=>{this.formParamRisque.get(r.codeParam)&&(r.valeurMin&&this.formParamRisque.get(r.codeParam)?.addValidators([u.kI.min(r?.valeurMin)]),r.valeurMax&&this.formParamRisque.get(r.codeParam)?.addValidators([u.kI.max(r?.valeurMax)]),0!=r.sizeChamp&&null!=r.sizeChamp?this.formParamRisque.get(r.codeParam)?.addValidators([u.kI.minLength(r.sizeChamp),u.kI.maxLength(r.sizeChamp)]):r.obligatoire&&this.formParamRisque.get(r.codeParam)?.addValidators([u.kI.required]))})}),this.formRisqueReady=!0},error:o=>{console.log(o)}});this.paraRisqueProduitCategory=this.avenant.paramRisque.reduce((o,l)=>((o[l.paramRisque.categorieParamRisque.description]=o[l.paramRisque.categorieParamRisque.description]||[]).push(l),o),{}),this.paraRisqueProduitCategory=Object.values(this.paraRisqueProduitCategory),this.paraRisqueProduitCategory.map(o=>{o.sort((l,a)=>l.paramRisque.orderChamp<a.paramRisque.orderChamp?-1:1)}),this.initForm(),this.multiRisqueProduct||this.getPack(this.contrat.groupeList[0].pack.idPack0,!0,!1),this.risquesInvolved.length>1&&(this.groupesInvolved=this.risquesInvolved.reduce((o,l)=>(o[l.idGroupe]||(o[l.idGroupe]=[]),o[l.idGroupe].push(l),o),{}));let n=[];if(this.risquesInvolved.length>1&&this.multiRisqueAvenant){let o=[];Object.keys(this.groupesInvolved).map(a=>{this.contrat.groupeList.map(r=>{a==r.idGroupe&&(o.push({idGroupe:r.idGroupe,descriptionGroupe:r.description,pack:r.pack.idPack0,newGroupe:1}),this.groupesInvolved[a].pack=r.pack.idPack0)})}),this.dataSourceGroupePack=new P.by(o),Object.keys(this.groupesInvolved).map(a=>{this.groupesInvolved[a].map(r=>{n.push({risque:{idRisque:r.idRisque}})}),this.risqueGroupe.push({idGroupe:a,description:"",idPack:this.groupesInvolved[a].pack,groupeList:n}),n=[]})}else if(1==this.risquesInvolved.length){let o=0,l=[];this.contrat.groupeList.map(a=>{this.risquesInvolved[0].idGroupe==a.idGroupe&&(l.push({idGroupe:a.idGroupe,descriptionGroupe:a.description,pack:a.pack.idPack0,newGroupe:1}),o=a.pack.idPack0)}),this.dataSourceGroupePack=new P.by(l),n.push({risque:{idRisque:this.risquesInvolved[0].idRisque}}),this.risqueGroupe.push({idGroupe:this.risquesInvolved[0].idGroupe,description:"",idPack:o,groupeList:n})}"A23"===this.avenant.code&&this.contratService.getParamContratByIdRisque(this.contrat.idContrat,this.contrat.groupeList[0].idGroupe,this.contrat.groupeList[0].risques[0].idRisque).subscribe({next:o=>{this.formParamRisque.patchValue({P182:o.find(l=>"P182"===l.codeRisque).reponse.valeur,groupe:"",newGroupe:""})},error:o=>{console.log(o)}})},error:t=>{console.log(t)}})}initForm(){this.contrat?.personnesList?.forEach(t=>{switch(t?.personne?.contactList?.forEach(n=>{"CNT1"==n.typeContact.code&&n.description.startsWith("0")&&(n.description=n.description.substring(1))}),t?.role?.code){case"CP233":this.conducteur=t?.personne,this.getCommune(this.conducteur?.adressesList[0].wilaya?.idWilaya,"Conducteur");break;case"CP234":this.souscripteur=t?.personne,this.getCommune(this.souscripteur?.adressesList[0].wilaya?.idWilaya,"Souscripteur");break;case"CP235":this.assure=t?.personne,this.getCommune(this.assure?.adressesList[0].wilaya?.idWilaya,"Assure");break;case"CP236":this.souscripteur=t?.personne,this.assure=t?.personne,this.isAssure=!0,this.getCommune(this.souscripteur?.adressesList[0].wilaya?.idWilaya,"Souscripteur"),this.getCommune(this.assure?.adressesList[0].wilaya?.idWilaya,"Assure");break;case"CP237":this.souscripteur=t?.personne,this.conducteur=t?.personne,this.isConducteur=!0,this.getCommune(this.conducteur?.adressesList[0].wilaya?.idWilaya,"Conducteur"),this.getCommune(this.souscripteur?.adressesList[0].wilaya?.idWilaya,"Souscripteur");break;case"CP240":this.assure=t?.personne,this.conducteur=t?.personne,this.isConducteurAssure=!0,this.getCommune(this.conducteur?.adressesList[0].wilaya?.idWilaya,"Conducteur"),this.getCommune(this.assure?.adressesList[0].wilaya?.idWilaya,"Assure");break;case"CP238":this.souscripteur=t?.personne,this.assure=t?.personne,this.conducteur=t?.personne,this.isAssure=!0,this.isConducteurAssure=!0,this.getCommune(this.conducteur?.adressesList[0].wilaya?.idWilaya,"Conducteur"),this.getCommune(this.souscripteur?.adressesList[0].wilaya?.idWilaya,"Souscripteur"),this.getCommune(this.assure?.adressesList[0].wilaya?.idWilaya,"Assure")}}),this.formCreationSouscripteur=this.formBuilder.group({codeClient:[""==this.souscripteur?.idClient?null:this.souscripteur?.idClient],nom:[this.souscripteur?.nom,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[this.souscripteur?.prenom1,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[this.souscripteur?.dateNaissance,[u.kI.required,Z]],nin:[{value:this.souscripteur?.nin,disabled:!1},[u.kI.pattern(C.e.NIN)]],telephone:[{value:this.souscripteur?.contactList?.find(t=>"CNT1"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:this.souscripteur?.contactList?.find(t=>"CNT2"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList?.[0]?.description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList?.[0]?.wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:0!=this.souscripteur?.adressesList?.length?this.souscripteur?.adressesList?.[0]?.commune?.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],genre:[{value:this.souscripteur?.sexe?.idParam,disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:this.souscripteur?.situationFamiliale?.idParam,disabled:!1}],profession:[{value:0!=this.souscripteur?.professionSecteurList?.length&&this.souscripteur?.professionSecteurList?this.souscripteur?.professionSecteurList[0]?.profession?.idProfession:"",disabled:!1}]}),this.formCreationAssure=this.formBuilder.group("A17"==this.avenant.code?{codeClient:[""==this.assure?.idClient?null:this.assure?.idClient],raisonSocial:[{value:this.assure?.raisonSocial,disabled:!1},"personne physique"==this.typeClient?[]:[u.kI.required,u.kI.maxLength(40)]],nom:[{value:this.assure?.nom,disabled:!1},"personne physique"==this.typeClient?[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]:[]],prenom:[{value:this.assure?.prenom1,disabled:!1},"personne physique"==this.typeClient?[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]:[]],dateOuverture:[{value:this.assure?.dateOuverture,disabled:!0}],dateNaissance:[{value:this.assure?.dateNaissance,disabled:!0},[u.kI.required,Z]],nin:[{value:this.assure?.nin,disabled:!0},[u.kI.pattern(C.e.NIN)]],nif:[{value:this.assure?.nif,disabled:!0},"personne physique"==this.typeClient?[u.kI.pattern(C.e.NIF)]:[u.kI.required,u.kI.pattern(C.e.NIF)]],telephone:[{value:this.assure?.contactList?.find(t=>"CNT1"==t?.typeContact?.code)?.description,disabled:!0},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:this.assure?.contactList?.find(t=>"CNT2"==t?.typeContact?.code)?.description,disabled:!0},[u.kI.pattern(C.e.email)]],adresse:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].description:"",disabled:!0},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].wilaya?.idWilaya:"",disabled:!0},[u.kI.required]],commune:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].commune?.idCommune:"",disabled:!0},[u.kI.required]],genre:[{value:this.assure?.sexe?.idParam,disabled:!0},[u.kI.required]],situation:[{value:this.assure?.situationFamiliale?.idParam,disabled:!0}],rib:[{value:0!=this.assure?.adressesList?.length?this.assure?.payment[0]?.donneBancaire?.description:"",disabled:!0},[u.kI.pattern(C.e.RIB)]]}:{codeClient:[""==this.assure?.idClient?null:this.assure?.idClient],typeClient:[this.contrat?.typeClient.idParam],raisonSocial:[{value:this.assure?.raisonSocial,disabled:!0},"personne physique"==this.typeClient?[]:[u.kI.required,u.kI.maxLength(40)]],nom:[{value:this.assure?.nom,disabled:"A21"!=this.avenant.code},"personne physique"==this.typeClient?[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]:[]],prenom:[{value:this.assure?.prenom1,disabled:"A21"!=this.avenant.code},"personne physique"==this.typeClient?[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]:[]],dateOuverture:[{value:this.assure?.dateOuverture,disabled:"A21"!=this.avenant.code}],dateNaissance:[{value:this.assure?.dateNaissance,disabled:"A21"!=this.avenant.code},[u.kI.required,Z]],nin:[{value:this.assure?.nin,disabled:"A21"!=this.avenant.code},[u.kI.pattern(C.e.NIN)]],nif:[{value:this.assure?.nif,disabled:"A21"!=this.avenant.code},"personne physique"==this.typeClient?[u.kI.pattern(C.e.NIF)]:[u.kI.required,u.kI.pattern(C.e.NIF)]],telephone:[{value:this.assure?.contactList?.find(t=>"CNT1"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:this.assure?.contactList?.find(t=>"CNT2"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].wilaya?.idWilaya:"",disabled:!1},[u.kI.required]],commune:[{value:0!=this.assure?.adressesList?.length?this.assure?.adressesList[0].commune?.idCommune:"",disabled:!1},[u.kI.required]],genre:[{value:this.assure?.sexe?.idParam,disabled:"A21"!=this.avenant.code},[u.kI.required]],situation:[{value:this.assure?.situationFamiliale?.idParam,disabled:!1}],rib:[{value:0!=this.assure?.adressesList?.length?this.assure?.payment[0]?.donneBancaire?.description:"",disabled:!1},[u.kI.pattern(C.e.RIB)]]}),"personne physique"==this.typeClient&&this.formCreationAssure.addControl("profession",new u.NI({value:0!=this.assure?.professionSecteurList.length?this.assure?.professionSecteurList[0].profession?.idProfession:"",disabled:"A17"==this.avenant.code})),"45A"==this.codeProduit&&(this.formCreationConducteur=this.formBuilder.group({codeClient:[""==this.conducteur?.idClient?null:{value:this.conducteur?.idClient,disabled:!0}],nom:[{value:this.conducteur?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[{value:this.conducteur?.prenom1,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[{value:this.conducteur?.dateNaissance,disabled:"A21"!=this.avenant.code},[u.kI.required,Z]],telephone:[{value:this.conducteur?.contactList?.find(t=>"CNT1"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.required,u.kI.pattern(C.e.mobile)]],email:[{value:this.conducteur?.contactList?.find(t=>"CNT2"==t?.typeContact?.code)?.description,disabled:!1},[u.kI.pattern(C.e.email)]],adresse:[{value:0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0]?.description:"",disabled:!1},[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:0!=this.conducteur?.adressesList?.length?this.conducteur?.adressesList[0].commune?.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[{value:this.conducteur?.situationFamiliale?.idParam,disabled:!1}],profession:[{value:this.conducteur?.professionSecteurList&&0!=this.conducteur?.professionSecteurList?.length?this.conducteur?.professionSecteurList[0]?.profession?.idProfession:"",disabled:!1}],numeroPermis:[{value:this.conducteur?.documentList.filter(t=>"D02"==t?.typeDocument?.code)[0==this.conducteur?.documentList.length?this.conducteur?.documentList.length:this.conducteur?.documentList.length-1]?.description,disabled:"A21"!=this.avenant.code},[u.kI.required]],categoriePermis:[{value:this.conducteur?.documentList.filter(t=>"D02"==t?.typeDocument?.code)[0==this.conducteur?.documentList.length?this.conducteur?.documentList.length:this.conducteur?.documentList.length-1]?.sousCategorie,disabled:!1},[u.kI.required]]}))}recherchePersonne(t){let n;switch(t){case"souscripteur":this.formCreationSouscripteur.get("codeClient").setValue(null),this.formCreationSouscripteur.get("dateNaissance").setValue(x(this.formCreationSouscripteur.get("dateNaissance").value).format("YYYY-MM-DDT00:00:00.000+00:00")),n=this.formCreationSouscripteur.value;break;case"assure":this.formCreationAssure.get("codeClient").setValue(null),"personne physique"==this.typeClient&&this.formCreationAssure.get("dateNaissance").setValue(x(this.formCreationAssure.get("dateNaissance").value).format("YYYY-MM-DDT00:00:00.000+00:00")),n=this.formCreationAssure.value;break;case"Conducteur":this.formCreationConducteur.get("codeClient").setValue(null),this.formCreationConducteur.get("dateNaissance").setValue(this.formCreationConducteur.get("dateNaissance").value),n=this.formCreationConducteur.value}this.personneService.filterPersonne(n).subscribe(o=>{if(0==o.length)switch(R().fire("Cette personne n'existe pas","","info"),t){case"souscripteur":this.formCreationSouscripteur.get("codeClient")?.setValue(null),this.formCreationSouscripteur.enable();break;case"assure":this.formCreationAssure.get("codeClient")?.setValue(null),this.formCreationAssure.enable(),"A17"==this.avenant.code&&this.formCreationAssure.get("dateNaissance").disable();break;case"Conducteur":this.formCreationConducteur.get("codeClient")?.setValue(null),this.formCreationConducteur.enable(),this.avenant.paramRisque.map(l=>{"Conducteur"==l.category&&this.formParamRisque.get(l.paramRisque?.codeParam)?.enable()})}else this.dialog.open(de.I,{width:"60%",disableClose:!0,data:{personneList:o}}).afterClosed().subscribe(a=>{this.personne=a,this.initFormPersonne(t)})})}initFormPersonne(t){switch(this.formCreation=this.formBuilder.group({codeClient:[""==this.personne?.idClient?null:this.personne?.idClient],raisonSocial:[""==this.personne?.raisonSocial?null:this.personne?.raisonSocial],nom:[{value:""==this.personne?.nom?null:this.personne?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[{value:""==this.personne?.prenom1?null:this.personne?.prenom1,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[""==this.personne?.dateNaissance?null:this.personne?.dateNaissance],nin:[""==this.personne?.nin?null:this.personne?.nin],idTelephone:[null],telephone:[null,[u.kI.required,u.kI.pattern(C.e.mobile)]],idEmail:[null],email:[null,[u.kI.pattern(C.e.email)]],idAdresse:[this.personne?.adressesList[0]?this.personne?.adressesList[0].idAdresse:0],adresse:[this.personne?.adressesList[0]?this.personne?.adressesList[0].description:"",[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:this.personne?.adressesList[0]?this.personne?.adressesList[0].wilaya?.idWilaya:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:this.personne?.adressesList[0]?this.personne?.adressesList[0].commune.idCommune:"",disabled:"A17"==this.avenant.code},[u.kI.required]],genre:[{value:this.personne?.sexe?.idParam,disabled:"A17"==this.avenant.code}],situation:[this.personne?.situationFamiliale?.idParam],rib:["",[u.kI.pattern(C.e.RIB)]]}),this.personne?.contactList?.forEach(n=>{switch(n.typeContact?.description){case"mobile":this.formCreation.get("idTelephone").value=n.idContact,this.formCreation.get("telephone").value=n.description;break;case"email":this.formCreation.get("idEmail").value=n.idContact,this.formCreation.get("email").value=n.description}}),t){case"souscripteur":this.getCommune(this.formCreation.value.wilaya,"Souscripteur"),this.formCreation.get("dateNaissance").setValue(x(this.formCreation.get("dateNaissance").value).format("YYYY-MM-DD")),this.formCreationSouscripteur=this.formCreation,this.formCreationSouscripteur.get("dateNaissance")?.setValidators([u.kI.required]),this.formCreationSouscripteur.get("genre")?.setValidators([u.kI.required]),this.formCreationSouscripteur.addControl("nif",new u.NI(this.personne?.nif,u.kI.pattern(C.e.NIF))),this.formCreationSouscripteur.addControl("idProfession",new u.NI(this.personne?.professionSecteurList[0]?this.personne?.professionSecteurList[0].id:"")),this.formCreationSouscripteur.addControl("profession",new u.NI(this.personne?.professionSecteurList[0]?this.personne?.professionSecteurList[0].profession?.idProfession:"")),this.formCreationSouscripteur.get("dateNaissance").updateValueAndValidity(),this.formCreationSouscripteur.get("genre").updateValueAndValidity();break;case"assure":this.getCommune(this.formCreation.value.wilaya,"Assure"),"personne physique"==this.typeClient&&(this.formCreation.get("dateNaissance").setValue(x(this.formCreation.get("dateNaissance").value).format("YYYY-MM-DD")),this.formCreation.get("dateNaissance").disable()),this.formCreationAssure=this.formCreation,this.formCreationAssure.addControl("nif",new u.NI(this.personne?.nif,u.kI.pattern(C.e.NIF))),"personne physique"==this.typeClient&&(this.formCreationAssure.addControl("idProfession",new u.NI(this.personne?.professionSecteurList[0]?this.personne?.professionSecteurList[0].id:"")),this.formCreationAssure.addControl("profession",new u.NI(this.personne?.professionSecteurList[0]?this.personne?.professionSecteurList[0].profession?.idProfession:"")),this.formCreationAssure.get("dateNaissance")?.setValidators([u.kI.required]),this.formCreationAssure.get("dateNaissance").updateValueAndValidity(),this.formCreationAssure.get("genre")?.setValidators([u.kI.required]),this.formCreationAssure.get("genre").updateValueAndValidity());break;case"Conducteur":this.getCommune(this.formCreation.value.wilaya,"Conducteur"),this.formCreation.get("dateNaissance").setValue(x(this.formCreation.get("dateNaissance").value).format("YYYY-MM-DD")),this.formCreationConducteur=this.formCreation,this.formCreationConducteur.addControl("idProfession",new u.NI(this.personne?.professionSecteurList[0]?{value:this.personne?.professionSecteurList[0].id,disabled:!1}:{value:"",disabled:!1})),this.formCreationConducteur.addControl("profession",new u.NI(this.personne?.professionSecteurList[0]?{value:this.personne?.professionSecteurList[0].profession?.idProfession,disabled:!1}:{value:"",disabled:!1})),this.formCreationConducteur.addControl("numeroPermis",new u.NI({value:"",disabled:"A21"!=this.avenant.code},[u.kI.required])),this.formCreationConducteur.addControl("categoriePermis",new u.NI({value:"",disabled:!1},[u.kI.required])),this.avenant.paramRisque.map(n=>{if("Conducteur"==n.paramRisque.categorieParamRisque.description){let o=this.contrat?.risqueList?.find(l=>l.libelle==n.paramRisque.libelle&&l.categorieParamRisque.description==n.paramRisque.categorieParamRisque.description);null!=o&&this.formParamRisque.get(n.paramRisque.codeParam)?.setValue({value:null!=o.reponse.valeur?o.reponse.valeur:o.reponse.idParamReponse?.idParam,disabled:!0})}}),this.formCreationConducteur.get("dateNaissance")?.setValidators([u.kI.required,Z]),this.formCreationConducteur.get("dateNaissance").updateValueAndValidity()}}getRoles(){this.genericService.getParam(JSON.parse(sessionStorage.getItem("dictionnaire")||"{}").find(t=>"C33"==t.code).idCategorie).subscribe({next:t=>{this.roles=t},error:t=>{console.log(t)}})}getParamContratByIdRisque(t){this.contratService.getParamContratByIdRisque(this.contrat.idContrat,this.contrat.groupeList[0].idGroupe,t).subscribe({next:n=>{this.oneRisqueInfo=n;let o=[];this.oneRisqueInfo.map(l=>{let a={};a.idParam=l?.idParamRisque,a.reponse={idReponse:null,description:null},"Liste of values"==l?.typeChamp?a.reponse.idReponse=null!=this.formParamRisque.get(l.codeRisque)?.value?this.formParamRisque.get(l.codeRisque)?.value:l?.reponse.idParamReponse?.idParam:a.reponse.description=null!=this.formParamRisque.get(l.codeRisque)?.value?this.formParamRisque.get(l.codeRisque)?.value:l?.reponse.valeur,o.push(a)}),0!==o.length&&(this.paramListTest[t]=o)}})}objectDevis(t){this.devis.typeClient=this.formCreationAssure.get("typeClient")?.value,this.devis.dateAssure=this.contrat?.dateAssure;let n=!1;this.devis.duree=null!=this.formApplicationAvenant.get("duree")?.value?this.formApplicationAvenant.get("duree")?.value:this.contrat?.duree?.id_duree,this.devis.agence=this.formApplicationAvenant.get("agence")?.value,this.devis.tailleRisque=this.dataSourceRisque.data.length,0!=this.avenant?.paramRisque?.length&&this.avenant.tarifaire&&2!=this.formStep?(this.paramListTest.map(p=>{console.log("paramEl",p.find(m=>m?.idParam==this.controleDevis[0][0].idParam)),p.find(m=>m?.idParam==this.controleDevis[0][0].idParam)?.reponse?.description&&(p.find(m=>m?.idParam==this.controleDevis[0][0].idParam).reponse.description=this.controleDevis[0][0].valeur)}),this.risqueGroupe[0].groupeList.forEach(p=>{p.risque.paramList=[],Array.prototype.push.apply(p.risque.paramList,this.paramListTest[p.risque.idRisque])}),this.devis.groupes=this.risqueGroupe,this.jsonAvenant.groupes=this.risqueGroupe):2==this.formStep&&(this.devis.tailleRisque=this.fileControle.length,this.generateTarif());let l=!1,a=[],r=[],c=null;if(this.multiRisqueProduct){let p=[],m=[];this.groupesPacks.forEach((d,f)=>{a=[],d.pack.garantie.map(v=>{v.categorieList?.map(g=>{c=null,null!=v.sousCategorieList?.length&&0!=v.sousCategorieList?.length&&(c={idSousCategoriePackComplet:g.sousCategorieList[0].idParamSCPackComplet,valeur:g.sousCategorieList[0].valeur}),r.push({idCategoriePackComplet:g.idParamPackComplet,valeur:g.valeur,sousCategorieList:c})});const _=this.contrat.groupeList[0].garantieList.find(g=>g.codeGarantie===v.codeGarantie).prime;a.push({idPackComplet:v.idPackComplet,prime:"",categorieList:r,codeGarantie:v.codeGarantie,primePrecedent:_}),r=[]}),this.packCompletList=a,this.risqueGroupe.map((v,_)=>{v.idGroupe==d.group&&v.groupeList.forEach(g=>{this.devis.tailleRisque=this.devis.tailleRisque+1;let h=this.contrat.groupeList.find(M=>M.idGroupe==v.idGroupe),q=g.numRisque;q=g.risque.hasOwnProperty("idRisque")?h?.risques.find(M=>M.idRisque==g.risque.idRisque).idRisque:g.numRisque,m.push({idRisque:q,packCompletOne:a}),g.risque.packCompletList=a,g.risque.primeList=[],g.risque.taxeList=[],this.devis.groupes=this.risqueGroupe,this.jsonAvenant.groupes=this.risqueGroupe}),_===this.risqueGroupe.length-1&&this.generateTarif()})}),(0,$.D)(p).subscribe(d=>{d.map((f,v)=>{if(0==this.avenant?.paramRisque?.length){let _=[];f.response.forEach(g=>{let h={};h="Liste of values"==g.typeChamp||"Boolean"==g.typeChamp||"P56"==g.codeRisque||"P25"==g.codeRisque||"P26"==g.codeRisque?{idParam:g.idParamRisque,reponse:{idReponse:g.reponse.idParamReponse.idParam,description:null}}:{idParam:g.idParamRisque,reponse:{idReponse:null,description:g.reponse.valeur}},_.push(h)}),this.risqueGroupe.map(g=>{g.groupeList.map(h=>{h.risque.idRisque==f.idRisque&&(h.risque.paramList=_,h.risque.packCompletList=m.find(q=>q.idRisque==h.risque.idRisque).packCompletOne,h.risque.taxeList=[],this.devis.packCompletOne=[],this.devis.groupes=this.risqueGroupe,this.jsonAvenant.groupes=this.risqueGroupe)})})}else this.risqueGroupe.map(_=>{_.groupeList.map(g=>{0==f.idRisque&&g.risque.hasOwnProperty("idRisque"),g.risque.idRisque==f.idRisque&&(g.risque.packCompletList=m.find(h=>h.idRisque==g.risque.idRisque).packCompletOne,a=[],g.risque.primeList=[],g.risque.taxeList=[],this.devis.packCompletOne=[],this.devis.groupes=this.risqueGroupe,this.jsonAvenant.groupes=this.risqueGroupe)})});v===d.length-1&&this.generateTarif()})})}else this.garantieAll.map(p=>{this.formPackGaranties.controls.map(m=>{if(p.idPackComplet==m.value.idPackComplet){const d=this.dataSource.data.find(f=>f.idPackComplet==p.idPackComplet);(m.controls.checked.value||("96"==this.route.snapshot.paramMap.get("codeProduit")||"95"==this.route.snapshot.paramMap.get("codeProduit"))&&t)&&(l=!0,0!=m.controls.idformule.value.length&&(m.controls.idformule.value.length>1?(c=null,this.gestionErreurPack(m.value.idPackComplet,"formule",this.formPackGaranties),this.errorPackForm||(null!=m.controls.formule?.value?.sousCategorieList?.length&&0!=m.controls.formule?.value?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.formule.value.sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.formule.value.valeur}),r.push({idCategoriePackComplet:m.controls.idformule.value.find(f=>f.valeur==m.controls.formule.value)?.idParamPackComplet,valeur:d.formule.find(f=>f.idParamPackComplet==m.controls.idformule.value.find(v=>v.valeur==m.controls.formule.value)?.idParamPackComplet)?.valeur,sousCategorieList:c}))):null!=m.controls.formule.value?(c=null,null!=m.controls.idformule.value[0].sousCategorieList?.length&&0!=m.controls.idformule.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idformule.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.formule.value}),r.push({idCategoriePackComplet:m.controls.idformule.value[0].idParamPackComplet,valeur:m.controls.formule.value,sousCategorieList:c})):("input"==m.controls.idformule.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=m.controls.idformule.value[0].sousCategorieList?.length&&0!=m.idformule?.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idformule.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.idformule.value[0].valeur}),r.push({idCategoriePackComplet:m.controls.idformule.value[0].idParamPackComplet,valeur:m.controls.idformule.value[0].valeur,sousCategorieList:c}))),0!=m.controls.idfranchise.value.length&&(m.controls.idfranchise.value.length>1?(c=null,null!=m.controls.franchise?.value?.sousCategorieList?.length&&0!=m.controls.franchise?.value?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.franchise.value.sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.franchise.value.valeur}),r.push({idCategoriePackComplet:m.controls.idfranchise.value.find(f=>f.valeur==m.controls.franchise.value)?.idParamPackComplet,valeur:d.franchise.find(f=>f.idParamPackComplet==m.controls.idfranchise.value.find(v=>v.valeur==m.controls.franchise.value)?.idParamPackComplet)?.valeur,sousCategorieList:c})):null!=m.controls.franchise.value?(c=null,null!=m.controls.idfranchise.value[0].sousCategorieList?.length&&0!=m.controls.idfranchise.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idfranchise.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.franchise.value}),r.push({idCategoriePackComplet:m.controls.idfranchise.value[0].idParamPackComplet,valeur:m.controls.franchise.value,sousCategorieList:c})):("input"==m.controls.idfranchise.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=m.controls.idfranchise.value[0].sousCategorieList?.length&&0!=m.controls.idfranchise.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idfranchise.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.idfranchise.value[0].valeur}),r.push({idCategoriePackComplet:m.controls.idfranchise.value[0].idParamPackComplet,valeur:m.controls.idfranchise.value[0].valeur,sousCategorieList:c}))),0!=m.controls.idplafond.value.length&&(m.controls.idplafond.value.length>1?(c=null,null!=m.controls.plafond?.value?.sousCategorieList?.length&&0!=m.controls.plafond?.value?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.plafond.value.sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.plafond.value.valeur}),r.push({idCategoriePackComplet:m.controls.idplafond.value.find(f=>f.valeur==m.controls.plafond.value)?.idParamPackComplet,valeur:d.plafond.find(f=>f.idParamPackComplet==m.controls.idplafond.value.find(v=>v.valeur==m.controls.plafond.value)?.idParamPackComplet)?.valeur,sousCategorieList:c})):null!=m.controls.plafond.value?(c=null,null!=m.controls.idplafond.value[0].sousCategorieList?.length&&0!=m.controls.idplafond.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idplafond.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:"0"!=d.plafond[0]?.valeur?d.plafond[0]?.valeur:m.controls.plafond.value}),r.push({idCategoriePackComplet:m.controls.idplafond.value[0].idParamPackComplet,valeur:"0"!=d.plafond[0]?.valeur?d.plafond[0]?.valeur:m.controls.plafond.value,sousCategorieList:c})):("input"==m.controls.idplafond.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=m.controls.idplafond.value[0].sousCategorieList?.length&&0!=m.controls.idplafond.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:m.controls.idplafond.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:m.controls.idplafond.value[0].valeur}),r.push({idCategoriePackComplet:m.controls.idplafond.value[0].idParamPackComplet,valeur:m.controls.idplafond.value[0].valeur,sousCategorieList:c}))),l&&!this.errorPackForm&&(a.push({idPackComplet:p.idPackComplet,prime:"",primePrecedent:"NaN"!=d.primePre?d.primePre:null,categorieList:r,codeGarantie:p.codeGarantie}),r=[]),p.sousGarantieList.forEach(f=>{const v=d.sousGarantieList.data.find(_=>_.idPackComplet==f.idPackComplet);m.get("souGarantieArray").controls.forEach(_=>{if(f.idPackComplet==_.value.idPackComplet&&(_.controls.checked.value||("96"==this.route.snapshot.paramMap.get("codeProduit")||"95"==this.route.snapshot.paramMap.get("codeProduit"))&&t)){n=!0,0!=_.controls.idformule.value.length&&(_.controls.idformule.value.length>1?(c=null,this.gestionErreurPack(_.value.idPackComplet,"formule",m.get("souGarantieArray")),this.errorPackForm||(null!=_.value.formule?.sousCategorieList?.length&&0!=_.value.formule?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.value.formule.sousCategorieList[0]?.idParamSCPackComplet,valeur:_.value.formule.valeur}),r.push({idCategoriePackComplet:_.controls.idformule.value.find(h=>h.valeur==_.controls.formule.value)?.idParamPackComplet,valeur:v.formule.find(h=>h.idParamPackComplet==_.controls.idformule.value.find(q=>q.valeur==_.controls.formule.value)?.idParamPackComplet)?.valeur,sousCategorieList:c}))):null!=_.value.formule?(c=null,null!=_.controls.idformule.value[0].sousCategorieList?.length&&0!=_.controls.idformule.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.controls.idformule.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:_.value.formule}),r.push({idCategoriePackComplet:_.controls.idformule.value[0].idParamPackComplet,valeur:_.value.formule,sousCategorieList:c})):("input"==_.controls.idformule.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=m.controls.idformule.value[0].sousCategorieList?.length&&0!=_.idformule?.value[0].sousCategorieList?.length&&(_={idSousCategoriePackComplet:_.controls.idformule.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:_.controls.idformule.value[0].valeur}),r.push({idCategoriePackComplet:_.controls.idformule.value[0].idParamPackComplet,valeur:_.controls.idformule.value[0].valeur,sousCategorieList:c}))),0!=_.controls.idfranchise.value.length&&(_.controls.idfranchise.value.length>1?(c=null,null!=_.value?.franchise?.sousCategorieList?.length&&0!=m.value?.franchise?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.value.franchise.sousCategorieList[0]?.idParamSCPackComplet,valeur:_.value.franchise.valeur}),r.push({idCategoriePackComplet:_.controls.idfranchise.value.find(h=>h.valeur==_.controls.franchise.value)?.idParamPackComplet,valeur:v.franchise.find(h=>h.idParamPackComplet==_.controls.idfranchise.value.find(q=>q.valeur==_.controls.franchise.value)?.idParamPackComplet)?.valeur,sousCategorieList:c})):null!=_.value.franchise?(c=null,null!=_.controls.idfranchise.value[0].sousCategorieList?.length&&0!=_.controls.idfranchise.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.controls.idfranchise.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:_.value.franchise}),r.push({idCategoriePackComplet:_.controls.idfranchise.value[0].idParamPackComplet,valeur:_.value.franchise,sousCategorieList:c})):("input"==_.controls.idfranchise.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=_.controls.idfranchise.value[0].sousCategorieList?.length&&0!=_.controls.idfranchise.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.controls.idfranchise.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:_.controls.idfranchise.value[0].valeur}),r.push({idCategoriePackComplet:_.controls.idfranchise.value[0].idParamPackComplet,valeur:_.controls.idfranchise.value[0].valeur,sousCategorieList:c}))),0!=_.controls.idplafond.value.length&&(_.controls.idplafond.value.length>1?(c=null,null!=_.value?.plafond?.sousCategorieList?.length&&0!=_.value?.plafond?.sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.value.plafond.sousCategorieList[0]?.idParamSCPackComplet,valeur:_.value.plafond.valeur}),r.push({idCategoriePackComplet:_.controls.idplafond.value.find(h=>h.valeur==_.controls.plafond.value)?.idParamPackComplet,valeur:v.plafond.find(h=>h.idParamPackComplet==_.controls.idplafond.value.find(q=>q.valeur==_.controls.plafond.value)?.idParamPackComplet)?.valeur,sousCategorieList:c})):null!=_.value.plafond?(c=null,null!=_.controls.idplafond.value[0].sousCategorieList?.length&&0!=_.controls.idplafond.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.controls.idplafond.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:"0"!=v.plafond[0]?.valeur?v.plafond[0]?.valeur:_.controls.plafond.value}),r.push({idCategoriePackComplet:_.controls.idplafond.value[0].idParamPackComplet,valeur:"0"!=v.plafond[0]?.valeur?v.plafond[0]?.valeur:_.controls.plafond.value,sousCategorieList:c})):("input"==_.controls.idplafond.value[0].descriptionvVal&&(this.errorPackForm=!0),c=null,null!=_.controls.idplafond.value[0].sousCategorieList?.length&&0!=_.controls.idplafond.value[0].sousCategorieList?.length&&(c={idSousCategoriePackComplet:_.controls.idplafond.value[0].sousCategorieList[0]?.idParamSCPackComplet,valeur:_.controls.idplafond.value[0].valeur}),r.push({idCategoriePackComplet:_.controls.idplafond.value[0].idParamPackComplet,valeur:_.controls.idplafond.value[0].valeur,sousCategorieList:c}))),c=null;let g=a.some(h=>h.idPackComplet===f.idPackComplet);n&&!this.errorPackForm&&!g&&(a.push({idPackComplet:f.idPackComplet,prime:"",categorieList:r}),r=[])}})}))}}),r=[],l=!1}),this.errorPackForm||(this.devis.packCompletList=a),this.risqueGroupe[0].groupeList[0].risque.packCompletList=a,this.risqueGroupe[0].groupeList[0].risque.primeList=[],this.risqueGroupe[0].groupeList[0].risque.taxeList=[],this.devis.groupes=this.risqueGroupe,this.jsonAvenant.groupes=this.risqueGroupe,0==this.avenant?.paramRisque?.length&&2!=this.formStep?(this.risqueGroupe[0].groupeList[0].risque.paramList=[],this.contratService.getParamContratByIdRisque(this.contrat.idContrat,this.contrat.groupeList[0].idGroupe,this.contrat.groupeList[0].risques[0].idRisque).subscribe({next:p=>{let m=[];p.forEach(d=>{let f={};f.idParam=d?.idParamRisque,f.reponse={idReponse:null,description:null},"Liste of values"==d?.typeChamp||"Boolean"==d?.typeChamp||"P25"==d.codeRisque||"P26"==d.codeRisque?f.reponse.idReponse=null!=this.formParamRisque.get(d.codeRisque)?.value?this.formParamRisque.get(d.codeRisque)?.value:d?.reponse.idParamReponse?.idParam:f.reponse.description="P55"==d.codeRisque?this.formCreationConducteur?.controls.dateNaissance?.value:null!=this.formParamRisque.get(d.codeRisque)?.value?this.formParamRisque.get(d.codeRisque)?.value:d?.reponse?.valeur,m.push(f)}),this.risqueGroupe[0].groupeList[0].risque.paramList=m,this.loaderTarif&&this.generateTarif()},error:p=>{}})):this.loaderTarif&&this.generateTarif()}remplissageTarif(){this.devisService.remplissageDevis(this.devis).subscribe({next:t=>{this.garantieTab.map(n=>{n.prime=null,t.groupes[0].groupeList[0].risque.packCompletList.map(o=>{n.idPackComplet==o.idPackComplet&&n.plafond.forEach(l=>{o.categorieList.forEach(a=>{l.idParamPackComplet===a.idCategoriePackComplet&&(l.valeur=a.valeur)})}),n.sousGarantieList.data?.map(l=>{l.idPackComplet==o.idPackComplet&&l.plafond.forEach(a=>{o.categorieList.forEach(r=>{a.idParamPackComplet===r.idCategoriePackComplet&&(a.valeur=r.valeur)})})})})})},error:t=>{console.log(t)}})}generateCalcul(){this.loaderTarif=!0,this.objectDevis(!1)}generateTarif(){var t=this;return(0,T.Z)(function*(){if(!t.errorPackForm)if(t.loaderTarif=!0,"A13"==t.avenant?.code||"A18"==t.avenant?.code){const n=yield t.cryptoService.generateHmac(t.tkn,t.devis),l={stringJson:JSON.stringify(t.devis),signature:n};t.avenantService.generateTarif(l).subscribe({next:a=>{if(t.retourCalcul=a,t.returnedTarif=a,t.errorHandler.error=!1,t.errorHandler.msg="",t.tarifReady=!0,t.calcul=!1,t.loaderTarif=!1,t.garantieTab.map(r=>{r.prime=null,a.groupes[0].groupeList[0].risque.packCompletList.map(c=>{r.idPackComplet==c.idPackComplet&&(r.prime=c.prime,r.primeBonus=c.coefBonusMalus)}),"95"==t.codeProduit&&r.sousGarantieList.data.map(c=>{c.prime=null,a.groupes[0].groupeList[0].risque.packCompletList.map(p=>{c.idPackComplet==p.idPackComplet&&(c.prime=p.prime,c.primeBonus=p.coefBonusMalus)})})}),t.PrimeTotaleTarif=a.primeList?.find(r=>101==r.idPrime)?.prime,t.PrimeTotale=a.primeList?.find(r=>101==r.idPrime)?.prime,t.PrimeAfterPruning=null!=a.primeAfterPruning?a.primeAfterPruning:0,t.PrimeBonusMalus=null!=a.montantBonusMalus?a.montantBonusMalus:0,t.dataSource=new P.by(t.garantieTab),t.jsonAvenant.agence=t.formApplicationAvenant.get("agence")?.value,t.jsonAvenant.duree=t.formApplicationAvenant.get("duree")?.value,t.jsonAvenant.pack=a.pack,t.jsonAvenant.packCompletList=a.packCompletList,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.jsonAvenant.idTypeAvenant=t.formApplicationAvenant.get("idTypeAvenant")?.value,t.jsonAvenant.idContrat=t.formApplicationAvenant.get("idContrat")?.value,t.jsonAvenant.dateAvenant=x(t.formApplicationAvenant.get("dateAvenant")?.value,"ddd MMM D YYYY HH:mm:ss ZZ"),t.avenant?.attestation&&(t.jsonAvenant.numAttestation=t.formApplicationAvenant.get("attestation")?.value),t.jsonAvenant.motif={},t.jsonAvenant.motif.idMotif=t.formApplicationAvenant.get("motif")?.value.idMotif.idMotif,t.jsonAvenant.motif.commentaire=t.formApplicationAvenant.get("commentaire")?.value,t.jsonAvenant.list=a.list,t.jsonAvenant.attributList=[],t.avenant.attributs.forEach(r=>{t.jsonAvenant.attributList.push({idAttribut:r.idAtrribut.idAttribut,valeur:t.formApplicationAvenant.get(r.idAtrribut.nomBdd)?.value})}),t.jsonAvenant.paramList=[],t.avenant.paramRisque.forEach(r=>{let c={};c="Liste of values"==r.paramRisque?.typeChamp?.description||"P25"==r.paramRisque.codeParam||"P26"==r.paramRisque.codeParam?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:t.formParamRisque.get(r.paramRisque.codeParam)?.value,description:null}}:"L08"==r.paramRisque?.typeChamp.code?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(r.paramRisque.codeParam)?.value}}:"date"!=r.paramRisque?.typeChamp?.description&&34==r.paramRisque?.idParamRisque?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:String(Number(t.formParamRisque.get(r.paramRisque.codeParam)?.value))}}:{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(r.paramRisque.codeParam)?.value}},t.jsonAvenant.paramList.push(c)}),t.jsonAvenant.personnes=[],t.isAssure&&t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP238"===c.code)||{}).idParam,typeClient:t.typePersonne,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession,idProfession:t.formCreationSouscripteur?.controlst.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controlst.numeroPermis?.value,categorie:t.formCreationConducteur?.controlst.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r)}else if(t.isAssure&&t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP238"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r)}else if(t.isAssure){t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP236"===c.code)||{}).idParam,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};if(t.jsonAvenant.personnes.push(r),"45A"==t.codeProduit){t.typePersonne=null==t.formCreationConducteur?.controls.raisonSocial?.value||""==t.formCreationConducteur?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP233"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationConducteur?.controls.codeClient?.value,nom:""!=t.formCreationConducteur?.controls.nom?.value?t.formCreationConducteur?.controls.nom?.value:null,prenom:""!=t.formCreationConducteur?.controls.prenom?.value?t.formCreationConducteur?.controls.prenom?.value:null,raisonSocial:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:null,nin:"",telephone:{idContact:t.formCreationConducteur?.controls.idTelephone?.value,description:t.formCreationConducteur?.controls.telephone?.value},email:{idContact:t.formCreationConducteur?.controls.idEmail?.value,description:t.formCreationConducteur?.controls.email?.value},adresse:{idAdresse:t.formCreationConducteur?.controls.idAdresse?.value,description:t.formCreationConducteur?.controls.adresse?.value,wilaya:t.formCreationConducteur?.controls.wilaya?.value,commune:t.formCreationConducteur?.controls.commune?.value},genre:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P24"==p.codeRisque)?.reponse?.idParamReponse?.idParam:0,situation:t.formCreationConducteur?.controls.situation?.value,profession:{id:t.formCreationConducteur?.controls.idProfession?.value,idProfession:t.formCreationConducteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P54"==p.codeRisque)?.reponse?.valeur:"",wilayaDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P56"==p.codeRisque)?.reponse?.valeur:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":c.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":c.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P24":c.genre=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(c)}}else if(t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP237"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP235"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};t.jsonAvenant.personnes.push(c)}else if(t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP234"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP240"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":c.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":c.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P24":c.genre=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(c)}else{t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP234"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP235"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};if(t.jsonAvenant.personnes.push(c),"45A"==t.codeProduit){t.typePersonne=null==t.formCreationConducteur?.controls.raisonSocial?.value||""==t.formCreationConducteur?.controls.raisonSocial?.value?"PH":"PM";let p={role:(t.roles.find(m=>"CP233"===m.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationConducteur?.controls.codeClient?.value,nom:""!=t.formCreationConducteur?.controls.nom?.value?t.formCreationConducteur?.controls.nom?.value:null,prenom:""!=t.formCreationConducteur?.controls.prenom?.value?t.formCreationConducteur?.controls.prenom?.value:null,raisonSocial:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:null,nin:"",telephone:{idContact:t.formCreationConducteur?.controls.idTelephone?.value,description:t.formCreationConducteur?.controls.telephone?.value},email:{idContact:t.formCreationConducteur?.controls.idEmail?.value,description:t.formCreationConducteur?.controls.email?.value},adresse:{idAdresse:t.formCreationConducteur?.controls.idAdresse?.value,description:t.formCreationConducteur?.controls.adresse?.value,wilaya:t.formCreationConducteur?.controls.wilaya?.value,commune:t.formCreationConducteur?.controls.commune?.value},genre:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P24"==m.codeRisque)?.reponse?.idParamReponse?.idParam:0,situation:t.formCreationConducteur?.controls.situation?.value,profession:{id:t.formCreationConducteur?.controls.idProfession?.value,idProfession:t.formCreationConducteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P54"==m.codeRisque)?.reponse?.valeur:"",wilayaDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P56"==m.codeRisque)?.reponse?.valeur:0}};t.avenant.paramRisque.map(m=>{if("Conducteur"==m.paramRisque.categorieParamRisque.description)switch(m.paramRisque.codeParam){case"P56":p.permis.wilayaDelivrance=+t.formParamRisque?.get(m.paramRisque.codeParam)?.value;break;case"P54":p.permis.dateDelivrance=t.formParamRisque?.get(m.paramRisque.codeParam)?.value;break;case"P24":p.genre=t.formParamRisque?.get(m.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(p)}}if(t.multiRisqueAvenant||!t.multiRisqueProduct){a.groupes.map(m=>{m.groupeList.map(d=>{d.risque.packCompletList.map(f=>{t.groupesPacks.map(v=>{v.group==m.idGroupe&&v.pack.garantie.map(_=>{_.idPackComplet==f.idPackComplet&&(f.codeGarantie=_.codeGarantie)})})})})});let r=[],c=a.groupes.map(m=>({...m,groupeList:m.groupeList.map(d=>({...d,risque:{...d.risque,packCompletList:[]}}))})),p=[];t.risquesInvolved.map(m=>{p.push(m.idRisque)}),t.contratService.getPackIdRisques(t.contrat.idContrat,p).subscribe({next:m=>{m.map(d=>{t.risquesInvolved.map(f=>{f.idRisque==d.risque&&(d.idGroupe=f.idGroupe)})}),r=m,a.groupes.map(d=>{r.map(f=>{d.idGroupe==f.idGroupe&&d.groupeList.map(v=>{let _=[];v.risque.idRisque==f.risque&&(v.risque.packCompletList.map(g=>{_.push({codeGarantie:g.codeGarantie,categorieList:g.categorieList,idPackComplet:g.idPackComplet,prime:g.prime,primeProrata:g.primeProrata,primeReduction:null,nouveau:!0,coefBonusMalus:null,coefButoir:null,description:g.description})}),f.garantieList.map(g=>{!_.some(q=>q.codeGarantie===g.codeGarantie)&&"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&_.push({codeGarantie:g.codeGarantie,categorieList:g.categorieList,idPackComplet:g.id,prime:g.prime,primeProrata:g.primeProrata,primeReduction:null,nouveau:!1,coefBonusMalus:null,coefButoir:null,description:g.description})}),c.map(g=>{g.groupeList.map(h=>{h.risque.idRisque==f.risque&&(h.risque.packCompletList=_)})}))})})}),t.jsonAvenant.groupes=c,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.returnedTarif.groupes=t.jsonAvenant.groupes,t.multiRisqueProduct&&t.calculPrime()},error:m=>{console.log(m)}})}else a.groupes.map(r=>{r.groupeList.map(c=>{c.risque.packCompletList.map(p=>{p.nouveau=!0})})}),t.jsonAvenant.groupes=a.groupes,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.multiRisqueProduct&&t.calculPrime();t.multiRisqueProduct&&t.myStepper.next()},error:a=>{t.loaderTarif=!1,t.handleError(a)}})}else if("A22"==t.avenant?.code){const n=yield t.cryptoService.generateHmac(t.tkn,t.devis),l={stringJson:JSON.stringify(t.devis),signature:n};t.avenantService.generateTarifProprietaire(l).subscribe({next:a=>{if(t.retourCalcul=a,t.returnedTarif=a,t.errorHandler.error=!1,t.errorHandler.msg="",t.tarifReady=!0,t.calcul=!1,t.loaderTarif=!1,t.garantieTab.map(r=>{r.prime=null,a.groupes[0].groupeList[0].risque.packCompletList.map(c=>{r.idPackComplet==c.idPackComplet&&(r.prime=c.prime,r.primeBonus=c.coefBonusMalus)}),"95"==t.codeProduit&&r.sousGarantieList.data.map(c=>{c.prime=null,a.groupes[0].groupeList[0].risque.packCompletList.map(p=>{c.idPackComplet==p.idPackComplet&&(c.prime=p.prime,c.primeBonus=p.coefBonusMalus)})})}),t.PrimeTotaleTarif=a.primeList?.find(r=>101==r.idPrime)?.prime,t.PrimeTotale=a.primeList?.find(r=>101==r.idPrime)?.prime,t.PrimeAfterPruning=null!=a.primeAfterPruning?a.primeAfterPruning:0,t.PrimeBonusMalus=null!=a.montantBonusMalus?a.montantBonusMalus:0,t.dataSource=new P.by(t.garantieTab),t.jsonAvenant.agence=t.formApplicationAvenant.get("agence")?.value,t.jsonAvenant.duree=t.formApplicationAvenant.get("duree")?.value,t.jsonAvenant.pack=a.pack,t.jsonAvenant.packCompletList=a.packCompletList,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.jsonAvenant.idTypeAvenant=t.formApplicationAvenant.get("idTypeAvenant")?.value,t.jsonAvenant.idContrat=t.formApplicationAvenant.get("idContrat")?.value,t.jsonAvenant.dateAvenant=x(t.formApplicationAvenant.get("dateAvenant")?.value,"ddd MMM D YYYY HH:mm:ss ZZ"),t.avenant?.attestation&&(t.jsonAvenant.numAttestation=t.formApplicationAvenant.get("attestation")?.value),t.jsonAvenant.motif={},t.jsonAvenant.motif.idMotif=t.formApplicationAvenant.get("motif")?.value.idMotif.idMotif,t.jsonAvenant.motif.commentaire=t.formApplicationAvenant.get("commentaire")?.value,t.jsonAvenant.list=a.list,t.jsonAvenant.attributList=[],t.avenant.attributs.forEach(r=>{t.jsonAvenant.attributList.push({idAttribut:r.idAtrribut.idAttribut,valeur:t.formApplicationAvenant.get(r.idAtrribut.nomBdd)?.value})}),t.jsonAvenant.paramList=[],t.avenant.paramRisque.forEach(r=>{let c={};c="Liste of values"==r.paramRisque?.typeChamp?.description||"P25"==r.paramRisque.codeParam||"P26"==r.paramRisque.codeParam?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:t.formParamRisque.get(r.paramRisque.codeParam)?.value,description:null}}:"L08"==r.paramRisque?.typeChamp.code?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(r.paramRisque.codeParam)?.value}}:"date"!=r.paramRisque?.typeChamp?.description&&34==r.paramRisque?.idParamRisque?{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:String(Number(t.formParamRisque.get(r.paramRisque.codeParam)?.value))}}:{idParam:r.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(r.paramRisque.codeParam)?.value}},t.jsonAvenant.paramList.push(c)}),t.jsonAvenant.personnes=[],t.isAssure&&t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP238"===c.code)||{}).idParam,typeClient:t.typePersonne,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession,idProfession:t.formCreationSouscripteur?.controlst.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controlst.numeroPermis?.value,categorie:t.formCreationConducteur?.controlst.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r)}else if(t.isAssure&&t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP238"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r)}else if(t.isAssure){t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP236"===c.code)||{}).idParam,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};if(t.jsonAvenant.personnes.push(r),"45A"==t.codeProduit){t.typePersonne=null==t.formCreationConducteur?.controls.raisonSocial?.value||""==t.formCreationConducteur?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP233"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationConducteur?.controls.codeClient?.value,nom:""!=t.formCreationConducteur?.controls.nom?.value?t.formCreationConducteur?.controls.nom?.value:null,prenom:""!=t.formCreationConducteur?.controls.prenom?.value?t.formCreationConducteur?.controls.prenom?.value:null,raisonSocial:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:null,nin:"",telephone:{idContact:t.formCreationConducteur?.controls.idTelephone?.value,description:t.formCreationConducteur?.controls.telephone?.value},email:{idContact:t.formCreationConducteur?.controls.idEmail?.value,description:t.formCreationConducteur?.controls.email?.value},adresse:{idAdresse:t.formCreationConducteur?.controls.idAdresse?.value,description:t.formCreationConducteur?.controls.adresse?.value,wilaya:t.formCreationConducteur?.controls.wilaya?.value,commune:t.formCreationConducteur?.controls.commune?.value},genre:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P24"==p.codeRisque)?.reponse?.idParamReponse?.idParam:0,situation:t.formCreationConducteur?.controls.situation?.value,profession:{id:t.formCreationConducteur?.controls.idProfession?.value,idProfession:t.formCreationConducteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P54"==p.codeRisque)?.reponse?.valeur:"",wilayaDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(p=>"P56"==p.codeRisque)?.reponse?.valeur:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":c.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":c.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P24":c.genre=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(c)}}else if(t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP237"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP235"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};t.jsonAvenant.personnes.push(c)}else if(t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP234"===p.code)||{}).idParam,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP240"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(p=>{if("Conducteur"==p.paramRisque.categorieParamRisque.description)switch(p.paramRisque.codeParam){case"P56":c.permis.wilayaDelivrance=+t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P54":c.permis.dateDelivrance=t.formParamRisque?.get(p.paramRisque.codeParam)?.value;break;case"P24":c.genre=t.formParamRisque?.get(p.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(c)}else{t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(p=>"CP234"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(r),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let c={role:(t.roles.find(p=>"CP235"===p.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};if(t.jsonAvenant.personnes.push(c),"45A"==t.codeProduit){t.typePersonne=null==t.formCreationConducteur?.controls.raisonSocial?.value||""==t.formCreationConducteur?.controls.raisonSocial?.value?"PH":"PM";let p={role:(t.roles.find(m=>"CP233"===m.code)||{}).idParam,typeClient:t.typePersonne,risqueList:[t.contrat.groupeList[0].risques[0].idRisque],idClient:t.formCreationConducteur?.controls.codeClient?.value,nom:""!=t.formCreationConducteur?.controls.nom?.value?t.formCreationConducteur?.controls.nom?.value:null,prenom:""!=t.formCreationConducteur?.controls.prenom?.value?t.formCreationConducteur?.controls.prenom?.value:null,raisonSocial:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:null,nin:"",telephone:{idContact:t.formCreationConducteur?.controls.idTelephone?.value,description:t.formCreationConducteur?.controls.telephone?.value},email:{idContact:t.formCreationConducteur?.controls.idEmail?.value,description:t.formCreationConducteur?.controls.email?.value},adresse:{idAdresse:t.formCreationConducteur?.controls.idAdresse?.value,description:t.formCreationConducteur?.controls.adresse?.value,wilaya:t.formCreationConducteur?.controls.wilaya?.value,commune:t.formCreationConducteur?.controls.commune?.value},genre:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P24"==m.codeRisque)?.reponse?.idParamReponse?.idParam:0,situation:t.formCreationConducteur?.controls.situation?.value,profession:{id:t.formCreationConducteur?.controls.idProfession?.value,idProfession:t.formCreationConducteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P54"==m.codeRisque)?.reponse?.valeur:"",wilayaDelivrance:"A17"==t.avenant?.code?t.oneRisqueInfo.find(m=>"P56"==m.codeRisque)?.reponse?.valeur:0}};t.avenant.paramRisque.map(m=>{if("Conducteur"==m.paramRisque.categorieParamRisque.description)switch(m.paramRisque.codeParam){case"P56":p.permis.wilayaDelivrance=+t.formParamRisque?.get(m.paramRisque.codeParam)?.value;break;case"P54":p.permis.dateDelivrance=t.formParamRisque?.get(m.paramRisque.codeParam)?.value;break;case"P24":p.genre=t.formParamRisque?.get(m.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(p)}}if(t.multiRisqueAvenant||!t.multiRisqueProduct){a.groupes.map(m=>{m.groupeList.map(d=>{d.risque.packCompletList.map(f=>{t.groupesPacks.map(v=>{v.group==m.idGroupe&&v.pack.garantie.map(_=>{_.idPackComplet==f.idPackComplet&&(f.codeGarantie=_.codeGarantie)})})})})});let r=[],c=a.groupes.map(m=>({...m,groupeList:m.groupeList.map(d=>({...d,risque:{...d.risque,packCompletList:[]}}))})),p=[];t.risquesInvolved.map(m=>{p.push(m.idRisque)}),t.contratService.getPackIdRisques(t.contrat.idContrat,p).subscribe({next:m=>{m.map(d=>{t.risquesInvolved.map(f=>{f.idRisque==d.risque&&(d.idGroupe=f.idGroupe)})}),r=m,a.groupes.map(d=>{r.map(f=>{d.idGroupe==f.idGroupe&&d.groupeList.map(v=>{let _=[];v.risque.idRisque==f.risque&&(v.risque.packCompletList.map(g=>{_.push({codeGarantie:g.codeGarantie,categorieList:g.categorieList,idPackComplet:g.idPackComplet,prime:g.prime,primeProrata:g.primeProrata,primeReduction:null,nouveau:!0,coefBonusMalus:null,coefButoir:null,description:g.description})}),f.garantieList.map(g=>{!_.some(q=>q.codeGarantie===g.codeGarantie)&&"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&"A22"!=t.avenant?.code&&_.push({codeGarantie:g.codeGarantie,categorieList:g.categorieList,idPackComplet:g.id,prime:g.prime,primeProrata:g.primeProrata,primeReduction:null,nouveau:!1,coefBonusMalus:null,coefButoir:null,description:g.description})}),c.map(g=>{g.groupeList.map(h=>{h.risque.idRisque==f.risque&&(h.risque.packCompletList=_)})}))})})}),t.jsonAvenant.groupes=c,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.returnedTarif.groupes=t.jsonAvenant.groupes,t.multiRisqueProduct&&t.calculPrime()},error:m=>{console.log(m)}})}else a.groupes.map(r=>{r.groupeList.map(c=>{c.risque.packCompletList.map(p=>{p.nouveau=!0})})}),t.jsonAvenant.groupes=a.groupes,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,t.multiRisqueProduct&&t.calculPrime();t.multiRisqueProduct&&t.myStepper.next()},error:a=>{t.loaderTarif=!1,t.handleError(a)}})}else t.calculPrime()})()}gestionErreurPack(t,n,o){o.controls.forEach(l=>{l.value.idPackComplet==t&&"formule"==n?null==l.value.formule&&!l.controls.formule.disabled&&(this.errorPackForm=!0):l.value.idPackComplet==t&&"plafond"==n?null==l.value.plafond&&!l.controls.plafond.disabled&&(this.errorPackForm=!0):l.value.idPackComplet==t&&"franchise"==n&&null==l.value.franchise&&!l.controls.franchise.disabled&&(this.errorPackForm=!0)})}changePersonne(t){switch(this.typePersonne){case"Souscripteur":this.isConducteur=!1,this.isAssure=!1,this.formCreationSouscripteur=this.formBuilder.group({codeClient:[null],nom:[this.formCreationSouscripteur.value?.nom,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[this.formCreationSouscripteur.value?.prenom,[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[this.formCreationSouscripteur.value?.dateNaissance,[u.kI.required,Z]],nin:["",[u.kI.pattern(C.e.NIN)]],telephone:["",[u.kI.required,u.kI.pattern(C.e.mobile)]],email:["",[u.kI.pattern(C.e.email)]],adresse:["",[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:"",disabled:"A17"==this.avenant.code},[u.kI.required]],genre:[{value:"",disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[""],profession:[""]}),this.formCreationSouscripteur.get("nom").enable(),this.formCreationSouscripteur.get("prenom").enable(),this.formCreationSouscripteur.get("dateNaissance").enable();break;case"Conducteur":this.isConducteur=!1,this.isConducteurAssure=!1,this.formCreationConducteur=this.formBuilder.group({codeClient:[null],nom:[{value:this.formCreationConducteur.value?.nom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],prenom:[{value:this.formCreationConducteur.value?.prenom,disabled:"A21"!=this.avenant.code&&"A17"!=this.avenant.code},[u.kI.required,u.kI.pattern(C.e.nom),u.kI.maxLength(40)]],dateNaissance:[this.formCreationConducteur.value?.dateNaissance,[u.kI.required,Z]],telephone:["",[u.kI.required,u.kI.pattern(C.e.mobile)]],email:["",[u.kI.pattern(C.e.email)]],adresse:["",[u.kI.required,u.kI.maxLength(60)]],wilaya:[{value:"",disabled:"A17"==this.avenant.code},[u.kI.required]],commune:[{value:"",disabled:"A17"==this.avenant.code},[u.kI.required]],situation:[""],profession:[""],numeroPermis:["",[u.kI.required]],categoriePermis:["",[u.kI.required]]}),this.formCreationConducteur.get("nom").enable(),this.formCreationConducteur.get("prenom").enable(),this.formCreationConducteur.get("dateNaissance").enable()}}calculPrime(){var t=this;return(0,T.Z)(function*(){if("A20"==t.avenant?.code&&t.formParamRisque.get("groupe")?.setValidators([u.kI.required]),t.formParamRisque.valid||2==t.formStep){if(t.loaderCalcul=!0,t.jsonAvenant.idTypeAvenant=t.formApplicationAvenant.get("idTypeAvenant")?.value,t.jsonAvenant.idContrat=t.formApplicationAvenant.get("idContrat")?.value,t.jsonAvenant.dateAvenant=x(t.formApplicationAvenant.get("dateAvenant")?.value,"ddd MMM D YYYY HH:mm:ss ZZ"),t.jsonAvenant.agence=t.formApplicationAvenant.get("agence")?.value,t.avenant?.attestation&&(t.jsonAvenant.numAttestation=t.formApplicationAvenant.value.attestation),t.jsonAvenant.motif={},t.jsonAvenant.motif.idMotif=t.formApplicationAvenant.value.motif.idMotif.idMotif,t.jsonAvenant.motif.commentaire=t.formApplicationAvenant.value.commentaire,t.jsonAvenant.attributList=[],"A24"===t.avenant.code){const a=new Date(t.contrat.dateEffet),p=(new Date(t.contrat.dateExpiration).getTime()-a.getTime())/864e5,m=new Date(t.formParamRisque.get("P211")?.value);m.setDate(m.getDate()+p),t.avenant.attributs.forEach(d=>{t.jsonAvenant.attributList.push({idAttribut:d.idAtrribut.idAttribut,valeur:2===d.idAtrribut.idAttribut?x(t.formParamRisque.get("P211")?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z"):x(m).format("YYYY-MM-DD[T]HH:mm:ss.000Z")})})}else t.avenant.attributs.forEach("A25"===t.avenant.code?a=>{t.jsonAvenant.attributList.push({idAttribut:a.idAtrribut.idAttribut,valeur:1===a.idAtrribut.idAttribut?x(t.formParamRisque.get("P212")?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z"):x(t.contrat.dateEffet).format("YYYY-MM-DD[T]HH:mm:ss.000Z")})}:a=>{t.jsonAvenant.attributList.push({idAttribut:a.idAtrribut.idAttribut,valeur:t.formApplicationAvenant.get(a.idAtrribut.nomBdd)?.value})});if(t.avenant.tarifaire||("A23"==t.avenant.code||"A24"==t.avenant.code?t.submitChangeRisque():t.jsonAvenant.groupes=t.risqueGroupe),"A25"==t.avenant.code&&(t.jsonAvenant.groupes=[],t.jsonAvenant.groupes=t.risqueGroupe),t.multiRisqueProduct||t.avenant.tarifaire||(t.jsonAvenant.groupes[0].groupeList[0].risque.paramList=[],t.avenant.paramRisque.forEach(a=>{let r={};"Liste of values"==a.paramRisque?.typeChamp?.description?r={idParam:a.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(a.paramRisque.codeParam)?.value}}:"date"!=a.paramRisque?.typeChamp?.description?r=34==a.paramRisque?.idParamRisque?{idParam:a.paramRisque.idParamRisque,reponse:{idReponse:null,description:String(Number(t.formParamRisque.get(a.paramRisque.codeParam)?.value))}}:"P56"==a.paramRisque.codeParam||"P98"==a.paramRisque.codeParam||"P25"==a.paramRisque.codeParam||"P26"==a.paramRisque.codeParam?{idParam:a.paramRisque.idParamRisque,reponse:{idReponse:t.formParamRisque.get(a.paramRisque.codeParam)?.value,description:null}}:{idParam:a.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(a.paramRisque.codeParam)?.value}}:(t.formParamRisque.get(a.paramRisque.codeParam)?.setValue(x(t.formParamRisque.get(a.paramRisque.codeParam)?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z")),r={idParam:a.paramRisque.idParamRisque,reponse:{idReponse:null,description:t.formParamRisque.get(a.paramRisque.codeParam)?.value}}),t.jsonAvenant.groupes[0].groupeList[0].risque.paramList.push(r)})),t.jsonAvenant.personnes=[],t.isAssure&&t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let a={role:(t.roles.find(r=>"CP238"===r.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(r=>{if("Conducteur"==r.paramRisque.categorieParamRisque.description)switch(r.paramRisque.codeParam){case"P56":a.permis.wilayaDelivrance=+t.formParamRisque?.get(r.paramRisque.codeParam)?.value;break;case"P54":a.permis.dateDelivrance=t.formParamRisque?.get(r.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(a)}else if(t.isAssure&&t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";{let a={role:(t.roles.find(r=>"CP238"===r.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(r=>{if("Conducteur"==r.paramRisque.categorieParamRisque.description)switch(r.paramRisque.codeParam){case"P56":a.permis.wilayaDelivrance=+t.formParamRisque?.get(r.paramRisque.codeParam)?.value;break;case"P54":a.permis.dateDelivrance=t.formParamRisque?.get(r.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(a)}}else if(t.isAssure){t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let a={role:(t.roles.find(r=>"CP236"===r.code)||{}).idParam,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};t.jsonAvenant.personnes.push(a)}else if(t.isConducteur){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let a={role:(t.roles.find(c=>"CP237"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":a.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":a.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(a),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP235"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};t.jsonAvenant.personnes.push(r)}else if(t.isConducteurAssure){t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let a={role:(t.roles.find(c=>"CP238"===c.code)||{}).idParam,typeClient:t.typePersonne,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(a),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP240"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationConducteur?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{idDocument:0,description:t.formCreationConducteur?.controls.numeroPermis?.value,categorie:t.formCreationConducteur?.controls.categoriePermis?.value,dateDelivrance:"",wilayaDelivrance:0}};t.avenant.paramRisque.map(c=>{if("Conducteur"==c.paramRisque.categorieParamRisque.description)switch(c.paramRisque.codeParam){case"P56":r.permis.wilayaDelivrance=+t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P54":r.permis.dateDelivrance=t.formParamRisque?.get(c.paramRisque.codeParam)?.value;break;case"P24":r.genre=t.formParamRisque?.get(c.paramRisque.codeParam)?.value}}),t.jsonAvenant.personnes.push(r)}else{t.typePersonne=null==t.formCreationSouscripteur?.controls.raisonSocial?.value||""==t.formCreationSouscripteur?.controls.raisonSocial?.value?"PH":"PM";let a={role:(t.roles.find(c=>"CP234"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationSouscripteur?.controls.codeClient?.value,nom:""!=t.formCreationSouscripteur?.controls.nom?.value?t.formCreationSouscripteur?.controls.nom?.value:null,prenom:""!=t.formCreationSouscripteur?.controls.prenom?.value?t.formCreationSouscripteur?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationSouscripteur?.controls.raisonSocial?.value?t.formCreationSouscripteur?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationSouscripteur?.controls.dateNaissance?.value,nif:""!=t.formCreationSouscripteur?.controls.nif?.value?t.formCreationSouscripteur?.controls.nif?.value:null,nin:""!=t.formCreationSouscripteur?.controls.nin?.value?t.formCreationSouscripteur?.controls.nin?.value:null,telephone:{idContact:t.formCreationSouscripteur?.controls.idTelephone?.value,description:t.formCreationSouscripteur?.controls.telephone?.value},email:{idContact:t.formCreationSouscripteur?.controls.idEmail?.value,description:t.formCreationSouscripteur?.controls.email?.value},adresse:{idAdresse:t.formCreationSouscripteur?.controls.idAdresse?.value,description:t.formCreationSouscripteur?.controls.adresse?.value,wilaya:t.formCreationSouscripteur?.controls.wilaya?.value,commune:t.formCreationSouscripteur?.controls.commune?.value},genre:t.formCreationSouscripteur?.controls.genre?.value,situation:t.formCreationSouscripteur?.controls.situation?.value,profession:{id:t.formCreationSouscripteur?.controls.idProfession?.value,idProfession:t.formCreationSouscripteur?.controls.profession?.value},rib:{},permis:{}};t.jsonAvenant.personnes.push(a),t.typePersonne=null==t.formCreationAssure?.controls.raisonSocial?.value||""==t.formCreationAssure?.controls.raisonSocial?.value?"PH":"PM";let r={role:(t.roles.find(c=>"CP235"===c.code)||{}).idParam,risqueList:t.contrat?.groupeList?[t.contrat?.groupeList[0]?.risques[0].idRisque]:[],typeClient:t.typePersonne,idClient:t.formCreationAssure?.controls.codeClient?.value,nom:""!=t.formCreationAssure?.controls.nom?.value?t.formCreationAssure?.controls.nom?.value:null,prenom:""!=t.formCreationAssure?.controls.prenom?.value?t.formCreationAssure?.controls.prenom?.value:null,raisonSocial:""!=t.formCreationAssure?.controls.raisonSocial?.value?t.formCreationAssure?.controls.raisonSocial?.value:null,dateNaissance:t.formCreationAssure?.controls.dateNaissance?.value,nif:""!=t.formCreationAssure?.controls.nif?.value?t.formCreationAssure?.controls.nif?.value:null,nin:""!=t.formCreationAssure?.controls.nin?.value?t.formCreationAssure?.controls.nin?.value:null,telephone:{idContact:t.formCreationAssure?.controls.idTelephone?.value,description:t.formCreationAssure?.controls.telephone?.value},email:{idContact:t.formCreationAssure?.controls.idEmail?.value,description:t.formCreationAssure?.controls.email?.value},adresse:{idAdresse:t.formCreationAssure?.controls.idAdresse?.value,description:t.formCreationAssure?.controls.adresse?.value,wilaya:t.formCreationAssure?.controls.wilaya?.value,commune:t.formCreationAssure?.controls.commune?.value},genre:t.formCreationAssure?.controls.genre?.value,situation:t.formCreationAssure?.controls.situation?.value,profession:{id:t.formCreationAssure?.controls.idProfession?.value,idProfession:t.formCreationAssure?.controls.profession?.value},rib:{idRib:0,description:t.formCreationAssure?.controls.rib?.value},permis:{}};t.jsonAvenant.personnes.push(r)}t.jsonAvenant?.groupes?.[0]?.groupeList?.map((a,r)=>{}),t.jsonAvenant.packCompletList=t.packCompletList;const n=yield t.cryptoService.generateHmac(t.tkn,t.jsonAvenant),l={stringJson:JSON.stringify(t.jsonAvenant),signature:n};t.devisService.generateTarif(l).subscribe({next:a=>{t.returnedTarif=a,t.jsonAvenant.groupes=a.groupes,t.jsonAvenant?.groupes?.[0]?.groupeList?.forEach(r=>{r.risque.packCompletList.forEach(c=>{c.nouveau=!0})}),t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,console.log("this.reductionExist ",t.reductionExist),t.reductionExist&&null!=t.contrat.reduction?t.myStepper.next():t.calculePrimeReduction()}})}else{const o=t.formParamRisque.controls;for(const l in o);}})()}calculePrimeReduction(){var t=this;return(0,T.Z)(function*(){const n=yield t.cryptoService.generateHmac(t.tkn,t.jsonAvenant),l={stringJson:JSON.stringify(t.jsonAvenant),signature:n};t.avenantService.calculAvenant(l).subscribe({next:a=>{t.loaderCalcul=!1,t.retourCalcul=a,console.log("condition realised"),t.jsonAvenant.groupes=a.groupes,t.risqueGroupe=a.groupes,console.log(t.jsonAvenant),t.jsonAvenant.packCompletList=a.packCompletList,a.packCompletList?.map(r=>{t.jsonAvenant?.packCompletList?.map(c=>{r.idPackComplet==c.idPackComplet&&!c.isNew&&(c.isNew=!0)}),t.jsonAvenant.packCompletList.push(r)}),t.garantieAll?.map(r=>{t.jsonAvenant.primeList=a.primeList,t.PrimeTotale=a.primeList?.find(c=>101==c.idPrime)?.prime,t.jsonAvenant.taxeList=a.taxeList}),t.jsonAvenant.groupes?.[0]?.groupeList?.map(r=>{r.primeList=r?.primeList?.filter((c,p,m)=>m.findIndex(d=>d.idPrime===c.idPrime)===p),r.taxeList=r?.taxeList?.filter((c,p,m)=>m.findIndex(d=>d.taxe===c.taxe)===p)}),t.myStepper.next()},error:a=>{t.loaderCalcul=!1,R().fire(null!=a.message?a.message:"Une erreur s'est produite lors du calcul","","error")}})})()}checkAlertVol(t,n){this.selection.toggle(t),77==t.idGarantie&&n&&R().fire(' ATTENTION la GARANTIE "Vol Objets de Valeur" EST SOUMISE A LA DEROGATION DU  BO',"","warning"),this.checkGarantie(t,n)}checkGarantie(t,n){this.selection.toggle(t),n&&"G50"==t.codeGarantie&&this.getListParamRisque(t.sousGarantieList.data.find(o=>"SG91"==o.codeSousGarantie).idListParamRisque,t.sousGarantieList.data.find(o=>"SG91"==o.codeSousGarantie).idSousGarantie)}changeRisque(){var n,t=this;this.formParamRisque.valid&&(this.avenant?.controle||"A25"==this.avenant.code?(this.controleDevis=[],this.warningMessage=[],this.controleParam(),this.devisService.controleDevis(this.controleDevis,this.codeProduit).subscribe({next:(n=(0,T.Z)(function*(o){o.map(l=>{t.paraRisqueProduitCategory[0].map(a=>{a.paramRisque.idParamRisque==l.idParam&&(null!=l.message?(t.warningMessage.push({idParam:a.idParamRisque,msg:l.message}),"P116"==a.codeParam&&t.formParamRisque.controls[a.formName].value>t.maxContenue&&(t.devis.statue=1)):("P40"==a.codeParam||"P116"==a.codeParam)&&(t.devis.statue=0))})}),0!=t.warningMessage.length&&(yield R().fire(t.warningMessage[0].msg,"","warning")),0==o.filter(l=>!0===l.bloquant).length&&(t.getAllPackByProduit(2),t.getPack(t.contrat.groupeList[0].pack.idPack0,!0,!1),t.garantieAll.find(a=>77==a.idGarantie))}),function(l){return n.apply(this,arguments)}),error:n=>{this.handleError(n),console.log(n)}})):(this.getAllPackByProduit(2),this.getPack(this.contrat.groupeList[0].pack.idPack0,!0,!0)))}getPackMulti(t,n){this.devis.groupes=this.risqueGroupe,this.devis.groupes.map(o=>{o.idGroupe==n&&(o.idPack=t)}),this.risqueGroupe.map(o=>{o.idGroupe==n&&(o.idPack=t)}),this.packService.getPackById(t).subscribe({next:o=>{this.groupesPacks.find(a=>a.group==n)?this.groupesPacks.find(a=>a.group==n).pack=o:this.groupesPacks.push({group:n,pack:o})},error:o=>{console.log(o)}})}checkDoublons(t,n){const o=this.multiRisqueArray.some(c=>c.P30==t),l=this.contrat.groupeList.some(c=>c.risques.some(p=>p.risque.find(m=>m.colonne.includes("Ch\xe2ssis"))?.valeur==t)),a=this.contrat.groupeList.some(c=>c.risques.some(p=>p.risque.find(m=>m.colonne.includes("N\xb0 d'Immatriculation"))?.valeur==n)),r=this.multiRisqueArray.some(c=>c.P38==n);return(a||r)&&(l||o)?"both":a||r?"P38":!(!l&&!o)&&"P30"}submitChangeRisque(){let n=[];if(this.formParamRisque.valid){let o,l,r,c,p,a="debase",d=[];c=this.contrat.groupeList[0].idGroupe,p=this.contrat.groupeList[0].pack.idPack0,this.avenant.paramRisque.map(f=>{if(Object.keys(this.formParamRisque.value).map(v=>{v==f.paramRisque.codeParam&&(o=f.paramRisque.idParamRisque,"Liste of values"==f.paramRisque.typeChamp?.description?(l=this.formParamRisque.get(v)?.value,a=null,r={idParam:o,valeur:l},Object.assign(this.risqueConsult,{[f.paramRisque.libelle]:this.formParamRisque.get(v)?.value})):(l=null,"From Table"==f.paramRisque.typeChamp?.description?(a=this.formParamRisque.get(v)?.value,Object.assign(this.risqueConsult,{[f.libelle]:this.formParamRisque.get(v)?.value})):"date"!=f.paramRisque.typeChamp?.description?34==f.paramRisque.idParamRisque?a=String(Number(this.formParamRisque.get(v)?.value)):"P25"==v||"P26"==v?(l=this.formParamRisque.get(v)?.value,a=null,Object.assign(this.risqueConsult,"P25"==v?{[f.paramRisque.libelle]:this.formParamRisque.get(v)?.value.marque}:{[f.paramRisque.libelle]:this.formParamRisque.get(v)?.value.modele})):(a=this.formParamRisque.get(v)?.value,Object.assign(this.risqueConsult,{[f.paramRisque.libelle]:a})):(this.formParamRisque.get(v)?.setValue(x(this.formParamRisque.get(v)?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z")),a=this.formParamRisque.get(v)?.value,Object.assign(this.risqueConsult,{[f.paramRisque.libelle]:a})),r={idParam:o,valeur:a}),this.paramElement={idParam:o,reponse:{idReponse:l,description:a}})}),"A24"===this.avenant.code){const v=new Date(this.contrat.dateEffet),h=(new Date(this.contrat.dateExpiration).getTime()-v.getTime())/864e5,q=new Date(this.formParamRisque.get("P211")?.value);q.setDate(q.getDate()+h);const M={idParam:212,reponse:{idReponse:null,description:x(q).format("YYYY-MM-DD[T]HH:mm:ss.000Z")}};n.push(M)}n.push(this.paramElement),this.controleRisque.push(r)}),this.contrat.groupeList[0].risques.forEach(f=>{d.push({risque:{idRisque:f.idRisque,paramList:n}})}),this.risqueGroupe=[{description:"voyage",idGroupe:parseInt(c),idPack:p,groupeList:d}],this.jsonAvenant.groupes=[this.risqueGroupe[0]]}this.myStepper.next()}submitRisques(){let t;if(this.controleRisque=[],this.warningMessage=[],"45F"==this.codeProduit||"45L"==this.codeProduit){let n=this.avenant?.paramRisque?.find(l=>"P30"==l.paramRisque.codeParam).paramRisque.codeParam,o=this.avenant?.paramRisque?.find(l=>"P38"==l.paramRisque.codeParam).paramRisque.codeParam;t=this.checkDoublons(this.formParamRisque?.get(n)?.value,this.formParamRisque?.get(o)?.value)}if(this.formParamRisque.valid&&!t){let n,o,a,l="debase",r={paramList:[]},c=[];if(this.avenant.paramRisque.map(p=>{Object.keys(this.formParamRisque.value).map(m=>{m==p.paramRisque.codeParam&&(n=p.paramRisque.idParamRisque,"Liste of values"==p.paramRisque.typeChamp?.description?(o=this.formParamRisque.get(m)?.value,l=null,a={idParam:n,valeur:o},Object.assign(this.risqueConsult,{[p.paramRisque.libelle]:this.formParamRisque.get(m)?.value})):(o=null,"From Table"==p.paramRisque.typeChamp?.description?(l=this.formParamRisque.get(m)?.value,Object.assign(this.risqueConsult,{[p.libelle]:this.formParamRisque.get(m)?.value})):"date"!=p.paramRisque.typeChamp?.description?34==p.paramRisque.idParamRisque?l=String(Number(this.formParamRisque.get(m)?.value)):"P25"==m||"P26"==m?(o=this.formParamRisque.get(m)?.value,l=null,Object.assign(this.risqueConsult,"P25"==m?{[p.paramRisque.libelle]:this.formParamRisque.get(m)?.value.marque}:{[p.paramRisque.libelle]:this.formParamRisque.get(m)?.value.modele})):(l=this.formParamRisque.get(m)?.value,Object.assign(this.risqueConsult,{[p.paramRisque.libelle]:l})):(this.formParamRisque.get(m)?.setValue(x(this.formParamRisque.get(m)?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z")),l=this.formParamRisque.get(m)?.value,Object.assign(this.risqueConsult,{[p.paramRisque.libelle]:l})),a={idParam:n,valeur:l}),this.paramElement={idParam:n,reponse:{idReponse:o,description:l}})}),r.paramList.push(this.paramElement),this.controleRisque.push(a)}),this.risqueIndexBody=this.risqueIndexBody+1,c.push({numRisque:this.risqueIndexBody,risque:r}),this.multiRisqueProduct)if("new"==this.formParamRisque.get("groupe")?.value)this.contratService.addGroupe(this.formParamRisque.get("newGroupe")?.value).subscribe({next:p=>{this.formParamRisque.get("groupe")?.setValue({description:p.description,idGroupe:p.idGroupe,idPack:0,descriptionPack:"",new:1}),this.groupArray.push({description:p.description,idGroupe:p.idGroupe,new:1});let m=this.dataSourceGroupePack?this.dataSourceGroupePack.data:[];m.push({idGroupe:p.idGroupe,descriptionGroupe:p.description,pack:0,newGroupe:0}),this.dataSourceGroupePack=new P.by(m);const d=this.formParamRisque.get("groupe")?.value.description,f=this.risqueGroupe.find(g=>g.description===d),v=this.contrat.groupeList.find(g=>g.description===d);let _=v?this.contrat.groupeList.filter(g=>g.description==d)[0].pack.idPack0:0;0!=_&&this.getPackMulti(_,this.formParamRisque.get("groupe")?.value.idGroupe),f?f.groupeList.push({numRisque:this.risqueIndexBody,risque:r}):this.risqueGroupe.push({description:d,idGroupe:this.formParamRisque.get("groupe")?.value.idGroupe,idPack:v?this.contrat.groupeList.filter(g=>g.description==d)[0].pack.idPack0:0,groupeList:c})},error:p=>{console.log(p)}});else{if(!this.dataSourceGroupePack?.data?.find(v=>v.idGroupe==this.formParamRisque.get("groupe")?.value.idGroupe)){let v=this.dataSourceGroupePack?this.dataSourceGroupePack.data:[];v.push({idGroupe:this.formParamRisque.get("groupe")?.value.idGroupe,descriptionGroupe:this.formParamRisque.get("groupe")?.value.description,pack:this.formParamRisque.get("groupe")?.value.idPack,newGroupe:1}),this.dataSourceGroupePack=new P.by(v)}const m=this.risqueGroupe.find(v=>v.idGroupe===this.formParamRisque.get("groupe")?.value.idGroupe),d=this.contrat.groupeList.find(v=>v.idGroupe===this.formParamRisque.get("groupe")?.value.idGroupe);let f=d?this.contrat.groupeList.filter(v=>v.idGroupe==this.formParamRisque.get("groupe")?.value.idGroupe)[0].pack.idPack0:0;0!=f&&this.getPackMulti(f,this.formParamRisque.get("groupe")?.value.idGroupe),m?m.groupeList.push({numRisque:this.risqueIndexBody,risque:r}):this.risqueGroupe.push({description:this.formParamRisque.get("groupe")?.value.description,idGroupe:this.formParamRisque.get("groupe")?.value.idGroupe,idPack:d?this.contrat.groupeList.filter(v=>v.idGroupe==this.formParamRisque.get("groupe")?.value.idGroupe)[0].pack.idPack0:0,groupeList:c})}else this.risqueGroupe=[{description:"mono",groupeList:c}];this.devisService.controleDevis(this.controleRisque,this.codeProduit).subscribe({next:p=>{p.map(m=>{this.avenant.paramRisque.map(d=>{d.idParamRisque==m.idParam&&(m.bloquant?(this.formParamRisque.controls[d.formName].addValidators([ia(m.bloquant,m.message)]),this.formParamRisque.controls[d.formName].updateValueAndValidity()):null!=m.message?(this.warningMessage.push({idParam:d.idParamRisque,msg:m.message}),("P40"==d.codeParam||"P116"==d.codeParam)&&(this.devis.statue=1)):("P40"==d.codeParam||"P116"==d.codeParam)&&(this.devis.statue=0))})}),0!=this.warningMessage.length&&this._snackBar.open(this.warningMessage[0].msg,"fermer",{horizontalPosition:"end",panelClass:["warning-snackbar"]}),0==p.filter(m=>!0===m.bloquant).length&&(this.devis.groupes=this.risqueGroupe,this.multiRisqueProduct?this.multiRisqueTab(this.paramElement):this.myStepper.next(),this.getAllPack())},error:p=>{this.handleError(p),console.log(p)}})}else if(t){let n="";switch(t){case"P30":n="Num\xe9ro de Ch\xe2ssis doit etre unique.";break;case"P38":n="Le N\xb0 d'Immatriculation doit etre unique.";break;case"both":n="Le N\xb0 d'Immatriculation ainsi que le num\xe9ro de Ch\xe2ssis doivent etre uniques."}R().fire(n,"","error")}}multiRisqueTab(t){let n=this.formParamRisque.value;Object.keys(this.formParamRisque.value).map(o=>{n[o]="object"==typeof this.formParamRisque.controls[o].value?"Marque"==o?this.formParamRisque.controls[o].value?.marque:"Mod\xe8le"==o?this.formParamRisque.controls[o].value?.modele:this.formParamRisque.controls[o].value?.description:this.formParamRisque.controls[o].value}),Object.assign(n,{risqueNum:this.risqueIndex=this.risqueIndex+1}),this.multiRisqueArray.push(n),this.dataSourceRisque=new P.by(this.multiRisqueArray)}controleParam(){let t,n,l,o="debase";this.paraRisqueProduitCategory[0].map(a=>{Object.keys(this.formParamRisque.value).map(r=>{r==a.paramRisque.codeParam&&(t=a.paramRisque.idParamRisque,"Liste of values"==a.paramRisque?.typeChamp?.description?(n=this.formParamRisque.get(r)?.value,o=null,l={idParam:t,valeur:n}):(n=null,"From Table"==a.paramRisque?.typeChamp?.description?o=this.formParamRisque.get(r)?.value:"date"!=a.paramRisque?.typeChamp?.description?o=34==a.paramRisque?.idParamRisque?String(Number(this.formParamRisque.get(r)?.value)):this.formParamRisque.get(r)?.value:(this.formParamRisque.get(r)?.setValue(x(this.formParamRisque.get(r)?.value).format("YYYY-MM-DD[T]HH:mm:ss.000Z")),o=this.formParamRisque.get(r)?.value),l=[{idParam:t,valeur:o}]),this.controleDevis.push(l))})})}openDialog(t){const n={};this.multiRisqueArray.map(l=>{if(l.risqueNum==t)for(const[a,r]of Object.entries(l)){const c=this.avenant.paramRisque.find(p=>p.paramRisque.codeParam==a)?.paramRisque.libelle;c&&(n[c]=r)}}),this.dialog.open(fe._,{width:"60%",data:{risque:n}}).afterClosed().subscribe(l=>{})}deleteRisque(t){this.multiRisqueArray=this.multiRisqueArray.filter(l=>l.risqueNum!=t),this.dataSourceRisque.data=this.multiRisqueArray;let n,o=!1;this.risqueGroupe.map(l=>{l.groupeList=l.groupeList.filter(a=>(a.numRisque==t&&(n=l.idGroupe),o=l.idGroupe==n&&l.groupeList.length>1,a.numRisque!=t))}),o||(this.groupArray=this.groupArray.filter(l=>0!=l.new?l.idGroupe!=n:this.groupArray)),this.dataSourceGroupePack.data=this.dataSourceGroupePack.data.filter(l=>l.idGroupe!=n||!this.risqueGroupe.some(a=>a.idGroupe===l.idGroupe&&0===a.groupeList.length)),this.jsonAvenant.groupes=this.risqueGroupe,this.devis.groupes=this.risqueGroupe}editRisque(t,n){this.risqueSelected=!0,this.risquesInvolved.map(o=>{t==o.idRisque&&(this.idRisque=t,this.formParamRisque.controls[o.codeParam].setValue(o.description))})}editMatricule(){const t=this.risquesInvolved.find(o=>o.idRisque===this.idRisque);t&&(t.description=this.formParamRisque.get(t.codeParam)?.value),this.dataSourceParamRisque.data=this.risquesInvolved;let n=[];this.avenant?.paramRisque.forEach(o=>{let l={};l="Liste of values"==o.paramRisque?.typeChamp?.description||"P56"==o.paramRisque.codeParam||"P98"==o.paramRisque.codeParam||"P25"==o.paramRisque.codeParam||"P26"==o.paramRisque.codeParam?{idParam:o.paramRisque.idParamRisque,reponse:{idReponse:this.formParamRisque.get(o.paramRisque.codeParam)?.value,description:null}}:{idParam:o.paramRisque.idParamRisque,reponse:{idReponse:null,description:this.formParamRisque.get(o.paramRisque.codeParam)?.value}},n.push(l)}),this.risqueGroupe.map(o=>{t.idGroupe==o.idGroupe&&o.groupeList.map(l=>{l.risque.idRisque==t.idRisque&&(l.risque.paramList=n)})}),this.risqueEdited=!0,setTimeout(()=>{this.risqueEdited=!1},1e4)}submitApplicationAvenant(){var t=this;return(0,T.Z)(function*(){if(t.formApplicationAvenant.valid){t.loaderApplication=!0,"A24"===t.avenant.code&&(t.jsonAvenant.groupes=[t.risqueGroupe[0]],t.jsonAvenant.dateAvenant=x(t.jsonAvenant.dateAvenant).format("YYYY-MM-DD[T]HH:mm:ss.000Z"));const n=new Date(t.contrat.dateEffet);!sessionStorage.getItem("roles")?.includes("BO")&&H.getTime()>n.getTime()&&(t.jsonAvenant.approbation=!0),t.jsonAvenant.auditUser=sessionStorage.getItem("userId");const o=yield t.cryptoService.generateHmac(t.tkn,t.jsonAvenant),a={stringJson:JSON.stringify(t.jsonAvenant),signature:o};t.avenantService.submitAvenant(a).subscribe({next:r=>{t.loaderApplication=!1,t.avenantSave=!0,R().fire("Avenant appliqu\xe9 avec succ\xe9s","","success"),t.retourApplication=r,t.redirectConsultation()},error:r=>{t.loaderApplication=!1,R().fire(null!=r.message?r.message:"Une erreur s'est produite lors de l'application","","error")}})}})()}getDateExpiration(t){let n="",o={dateEffet:this.formApplicationAvenant.get("dateAvenant")?.value,duree:this.durees.filter(l=>l.id_duree==t)[0]};this.avenantService.getDateExpiration(o).subscribe({next:l=>{n=this.avenant.attributs.filter(a=>"dateExpiration"==a.idAtrribut.nomBdd)[0].idAtrribut.nomBdd,this.formApplicationAvenant.get(n)?.setValue(l)},error:l=>{}})}getAllConventions(){this.conventionService.getAllConventions().subscribe({next:t=>{this.conventions=t},error:t=>{console.log(t)}})}getAllReductions(){this.filterReduction.typeReduction=262,this.filterReduction.produit=this.idProduit,this.reductionService.reductionFiltre(this.filterReduction).subscribe({next:t=>{this.reductions=t},error:t=>{console.log(t)}})}getReductionByConvention(t){"aucuneConvention"!=t?(this.formReduction.get("reduction")?.setValidators([u.kI.required]),this.reductionService.getReductionByConvention(t).subscribe({next:n=>{0!=n.length?(this.reductions=n.filter(o=>o.produit==JSON.parse(sessionStorage.getItem("products")||"{}").find(l=>l.codeProduit==this.route.snapshot.paramMap.get("codeProduit"))),this.errorHandler.error=!1,this.errorHandler.msg=""):(this.errorHandler.error=!0,this.errorHandler.msg="cette convention n'a aucune r\xc3\xa9duction.")},error:n=>{console.log(n)}})):(this.errorHandler.error=!1,this.errorHandler.msg="",this.formReduction.get("reduction")?.setValidators([]),this.getAllReductions())}handleError(t){switch(t.status){case 500:this.errorHandler.error=!0,this.errorHandler.msg="Erreur syst\xe8me, veuillez contacter l'administrateur.";break;case 402:this.errorHandler.error=!0,this.errorHandler.msg="Erreur lors de la validation du devis, veuillez contacter l'administrateur.";break;case 404:this.errorHandler.error=!0,this.errorHandler.msg=t.message}}nextPrime(){this.reductionExist&&null!=this.contrat.reduction?this.myStepper.next():this.calculPrime()}submitReduction(){var t=this;return(0,T.Z)(function*(){if(t.formReduction?.get("convention")?.enable(),t.formReduction?.get("reduction")?.enable(),t.formReduction.valid)if("aucuneReduction"!=t.formReduction?.get("reduction")?.value){t.returnedTarif.idConvention=t.formReduction.get("convention")?.value,t.returnedTarif.idReduction=t.formReduction.get("reduction")?.value,t.returnedTarif.typeAvenant=t.idTypeAvenant;const n=yield t.cryptoService.generateHmac(t.tkn,t.returnedTarif),l={stringJson:JSON.stringify(t.returnedTarif),signature:n};t.reductionService.applyReduction(l).subscribe({next:a=>{t.jsonAvenant.groupes=a.groupes,t.jsonAvenant.primeList=a.primeList,t.jsonAvenant.taxeList=a.taxeList,"A13"==t.avenant?.code||"A18"==t.avenant?.code||"A22"==t.avenant?.code?(t.formReduction?.get("convention")?.enable(),t.formReduction?.get("reduction")?.enable(),t.myStepper.next()):(t.formReduction?.get("convention")?.disable(),t.formReduction?.get("reduction")?.disable(),t.calculePrimeReduction()),t.retourCalcul.primeList=a.primeList,t.retourCalcul.taxeList=a.taxeList,t.PrimeTotale=t.retourCalcul.primeList.find(r=>r.idPrime=101).primeProrata},error:a=>{console.log(a),t.handleError(a),"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&"A21"!=t.avenant?.code&&(t.formReduction?.get("convention")?.disable(),t.formReduction?.get("reduction")?.disable()),400==a.status&&(R().fire("l'assur\xe9 ne b\xe9n\xe9ficie plus de la r\xe9duction.","","info"),"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&"A22"!=t.avenant?.code?t.calculPrime():t.myStepper.next())}})}else t.formReduction?.get("convention")?.disable(),t.formReduction?.get("reduction")?.disable(),"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&"A22"!=t.avenant?.code&&null!=t.contrat.reduction?t.calculPrime():t.myStepper.next();else t.formReduction?.get("convention")?.disable(),t.formReduction?.get("reduction")?.disable(),"A13"!=t.avenant?.code&&"A18"!=t.avenant?.code&&"A22"!=t.avenant?.code&&null!=t.contrat.reduction?t.calculPrime():t.myStepper.next()})()}onFileSelected(t){this.selectedFile=t.target.files[0],this.uploadExcelFile()}uploadExcelFile(){if(this.selectedFile){const t=new FileReader;t.onload=n=>{if(null!=n.target){let o=n.target.result;const l=o?.split(",");2===l.length&&(o=l[1]),this.sendToAPI(o)}},t.readAsDataURL(this.selectedFile)}}sendToAPI(t){this.devisService.controleDevisMulti({file:t},this.codeProduit).subscribe({next:o=>{this.fileControle=o,this.fileControle.some(a=>a.description.some(r=>0!==r.length))&&(this.fileInput.nativeElement.value=null,this.fileSuccess=!1),this.fileControle.length>20&&(sessionStorage.getItem("roles")?.includes("DA")||sessionStorage.getItem("roles")?.includes("CDC"))?(R().fire("Vous n\u2019avez pas le privil\xe8ge pour faire ce devis veuillez voir avec le BO","","error"),this.fileSuccess=!1,this.fileInput.nativeElement.value=null):(this.devis.file=t,this.fileSuccess=!0)},error:o=>{R().fire(o,"","error"),this.fileInput.nativeElement.value=null}})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(ve.Y),e.Y36(ge.w),e.Y36(he.$),e.Y36(Ce.ux),e.Y36(G.b),e.Y36(k.uw),e.Y36(Ae.F),e.Y36(u.qu),e.Y36(Pe.Y),e.Y36(qe.e),e.Y36(xe.D),e.Y36(S.gz),e.Y36(O.n),e.Y36(u.qu),e.Y36(S.F0),e.Y36(U.H),e.Y36(z.F),e.Y36(K.J),e.Y36(be.t),e.Y36(W.M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-application-avenant-vie"]],viewQuery:function(t,n){if(1&t&&(e.Gf(Se,5),e.Gf(w.NW,5),e.Gf(Te,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.myStepper=o.first),e.iGM(o=e.CRH())&&(n.paginator=o.first),e.iGM(o=e.CRH())&&(n.fileInput=o.first)}},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"header-title",2,"padding-left","3%"],["aria-hidden","false","matTooltip","Retour","matTooltipPosition","left",1,"material-symbols-outlined",3,"mouseup"],[3,"linear"],["stepper",""],[3,"stepControl","editable",4,"ngIf"],[3,"editable",4,"ngIf"],[3,"editable"],["matStepLabel",""],["multi","",1,"example-headers-align"],[1,"resume"],[4,"ngIf","ngIfElse"],["renouvellement",""],[4,"ngFor","ngForOf"],[1,"row-button"],["matStepperPrevious","",1,"btn","btn-cancel"],[1,"btn","btn-action",3,"click"],["color","white","diameter","30",4,"ngIf"],[4,"ngIf"],[3,"stepControl","editable"],[1,"login-form",2,"padding","0 24px 24px 24px",3,"formGroup"],["formDirective","ngForm"],[1,"row"],["appearance","outline","class","col-md-6",4,"ngIf"],[3,"expanded"],[1,"row",2,"padding","1rem 2rem"],["appearance","outline",1,"col-md-6"],["formControlName","agence"],["class","row-button",4,"ngIf","ngIfElse"],["suivant1",""],["type","number","matInput","","formControlName","attestation"],["formControlName","motif"],[3,"value"],["type","text","matInput","","formControlName","commentaire"],["matInput","","formControlName","dateAvenant",3,"matDatepicker"],["matSuffix","",3,"for"],["pickerAvenant",""],[3,"formControlName"],["type","text","matInput","",3,"formControlName"],["matInput","",3,"matDatepicker","formControlName","min","dateChange"],["pickerAttribut",""],[1,"btn","btn-cancel",3,"mouseup"],["color","white","diameter","30"],["mat-table","",1,"devis-table",3,"dataSource"],["matColumnDef","idRisque"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","paramRisque"],["mat-header-row","","class","example-second-header-row",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of risque",3,"pageSize","pageSizeOptions"],["matStepperNext","",1,"btn","btn-action"],["mat-header-cell",""],["mat-cell",""],["mat-header-row","",1,"example-second-header-row"],["mat-row",""],["class","example-headers-align","multi","",4,"ngIf"],["class"," download",4,"ngIf"],["matColumnDef","action"],["mat-icon-button","","type","button","aria-label","menu devis list",3,"matMenuTriggerFor"],["xPosition","after",1,"menu-devis"],["menu","matMenu"],["mat-menu-item","","type","button",3,"click"],[1,"process-Para"],[1,"file-row"],[1,"material-symbols-outlined"],["class","login-form","style","padding: 0 24px 24px 24px",3,"formGroup",4,"ngIf"],["class","","class","row-button",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["hideToggle","","class","panel-risque",3,"expanded",4,"ngFor","ngForOf"],["class","risque-panel","hideToggle","",3,"expanded",4,"ngIf"],["mat-table","","class","gestion-table risque",3,"dataSource",4,"ngIf"],["notChangeRisque",""],[1,"alert","alert-success"],["hideToggle","",1,"panel-risque",3,"expanded"],[1,"categoryTitle"],["class","row-button",4,"ngIf"],["appearance","outline","class","col-md-5",4,"ngIf"],["class","col-md-5","appearance","outline",4,"ngIf"],["appearance","outline",1,"col-md-5"],[3,"formControlName","selectionChange"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["matInput","",3,"type","formControlName"],["matInput","",3,"matDatepicker","min","max","formControlName","dateChange"],["picker",""],["matInput","",3,"matDatepicker","min","formControlName"],[3,"value",4,"ngIf"],["hideToggle","",1,"risque-panel",3,"expanded"],["appearance","outline",1,"col-md-3"],["formControlName","groupe",3,"ngModel","ngModelChange"],["value","new"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","text","formControlName","newGroupe"],["mat-table","",1,"gestion-table","risque",3,"dataSource"],["matColumnDef","risqueNum"],["matColumnDef","NDImmatriculation"],["matColumnDef","groupe"],["mat-icon-button","","type","button","aria-label","menu risque list",3,"matMenuTriggerFor"],["xPosition","after"],["adjonction",""],["matStepperPrevious","",1,"btn","btn-cancel",3,"click"],["type","button","matStepperNext","",1,"btn","btn-action"],[1,"download"],["id","wrap"],[1,"btn","btn-file"],["type","file","name","fileInput",3,"change"],["fileInput",""],[1,"alert","alert-danger"],[1,"error-lines"],[1,"row",2,"display","flex","justify-content","space-between","align-items","center"],[3,"value","disabled","selectionChange"],["class","btn btn-secondary ","style","display: flex; width: 133px;",3,"click",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["mat-table","","multiTemplateDataRows","",1,"mat-elevation-z8","pack-table",3,"dataSource"],["matColumnDef","select"],["matColumnDef","garantie"],["matColumnDef","plafond"],["matColumnDef","franchise"],["matColumnDef","formule"],["matColumnDef","prime",4,"ngIf"],["matColumnDef","bonus",4,"ngIf"],["matColumnDef","sousGarantie"],["mat-cell","","class","example-element-row",3,"example-expanded-row",4,"matCellDef"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","example-detail-row",4,"matRowDef","matRowDefColumns"],["hideToggle","","class","panel-risque",3,"expanded",4,"ngIf"],[1,"row","card"],[1,"prime-card"],[2,"font-size","21px","color","#00008f","font-weight","600"],[2,"font-size","18px","font-weight","600","margin-right","12px"],[2,"float","right"],["class","prime-card",4,"ngIf"],["class","btn btn-action",3,"click",4,"ngIf","ngIfElse"],[1,"btn","btn-secondary",2,"display","flex","width","133px",3,"click"],[1,"material-symbols-outlined",2,"margin-right","9px","font-size","24px"],[3,"checked","formControl","click","change"],["plafondNotEmpty",""],["plafondInput",""],[3,"formControl"],["plafondValue",""],["type","text","matInput","",3,"formControl"],["plafondNull",""],["franchiseNotEmpty",""],["franchiseInput",""],["franchiseValue",""],["formuleNotEmpty",""],["formuleInput",""],["formuleValue",""],["matColumnDef","prime"],["primeNull",""],["matColumnDef","bonus"],["bonusNull",""],["mat-cell","",1,"example-element-row"],["mat-icon-button","","type","button","class","expandButton","aria-label","",3,"click",4,"ngIf"],["mat-icon-button","","type","button","aria-label","",1,"expandButton",3,"click"],[1,"example-element-detail"],["mat-table","","multiTemplateDataRows","","class","mat-elevation-z8 pack-table innertable",3,"dataSource",4,"ngIf"],["mat-table","","multiTemplateDataRows","",1,"mat-elevation-z8","pack-table","innertable",3,"dataSource"],["matColumnDef","more"],["mat-header-row",""],["mat-row","",1,"example-detail-row"],["class","col-md-12",4,"ngIf"],[1,"col-md-12"],["mat-table","",1,"mat-elevation-z8","adresse-table",3,"dataSource"],["matColumnDef","idList"],["matColumnDef","description"],["aria-label","Select page  of users",3,"pageSize","pageSizeOptions"],["mat-icon-button","","type","button","aria-label","menu list param",3,"matMenuTriggerFor"],["class","btn btn-action","matStepperNext","",4,"ngIf"],[3,"dataSource"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","pack"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"placeholder","ngModel","name","disabled","ngModelChange","selectionChange"],[1,"row",3,"formGroup","ngSubmit"],["formControlName","convention",3,"value","valueChange","selectionChange"],["formControlName","reduction",3,"value","valueChange"],[1,""],["type","submit",1,"btn","btn-action"],["type","button","matStepperPrevious","",1,"btn","btn-cancel"],[1,"primeTotale"]],template:function(t,n){1&t&&e.YNc(0,ea,28,14,"div",0),2&t&&e.Q6J("ngIf",n.avenant&&n.formCreationSouscripteur&&n.formCreationAssure)},dependencies:[y.sg,y.O5,E.d,J.Hw,I.pp,I.ib,I.yz,I.yK,L.VK,L.OP,L.p6,u._Y,u.Fj,u.wV,u.JJ,u.JL,u.oH,u.sg,u.u,N.TO,N.KE,N.hX,N.R9,X.Nt,P.BZ,P.fO,P.as,P.w1,P.Dz,P.nj,P.ge,P.ev,P.XQ,P.Gk,Q.gM,w.NW,j.Mq,j.hl,j.nW,ee.gD,D.ey,B.lW,Y.C0,Y.VY,Y.Vq,Y.Ic,Y.fd,Re.oG,te.Ou,u.On,y.JJ,ie.X],styles:['.buttons.row[_ngcontent-%COMP%]{justify-content:space-between;padding:0 21px}h2.heading[_ngcontent-%COMP%]{color:#00008f;font-weight:700!important;letter-spacing:.5px}.mat-dialog-content[_ngcontent-%COMP%]{padding-top:15px}.mat-radio-button[_ngcontent-%COMP%]{margin:0 12px}.mat-form-field[_ngcontent-%COMP%]{padding-top:15px}.mat-error[_ngcontent-%COMP%]{font-size:11px}.container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}table.question-table[_ngcontent-%COMP%]{width:100%}.mat-header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#00008f}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:16px}.mat-header-cell[_ngcontent-%COMP%]{color:#333;font-weight:600;letter-spacing:.5px;font-size:15px;width:165px}.header-tab[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.mat-paginator[_ngcontent-%COMP%]{background-color:transparent;margin:20px auto auto;width:80%}.example-first-header-row[_ngcontent-%COMP%]{background-color:#00008f}.example-first-header-row[_ngcontent-%COMP%]   th.mat-header-cell[_ngcontent-%COMP%]{border:none;color:#fff;font-size:18px}.mat-column-valeurGarantie.mat-cell[_ngcontent-%COMP%], .mat-column-valeurEnvloppe.mat-cell[_ngcontent-%COMP%]{text-align:center}.mat-header-cell.mat-icon[_ngcontent-%COMP%]{color:#fff}.mat-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]:hover, .mat-header-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]:hover{color:#d14723;cursor:pointer}  .mat-tooltip{font-size:14px}  .mat-horizontal-stepper-header{pointer-events:none!important}.row-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:0 3rem;margin-top:2rem}.center-spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%) translateY(-50%)}.prime-card[_ngcontent-%COMP%]{background:rgb(247,247,249);width:-moz-fit-content;width:fit-content;margin-top:3rem;border:1px solid rgba(0,0,0,.12);padding:18px 14px}.row.card[_ngcontent-%COMP%]{justify-content:space-evenly;width:100%}.resume-buttons[_ngcontent-%COMP%]{margin-top:4rem;display:flex;justify-content:space-between}.resume-buttons[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:9px;font-size:24px}table.resume[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border-spacing:0 19px;margin-top:4rem}table.resume[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:17px;padding:12px 19px;border:1px solid rgba(0,0,0,.12)}table.resume[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background:rgb(247,247,249)}  .mat-progress-spinner circle, .mat-spinner[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke:#00008f}.mat-expansion-panel-header[_ngcontent-%COMP%]{background:rgba(199,199,199,.2)!important;font-weight:600;font-size:16px}.mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}.mat-expansion-panel-header-title[_ngcontent-%COMP%]{color:#00008f}.risque-panel.mat-expansion-panel[_ngcontent-%COMP%]{box-shadow:none}.risque-panel[_ngcontent-%COMP%]     .mat-expansion-panel-content{padding:1rem}.container[_ngcontent-%COMP%]{background-color:#fff;padding:40px 0;height:100%;overflow-x:hidden;box-shadow:0 .5rem 1rem #00000026}h2.header-title[_ngcontent-%COMP%]{padding:0 24px;font-size:21px!important;color:#00008f;font-weight:600!important;letter-spacing:1px;display:flex;justify-content:flex-end}h2.header-title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:1rem}  .mat-form-field-appearance-outline .mat-form-field-prefix{top:auto!important}  .mat-step-header .mat-step-icon-state-edit{background-color:#d14624}  .mat-step-text-label{font-size:16px}  .mat-step-label-selected .mat-step-text-label{font-size:16px;font-weight:700;color:#00008f}.btn.btn-action[_ngcontent-%COMP%]{margin-top:2rem;float:right}.btn.btn-cancel[_ngcontent-%COMP%]{margin-top:2rem;float:left}.btn.btn-download[_ngcontent-%COMP%]{box-shadow:0 1px 2px #00000026;transition:box-shadow .3s ease-in-out}.btn.btn-download[_ngcontent-%COMP%]:hover{box-shadow:0 5px 15px #0000004d}table[_ngcontent-%COMP%]{width:100%}.innertable[_ngcontent-%COMP%]{background-color:#f7f7f9}.expandButton[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:26px!important}.cdk-column-expandedDetail[_ngcontent-%COMP%]{border-bottom-width:0px}.mat-header-row[_ngcontent-%COMP%]{background-color:#f7f7f9}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .mat-menu-item[_ngcontent-%COMP%]{font-size:16px}.mat-menu-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:21px;height:-moz-fit-content;height:fit-content}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]){color:#00008f}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled])   .mat-icon[_ngcontent-%COMP%]{color:#00008f}.mat-icon[_ngcontent-%COMP%]{height:100%;font-size:36px;width:-moz-fit-content;width:fit-content}.mat-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#00008f}  .mat-checkbox-checked.mat-accent.mat-checkbox-disabled .mat-checkbox-background, .mat-checkbox-indeterminate.mat-accent[_ngcontent-%COMP%]   .mat-checkbox-background[_ngcontent-%COMP%]{background-color:#ccc}  .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-image:none}.mat-input-element[_ngcontent-%COMP%]:disabled{color:inherit}.mat-cell[_ngcontent-%COMP%]{padding-top:10px}.pack-table[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{font-size:16px}.resume-table[_ngcontent-%COMP%]{margin-top:2rem}.resume-table[_ngcontent-%COMP%]   .mat-cell[_ngcontent-%COMP%]{font-size:16px;border-right:1px solid rgba(0,0,0,.12);padding-left:30px}.resume-table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{background-color:#00008f;color:#fff;border-right:1px solid white;padding-left:30px}.mat-cell[_ngcontent-%COMP%]:not(.mat-column-garantie){font-weight:600}.row.card[_ngcontent-%COMP%]{justify-content:end;width:100%}.panel-risque[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{margin-right:1rem}.categoryTitle[_ngcontent-%COMP%]{text-transform:capitalize}  .mat-progress-bar-fill:after{background-color:#d14624}mat-form-field.ng-invalid.ng-touched[_ngcontent-%COMP%]{animation:example;animation-duration:.3s;margin-bottom:2rem}.button__text[_ngcontent-%COMP%]{transition:all .2s}.button--loading[_ngcontent-%COMP%]   .button__text[_ngcontent-%COMP%]{visibility:hidden;opacity:0}.button--loading[_ngcontent-%COMP%]{position:relative}.button--loading[_ngcontent-%COMP%]:after{content:"";position:absolute;width:16px;height:16px;inset:0;margin:auto;border:4px solid transparent;border-top-color:#fff;border-radius:50%;animation:_ngcontent-%COMP%_button-loading-spinner 1s ease infinite}.button--loading[_ngcontent-%COMP%]:hover{background-color:#00008f}.example-element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex}tr.example-detail-row[_ngcontent-%COMP%]{height:0}.mat-column-expandedDetail[_ngcontent-%COMP%]{padding:0}@keyframes _ngcontent-%COMP%_button-loading-spinner{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.primeTotale[_ngcontent-%COMP%]{color:#00008f;font-weight:600}.consult-devis[_ngcontent-%COMP%]{font-weight:600;color:#155724}.btn-action[_ngcontent-%COMP%]:disabled:hover{background-color:#00008f;color:#fff}.mat-column-expandedDetail[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important}table[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:26px}table[_ngcontent-%COMP%]   .mat-column-plafond[_ngcontent-%COMP%]{padding-left:1rem}.process-Para[_ngcontent-%COMP%]{font-size:16px;text-align:center;margin:4rem}.download[_ngcontent-%COMP%]{text-align:center;margin-top:3rem;font-size:17px;font-weight:600}.download[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:50%;margin:auto;line-height:2rem}#wrap[_ngcontent-%COMP%]{margin:20px auto;text-align:center}input[type=file][_ngcontent-%COMP%]::file-selector-button{padding:0 16px;height:40px;cursor:pointer;background-color:#fff;color:#00008f;font-weight:700!important;border:1px solid #00008f;margin-right:16px;transition:background-color .2s;border-radius:50px}.btn-file[_ngcontent-%COMP%]{padding:0 16px;height:40px;cursor:pointer;background-color:#fff;color:#00008f;font-weight:700!important;border:1px solid #00008f;margin-right:16px;transition:background-color .2s;border-radius:50px}input[type=file][_ngcontent-%COMP%]::file-selector-button:hover{background-color:#f3f4f6}input[type=file][_ngcontent-%COMP%]::file-selector-button:active{background-color:#e5e7eb}.file-row[_ngcontent-%COMP%]{display:flex;justify-content:space-around;width:50%;margin:auto}.file-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:flex;align-items:center}.file-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:1rem}'],data:{animation:[(0,b.X$)("detailExpand",[(0,b.SB)("collapsed",(0,b.oB)({height:"0px",minHeight:"0",display:"none"})),(0,b.SB)("expanded",(0,b.oB)({height:"*"})),(0,b.eR)("expanded <=> collapsed",(0,b.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))]),(0,b.X$)("enterAnimation",[(0,b.eR)(":enter",[(0,b.oB)({opacity:0,transform:"translateX(-100%)"}),(0,b.jt)(400)])])]}}),i})();function ia(i,s){return t=>({bloquant:i,msg:s})}var na=A(3205);function oa(i,s){1&i&&e._UZ(0,"mat-spinner",13)}function aa(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Refuser "),e.qZA())}function ra(i,s){1&i&&e._UZ(0,"mat-spinner",13)}function sa(i,s){1&i&&(e.TgZ(0,"span"),e._uU(1," Valider "),e.qZA())}let la=(()=>{class i{constructor(t,n,o,l){this.data=t,this.dialogRef=n,this.avenantService=o,this.router=l,this.approbation={},this.loaderValider=!1,this.loaderRefuser=!1}ngOnInit(){}validationAvenant(t){t?this.loaderValider=!0:this.loaderRefuser=!0,this.approbation={idContratAvenant:this.data.idContratAvenant,validation:t,auditUser:sessionStorage.getItem("userId"),commentaire:this.commentaire},this.avenantService.approbationAvenant(this.approbation).subscribe(n=>{this.commentaire="",t?(this.loaderValider=!1,R().fire("Avenant approuv\xe9","","success")):(this.loaderRefuser=!1,R().fire("Avenant refus\xe9","","success")),this.dialogRef.close()},n=>{this.loaderValider=!1,this.loaderRefuser=!1,R().fire("Une erreur s'est produite lors de l'approbation","","error")})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(k.WI),e.Y36(k.so),e.Y36(O.n),e.Y36(S.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-validation-avenant-vie"]],decls:20,vars:5,consts:[[1,"heading"],[2,"float","right","font-size","24px"],["aria-hidden","false","aria-label","","matTooltip","","matTooltipPosition","right","mat-dialog-close","",1,"material-symbols-outlined"],[1,"mat-typography"],[1,"row"],["appearance","outline",1,"col-md-12","login-field"],["matInput","",3,"ngModel","ngModelChange"],["ctrl","ngModel"],[1,"row-button"],[1,"btn","btn-delete",3,"mouseup"],["color","white","diameter","30",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-validation",3,"mouseup"],["color","white","diameter","30"]],template:function(t,n){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Approbation avenant "),e.TgZ(2,"span",1)(3,"mat-icon",2),e._uU(4," close "),e.qZA()()(),e._UZ(5,"mat-divider"),e.TgZ(6,"mat-dialog-content",3)(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e._uU(10,"Commentaire"),e.qZA(),e.TgZ(11,"input",6,7),e.NdJ("ngModelChange",function(l){return n.commentaire=l}),e.qZA()()(),e.TgZ(13,"div",8)(14,"button",9),e.NdJ("mouseup",function(){return n.validationAvenant(!1)}),e.YNc(15,oa,1,0,"mat-spinner",10),e.YNc(16,aa,2,0,"span",11),e.qZA(),e.TgZ(17,"button",12),e.NdJ("mouseup",function(){return n.validationAvenant(!0)}),e.YNc(18,ra,1,0,"mat-spinner",10),e.YNc(19,sa,2,0,"span",11),e.qZA()()()),2&t&&(e.xp6(11),e.Q6J("ngModel",n.commentaire),e.xp6(4),e.Q6J("ngIf",n.loaderRefuser),e.xp6(1),e.Q6J("ngIf",!n.loaderRefuser),e.xp6(2),e.Q6J("ngIf",n.loaderValider),e.xp6(1),e.Q6J("ngIf",!n.loaderValider))},dependencies:[y.O5,E.d,J.Hw,u.Fj,u.JJ,N.KE,N.hX,X.Nt,Q.gM,k.ZT,k.xY,te.Ou,u.On],styles:[".buttons.row[_ngcontent-%COMP%]{justify-content:space-between}h2.heading[_ngcontent-%COMP%]{color:#00008f;font-weight:700!important;letter-spacing:.5px}.mat-dialog-content[_ngcontent-%COMP%], .mat-form-field[_ngcontent-%COMP%]{padding-top:15px}.mat-error[_ngcontent-%COMP%]{font-size:11px}.row-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:2rem}"]}),i})();var ua=A(4803);const ca=["innerTables"],ma=["innerSort"];function pa(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.ALo(2,"dateFormatPipe"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,null==t?null:t.reponse)," ")}}function da(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("",null==t?null:t.reponse," ")}}function _a(i,s){if(1&i&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),e._uU(4),e.qZA(),e.YNc(5,pa,3,3,"div",20),e.YNc(6,da,2,1,"div",20),e.qZA()()()),2&i){const t=s.$implicit;e.xp6(4),e.hij("",t.attribut.attribut,": "),e.xp6(1),e.Q6J("ngIf","date"==(null==t.attribut.type?null:t.attribut.type.description)),e.xp6(1),e.Q6J("ngIf","date"!=(null==t.attribut.type?null:t.attribut.type.description))}}function fa(i,s){if(1&i&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),e._uU(4,"Nom: "),e.qZA(),e.TgZ(5,"div",10),e._uU(6),e.qZA()()(),e.TgZ(7,"div",7)(8,"div",8)(9,"div",9),e._uU(10,"Pr\xe9nom:"),e.qZA(),e.TgZ(11,"div",10),e._uU(12),e.qZA()()()()),2&i){const t=e.oxw(2);e.xp6(6),e.Oqu(t.informationsAssure.nom),e.xp6(6),e.hij("",t.informationsAssure.prenom," ")}}function va(i,s){if(1&i&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),e._uU(4,"Raison Social: "),e.qZA(),e.TgZ(5,"div",10),e._uU(6),e.qZA()()()()),2&i){const t=e.oxw(2);e.xp6(6),e.Oqu(t.informationsAssure.raisonSocial)}}function ga(i,s){if(1&i&&(e.TgZ(0,"mat-expansion-panel",4)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e._uU(3," Information assur\xe9 "),e.qZA()(),e.TgZ(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8)(8,"div",9),e._uU(9,"Type Client: "),e.qZA(),e.TgZ(10,"div",10),e._uU(11),e.qZA()()()(),e.YNc(12,fa,13,2,"div",21),e.YNc(13,va,7,1,"ng-template",null,22,e.W1O),e.TgZ(15,"div",6)(16,"div",7)(17,"div",8)(18,"div",9),e._uU(19,"Email: "),e.qZA(),e.TgZ(20,"div",10),e._uU(21),e.qZA()()(),e.TgZ(22,"div",7)(23,"div",8)(24,"div",9),e._uU(25,"T\xe9l\xe9phone:"),e.qZA(),e.TgZ(26,"div",10),e._uU(27),e.qZA()()()()()()),2&i){const t=e.MAs(14),n=e.oxw();e.Q6J("expanded",!0),e.xp6(11),e.Oqu(n.informationsAssure.typeClient),e.xp6(1),e.Q6J("ngIf","personne physique"==n.informationsAssure.typeClient)("ngIfElse",t),e.xp6(9),e.Oqu(n.informationsAssure.email),e.xp6(6),e.hij("",n.informationsAssure.tel," ")}}function ha(i,s){if(1&i&&(e.TgZ(0,"mat-expansion-panel",4)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),e._uU(3," Information souscripteur "),e.qZA()(),e.TgZ(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8)(8,"div",9),e._uU(9,"Nom: "),e.qZA(),e.TgZ(10,"div",10),e._uU(11),e.qZA()()(),e.TgZ(12,"div",7)(13,"div",8)(14,"div",9),e._uU(15,"Pr\xe9nom:"),e.qZA(),e.TgZ(16,"div",10),e._uU(17),e.qZA()()()(),e.TgZ(18,"div",6)(19,"div",7)(20,"div",8)(21,"div",9),e._uU(22,"Email: "),e.qZA(),e.TgZ(23,"div",10),e._uU(24),e.qZA()()(),e.TgZ(25,"div",7)(26,"div",8)(27,"div",9),e._uU(28,"T\xe9l\xe9phone:"),e.qZA(),e.TgZ(29,"div",10),e._uU(30),e.qZA()()()()()()),2&i){const t=e.oxw();e.Q6J("expanded",!0),e.xp6(11),e.Oqu(t.informationsSouscripteur.nom),e.xp6(6),e.hij("",t.informationsSouscripteur.prenom," "),e.xp6(7),e.Oqu(t.informationsSouscripteur.email),e.xp6(6),e.hij("",t.informationsSouscripteur.tel," ")}}function Ca(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.reponse.idParamReponse.description)}}function Aa(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.ALo(2,"dateFormatPipe"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(e.lcZ(2,1,t.reponse.valeur))}}function Pa(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.reponse.valeur)}}function qa(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.reponse.idParamReponse.description)}}function xa(i,s){if(1&i&&(e.TgZ(0,"div",10),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.reponse.description)}}function ba(i,s){if(1&i&&(e.TgZ(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),e._uU(4),e.qZA(),e.YNc(5,Ca,2,1,"div",20),e.YNc(6,Aa,3,3,"div",20),e.YNc(7,Pa,2,1,"div",20),e.YNc(8,qa,2,1,"div",20),e.YNc(9,xa,2,1,"div",20),e.qZA()()()),2&i){const t=s.$implicit;e.xp6(4),e.Oqu(t.libelle),e.xp6(1),e.Q6J("ngIf","P25"==t.codeRisque||"P26"==t.codeRisque),e.xp6(1),e.Q6J("ngIf","date"==t.typeChamp),e.xp6(1),e.Q6J("ngIf","Number"==t.typeChamp||"String"==t.typeChamp),e.xp6(1),e.Q6J("ngIf","Liste of values"==t.typeChamp),e.xp6(1),e.Q6J("ngIf","From Table"==t.typeChamp)}}function Ra(i,s){if(1&i&&(e.TgZ(0,"mat-expansion-panel",25),e.ynx(1),e.TgZ(2,"mat-expansion-panel-header")(3,"mat-panel-title",26),e._uU(4),e.qZA()(),e.YNc(5,ba,10,6,"div",27),e.BQk(),e.qZA()),2&i){const t=s.$implicit,n=s.index;e.Q6J("expanded",!0),e.xp6(4),e.hij(" ",null==t[n]?null:t[n].categorieParamRisque," "),e.xp6(1),e.Q6J("ngForOf",t)}}function Sa(i,s){if(1&i&&(e.TgZ(0,"mat-accordion",23),e.YNc(1,Ra,6,3,"mat-expansion-panel",24),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.informationsRisque)}}function Ta(i,s){1&i&&(e.TgZ(0,"th",38),e._uU(1,"Description"),e.qZA())}function ya(i,s){if(1&i&&(e.TgZ(0,"td",39),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.description," ")}}function ka(i,s){1&i&&e._UZ(0,"th",38)}function Za(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",39)(1,"button",40),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.toggleRow(l))}),e.TgZ(2,"mat-icon"),e._uU(3),e.qZA()()()}if(2&i){const t=s.$implicit,n=e.oxw(2);e.xp6(3),e.Oqu(n.expandedElement===t?"expand_less":"expand_more")}}function La(i,s){if(1&i&&(e.TgZ(0,"th",38),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t,"")}}function Ia(i,s){if(1&i&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"dateFormatPipe"),e.qZA()),2&i){const t=s.$implicit,n=e.oxw(),o=n.$implicit,l=n.index;e.xp6(1),e.hij(" ","DateDeNaissance"!=o?t.risque[l][o]:e.lcZ(2,1,t.risque[l][o])," ")}}function Na(i,s){1&i&&(e.ynx(0,50),e.YNc(1,La,2,1,"th",30),e.YNc(2,Ia,3,3,"td",31),e.BQk()),2&i&&e.Q6J("matColumnDef",s.$implicit)}function Ma(i,s){1&i&&(e.TgZ(0,"th",38),e._uU(1," Action "),e.qZA())}function wa(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",39)(1,"button",51)(2,"mat-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",52,53)(6,"button",54),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(5);return e.KtG(a.consultRisque(l.idRisque,a.idGroupe))}),e.TgZ(7,"mat-icon"),e._uU(8,"zoom_in"),e.qZA(),e.TgZ(9,"span"),e._uU(10,"Consulter risque"),e.qZA()()()()}if(2&i){const t=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",t)}}function Va(i,s){1&i&&e._UZ(0,"tr",55)}function Oa(i,s){1&i&&e._UZ(0,"tr",56)}function Ya(i,s){if(1&i&&(e.TgZ(0,"div",44)(1,"table",45,46),e.YNc(3,Na,3,1,"ng-container",47),e.ynx(4,48),e.YNc(5,Ma,2,0,"th",30),e.YNc(6,wa,11,1,"td",31),e.BQk(),e.YNc(7,Va,1,0,"tr",34),e.YNc(8,Oa,1,0,"tr",49),e.qZA()()),2&i){const t=e.oxw(2).$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("dataSource",t.risques),e.xp6(2),e.Q6J("ngForOf",n.displayedColumnsCol),e.xp6(4),e.Q6J("matHeaderRowDef",n.displayedColumnsRsInner),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumnsRsInner)}}function Da(i,s){if(1&i&&(e.TgZ(0,"div",42),e.YNc(1,Ya,9,4,"div",43),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("@detailExpand",t==n.expandedElement?"expanded":"collapsed"),e.xp6(1),e.Q6J("ngIf",n.expandedElement)}}function Ua(i,s){if(1&i&&(e.TgZ(0,"td",39),e.YNc(1,Da,2,2,"div",41),e.qZA()),2&i){const t=s.$implicit,n=e.oxw(2);e.uIk("colspan",n.displayedColumnsRs.length),e.xp6(1),e.Q6J("ngIf",null==t.risques||null==t.risques.data?null:t.risques.data.length)}}function Ea(i,s){1&i&&e._UZ(0,"tr",55)}function Ja(i,s){if(1&i&&e._UZ(0,"tr",56),2&i){const t=s.$implicit,n=e.oxw(2);e.ekj("example-element-row",null==t.risques||null==t.risques.data?null:t.risques.data.length)("example-expanded-row",n.expandedElement===t)}}function Qa(i,s){1&i&&e._UZ(0,"tr",57)}const Ga=function(){return["expandedDetail"]},ja=function(){return[5,10]};function Ba(i,s){if(1&i&&(e.TgZ(0,"mat-accordion",23)(1,"table",28),e.ynx(2,29),e.YNc(3,Ta,2,0,"th",30),e.YNc(4,ya,2,1,"td",31),e.BQk(),e.ynx(5,32),e.YNc(6,ka,1,0,"th",30),e.YNc(7,Za,4,1,"td",31),e.BQk(),e.ynx(8,33),e.YNc(9,Ua,2,2,"td",31),e.BQk(),e.YNc(10,Ea,1,0,"tr",34),e.YNc(11,Ja,1,4,"tr",35),e.YNc(12,Qa,1,0,"tr",36),e.qZA(),e._UZ(13,"mat-paginator",37),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.dataSourceGroupes),e.xp6(9),e.Q6J("matHeaderRowDef",t.displayedColumnsRs),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumnsRs),e.xp6(1),e.Q6J("matRowDefColumns",e.DdM(6,Ga)),e.xp6(1),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(7,ja))}}function Ha(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.typePrime.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function Fa(i,s){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,Ha,9,7,"ng-container",58),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",101==t.typePrime.idParam)}}function $a(i,s){if(1&i&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()()()),2&i){const t=s.$implicit;e.xp6(2),e.Oqu(t.taxe.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function za(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"td",59),e._uU(2),e.qZA(),e.TgZ(3,"td",59),e._uU(4),e.ALo(5,"money"),e.ALo(6,"number"),e.TgZ(7,"sup"),e._uU(8,"DA"),e.qZA()(),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.typePrime.description),e.xp6(2),e.hij("",e.lcZ(5,2,e.xi3(6,4,t.primeProrata,"1.0-0"))," ")}}function Ka(i,s){if(1&i&&(e.TgZ(0,"tr"),e.YNc(1,za,9,7,"ng-container",58),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",186==t.typePrime.idParam)}}function Wa(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",60),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.approuverAvenant())}),e._uU(1,"Approuver"),e.qZA()}}const oe=function(i){return[i]};let ae=(()=>{class i{constructor(t,n,o,l,a,r,c){this.router=t,this.cd=n,this.dialog=o,this.contratService=l,this.avenantService=a,this.route=r,this.genericService=c,this.multiRisque=!1,this.dataSourceGroupes=new P.by,this.colonnesDynamiques=[],this.displayColonnes=["idRisque","idGroupe"],this.hisReady=!1,this.displayedColumnsRs=["description","more"],this.displayedColumnsRsInner=[],this.displayedColumnsCol=[]}ngOnInit(){this.hasRights=sessionStorage.getItem("roles")?.includes("BO"),this.getInfoProduit(),this.idContratAvenant=this.route.snapshot.paramMap.get("idContratAvenant"),this.codeProduit=this.route.snapshot.paramMap.get("codeProduit")}toggleRow(t){this.dataSourceGroupes.data.indexOf(t),this.idGroupe=t.idGroupe,t.risques&&t.risques.data.length&&(this.expandedElement=this.expandedElement===t?null:t),this.cd.detectChanges(),this.innerTables.forEach((n,o)=>n.dataSource.sort=this.innerSort.toArray()[o])}getInfoProduit(){let t=JSON.parse(sessionStorage.getItem("products")||"{}").find(n=>n.codeProduit==this.route.snapshot.paramMap.get("codeProduit")).idProduit;this.genericService.getPorduitById(t).subscribe({next:n=>{this.multiRisque="Oui"==n.param_Produit_Reponses.filter(o=>"multirisque"==o.idParamProduit.libelle)[0].reponse.description,this.getAvenantByContrat()},error:n=>{console.log(n)}})}getAvenantByContrat(){this.avenantService.getAttributsAvenant(this.idContratAvenant).subscribe({next:t=>{this.attributsAvenant=t,this.hisHistorique=t.idHisContrat,console.log("hisHistorique ==============> "),console.log(this.attributsAvenant),this.getHistoriqueContrat(this.hisHistorique)},error:t=>{console.log(t)}})}getHistoriqueContrat(t){this.contratService.getContratHistoriqueById(t).subscribe({next:n=>{this.hisReady=!0;const o=new Date<new Date(n.dateEffet);if(this.hasRights=this.hasRights||sessionStorage.getItem("roles")?.includes("DA")&&o&&["A04","A03","A01"].includes(this.attributsAvenant.typeAvenant.code),console.log("new Has RIGHT",this.hasRights),this.attributsAvenant.risqueList.map(a=>{n.groupesList.map(r=>{r.risques.map(c=>{c.idRisque==a.idRisque&&Object.assign(a,{idGroupe:r.idGroupe})})})}),n?.personnesList?.forEach(a=>{switch(a?.role?.code){case"CP233":this.informationsConducteur={nom:a.personne.nom,prenom:a.personne.prenom1,dateNaissance:a.personne.dateNaissance,categoriePermis:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.sousCategorie,dateDelivrance:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.dateDelivrance,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description};break;case"CP234":this.informationsSouscripteur={raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description};break;case"CP235":this.informationsAssure={typeClient:"raisonSocial"in a.personne?"personne morale":"personne physique",raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description};break;case"CP236":this.informationsAssure={typeClient:"raisonSocial"in a.personne?"personne morale":"personne physique",raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description},this.informationsSouscripteur={raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description};break;case"CP237":this.informationsSouscripteur={raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description},this.informationsConducteur={nom:a.personne.nom,prenom:a.personne.prenom1,dateNaissance:a.personne.dateNaissance,categoriePermis:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.sousCategorie,dateDelivrance:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.dateDelivrance,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description};break;case"CP238":this.informationsAssure={typeClient:"raisonSocial"in a.personne?"personne morale":"personne physique",raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description},this.informationsSouscripteur={raisonSocial:a.personne.raisonSocial,nom:a.personne.nom,prenom:a.personne.prenom1,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description},this.informationsConducteur={nom:a.personne.nom,prenom:a.personne.prenom1,dateNaissance:a.personne.dateNaissance,categoriePermis:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.sousCategorie,dateDelivrance:a.personne.documentList?.find(r=>5==r.typeDocument?.idParam)?.dateDelivrance,email:a.personne.contactList?.find(r=>8==r.typeContact?.idParam)?.description,tel:a.personne.contactList?.find(r=>7==r.typeContact?.idParam)?.description}}}),this.multiRisque){console.log(n);let a=[];const r=n.groupesList;r.forEach(c=>{c.risques.forEach(p=>{p.risque.forEach(m=>{m.colonne=m.colonne.split(" ").map(f=>f.charAt(0).toUpperCase()+f.substring(1)).join("").replace(/[\xb0']/g,""),this.displayedColumnsRsInner=this.displayedColumnsRsInner.includes(m.colonne)?this.displayedColumnsRsInner:[...this.displayedColumnsRsInner,m.colonne],this.displayedColumnsCol=this.displayedColumnsCol.includes(m.colonne)?this.displayedColumnsCol:[...this.displayedColumnsCol,m.colonne];const d=p.risque.find(f=>f.colonne===m.colonne);d&&(d[m.colonne]=m.valeur,delete d.colonne,delete d.valeur)})})}),this.displayedColumnsRsInner.push("action"),r.forEach(c=>{c.risques&&Array.isArray(c.risques)&&c.risques.length?(c.risques.idGroupe=c.idGroupe,a=[...a,{...c,risques:new P.by(c.risques)}]):a=[...a,c]}),this.dataSourceGroupes=new P.by(a),this.dataSourceGroupes.paginator=this.paginator,this.contratService.getQuittanceById(n?.idQuittance).subscribe({next:c=>{this.dataSourcePrime=c.primeList,this.dataSourceTaxe=c.taxeList,console.log("quitance1",this.dataSourcePrime)},error:c=>{console.log(c)}})}else this.consultRisque(this.attributsAvenant.risqueList[0].idGroupe,this.attributsAvenant.risqueList[0].idRisque),this.contratService.getQuittanceById(n?.idQuittance).subscribe({next:a=>{this.dataSourcePrime=a.primeList,this.dataSourceTaxe=a.taxeList,console.log("quitance1",this.dataSourcePrime)},error:a=>{console.log(a)}})},error:n=>{console.log(n)}})}consultRisque(t,n){this.contratService.getParamContratByIdRisqueHisto(this.hisHistorique,n,t).subscribe({next:o=>{this.multiRisque||(this.informationsRisque=o.reduce((l,a)=>("P40"==a?.codeParam&&(this.valeurVenale=a.valeur),(l[a.categorieParamRisque]=l[a.categorieParamRisque]||[]).push(a),l),{}),this.informationsRisque=Object.values(this.informationsRisque)),this.multiRisque&&this.contratService.getPackIdRisqueHistorique(this.hisHistorique,t).subscribe({next:l=>{this.openDialog(o,l)},error:l=>{console.log(l)}})},error:o=>{console.log(o)}})}openDialog(t,n){this.dialog.open(na.T,{width:"60%",data:{paramRisque:t,pack:n}}).afterClosed().subscribe(l=>{})}approuverAvenant(){this.dialog.open(la,{width:"40%",data:{idContratAvenant:this.idContratAvenant}}).afterClosed().subscribe(n=>{this.router.navigate(["/consultation-avenants/vie/"+this.codeProduit+"/"+this.attributsAvenant?.idContrat])})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(S.F0),e.Y36(e.sBO),e.Y36(k.uw),e.Y36(U.H),e.Y36(O.n),e.Y36(S.gz),e.Y36(W.M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-consultation-avenant-vie"]],viewQuery:function(t,n){if(1&t&&(e.Gf(w.NW,5),e.Gf(ca,5),e.Gf(ma,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.paginator=o.first),e.iGM(o=e.CRH())&&(n.innerTables=o),e.iGM(o=e.CRH())&&(n.innerSort=o)}},decls:55,vars:24,consts:[[1,"container"],[1,"header-title"],["aria-hidden","false","matTooltip","Retour","matTooltipPosition","left",1,"material-symbols-outlined",3,"routerLink"],["multi","",1,"example-headers-align"],["hideToggle","",3,"expanded"],[1,"container",2,"padding","1rem 2rem"],[1,"row","infos"],[1,"col-md-6"],[1,"row"],[1,"col-md-6","key"],[1,"col-md-6","value"],["class","row infos",4,"ngFor","ngForOf"],["hideToggle","",3,"expanded",4,"ngIf"],["multi","",4,"ngIf","ngIfElse"],["multirisque",""],[1,"resume"],[4,"ngFor","ngForOf"],[1,"row-button"],[1,"btn","btn-cancel",3,"routerLink"],["class","btn btn-action",3,"click",4,"ngIf"],["class","col-md-6 value",4,"ngIf"],["class","row infos",4,"ngIf","ngIfElse"],["personneMoral",""],["multi",""],["hideToggle","","class","panel-risque",3,"expanded",4,"ngFor","ngForOf"],["hideToggle","",1,"panel-risque",3,"expanded"],[1,"categoryTitle"],["class","row infos ",4,"ngFor","ngForOf"],["mat-table","","multiTemplateDataRows","",1,"gestion-table",3,"dataSource"],["matColumnDef","description"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","more"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"example-element-row","example-expanded-row",4,"matRowDef","matRowDefColumns"],["mat-row","","class","example-detail-row",4,"matRowDef","matRowDefColumns"],["aria-label","Select page of users",3,"pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","type","button","aria-label","",3,"click"],["class","example-element-detail",4,"ngIf"],[1,"example-element-detail"],["class","inner-table mat-elevation-z8",4,"ngIf"],[1,"inner-table","mat-elevation-z8"],["mat-table","","matSort","",1,"",3,"dataSource"],["innerTables",""],[3,"matColumnDef",4,"ngFor","ngForOf"],["matColumnDef","action"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"matColumnDef"],["mat-icon-button","","type","button","aria-label","menu contrat list",3,"matMenuTriggerFor"],["xPosition","after",1,"menu-contrat"],["menu","matMenu"],["mat-menu-item","","type","button",3,"click"],["mat-header-row",""],["mat-row",""],["mat-row","",1,"example-detail-row"],[4,"ngIf"],[1,"primeTotale"],[1,"btn","btn-action",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"h2",1)(2,"mat-icon",2),e._uU(3,"arrow_circle_left"),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"mat-accordion",3)(6,"mat-expansion-panel",4)(7,"mat-expansion-panel-header")(8,"mat-panel-title"),e._uU(9," Information avenant "),e.qZA()(),e.TgZ(10,"div",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9),e._uU(15,"Motif: "),e.qZA(),e.TgZ(16,"div",10),e._uU(17),e.qZA()()()(),e.TgZ(18,"div",6)(19,"div",7)(20,"div",8)(21,"div",9),e._uU(22,"Commentaire: "),e.qZA(),e.TgZ(23,"div",10),e._uU(24),e.qZA()()(),e.TgZ(25,"div",7)(26,"div",8)(27,"div",9),e._uU(28,"Date avenant: "),e.qZA(),e.TgZ(29,"div",10),e._uU(30),e.ALo(31,"dateFormatPipe"),e.qZA()()()(),e.YNc(32,_a,7,3,"div",11),e.qZA()(),e.YNc(33,ga,28,6,"mat-expansion-panel",12),e.YNc(34,ha,31,5,"mat-expansion-panel",12),e.TgZ(35,"mat-expansion-panel",4)(36,"mat-expansion-panel-header")(37,"mat-panel-title"),e._uU(38," Informations du risque "),e.qZA()(),e.TgZ(39,"div",5),e.YNc(40,Sa,2,1,"mat-accordion",13),e.YNc(41,Ba,14,8,"ng-template",null,14,e.W1O),e.qZA()(),e.TgZ(43,"mat-expansion-panel",4)(44,"mat-expansion-panel-header")(45,"mat-panel-title"),e._uU(46," Prime "),e.qZA()(),e.TgZ(47,"table",15),e.YNc(48,Fa,2,1,"tr",16),e.YNc(49,$a,9,7,"tr",16),e.YNc(50,Ka,2,1,"tr",16),e.qZA()(),e.TgZ(51,"div",17)(52,"button",18),e._uU(53,"Retour"),e.qZA(),e.YNc(54,Wa,2,0,"button",19),e.qZA()()()),2&t){const o=e.MAs(42);e.xp6(2),e.Q6J("routerLink",e.VKq(20,oe,"/consultation-avenants/vie/"+n.codeProduit+"/"+(null==n.attributsAvenant?null:n.attributsAvenant.idContrat))),e.xp6(2),e.hij(" Consultation ",null==n.attributsAvenant?null:n.attributsAvenant.typeAvenant.libelle," "),e.xp6(2),e.Q6J("expanded",!0),e.xp6(11),e.hij("",null==n.attributsAvenant||null==n.attributsAvenant.motif||null==n.attributsAvenant.motif.motif?null:n.attributsAvenant.motif.motif.description," "),e.xp6(7),e.hij("",null==n.attributsAvenant?null:n.attributsAvenant.motif.Commentaire," "),e.xp6(6),e.hij("",e.lcZ(31,18,null==n.attributsAvenant?null:n.attributsAvenant.dateAvenant)," "),e.xp6(2),e.Q6J("ngForOf",null==n.attributsAvenant?null:n.attributsAvenant.attributList),e.xp6(1),e.Q6J("ngIf",(null==n.attributsAvenant||null==n.attributsAvenant.typeAvenant?null:n.attributsAvenant.typeAvenant.assuree)&&n.hisReady),e.xp6(1),e.Q6J("ngIf",(null==n.attributsAvenant||null==n.attributsAvenant.typeAvenant?null:n.attributsAvenant.typeAvenant.souscripteur)&&n.hisReady),e.xp6(1),e.Q6J("expanded",!0),e.xp6(5),e.Q6J("ngIf",!n.multiRisque)("ngIfElse",o),e.xp6(3),e.Q6J("expanded",!0),e.xp6(5),e.Q6J("ngForOf",n.dataSourcePrime),e.xp6(1),e.Q6J("ngForOf",n.dataSourceTaxe),e.xp6(1),e.Q6J("ngForOf",n.dataSourcePrime),e.xp6(2),e.Q6J("routerLink",e.VKq(22,oe,"/consultation-avenants/vie/"+n.codeProduit+"/"+(null==n.attributsAvenant?null:n.attributsAvenant.idContrat))),e.xp6(2),e.Q6J("ngIf","S09"==(null==n.attributsAvenant?null:n.attributsAvenant.statut.code)&&n.hasRights)}},dependencies:[y.sg,y.O5,J.Hw,I.pp,I.ib,I.yz,I.yK,L.VK,L.OP,L.p6,P.BZ,P.fO,P.as,P.w1,P.Dz,P.nj,P.ge,P.ev,P.XQ,P.Gk,Q.gM,w.NW,B.lW,S.rH,y.JJ,ua.y,ie.X],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;padding:40px 0;height:100%;overflow-y:auto;overflow-x:hidden}.gestion-table[_ngcontent-%COMP%]{width:100%}.gestion-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .gestion-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:16px}.gestion-table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{color:#00008f;font-weight:600}.gestion-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]:nth-child(even), .gestion-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]{background-color:#f7f7f9}.gestion-table[_ngcontent-%COMP%]   .mat-paginator[_ngcontent-%COMP%]{background-color:transparent;margin:20px auto auto;width:80%}.gestion-table[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:100%;font-size:26px;color:#00008f;width:-moz-fit-content;width:fit-content}.mat-menu-item[_ngcontent-%COMP%]{font-size:15px}.mat-menu-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:18px;height:-moz-fit-content;height:fit-content}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]), .mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled])   .mat-icon[_ngcontent-%COMP%]{color:#00008f}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0px 2rem}.header[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;font-size:29px;margin-right:1rem;width:-moz-fit-content;width:fit-content}.title-table[_ngcontent-%COMP%]{margin-bottom:0rem;font-weight:800!important;font-size:23px!important;color:#00008f!important}.container[_ngcontent-%COMP%]{background-color:#fff;padding:40px 0;height:100%;overflow-x:hidden;box-shadow:0 .5rem 1rem #00000026}.mat-expansion-panel-header[_ngcontent-%COMP%]{background:rgba(199,199,199,.2)!important;font-weight:600;font-size:16px}.mat-expansion-panel-header.mat-expanded[_ngcontent-%COMP%]{height:48px}.mat-expansion-panel-header-title[_ngcontent-%COMP%]{color:#00008f}.mat-expansion-panel[_ngcontent-%COMP%]:not([class*=mat-elevation-z]){box-shadow:none}.row.infos[_ngcontent-%COMP%]{font-size:16px;margin-bottom:2rem;font-weight:600}.panel-risque[_ngcontent-%COMP%]   .row.infos[_ngcontent-%COMP%]{margin-left:10px;margin-top:10px}.panel-risque[_ngcontent-%COMP%]{width:70%}.categoryTitle[_ngcontent-%COMP%]{text-transform:capitalize}.value[_ngcontent-%COMP%]{color:#00008f;font-weight:600}h2.header-title[_ngcontent-%COMP%]{padding:0 24px;font-size:21px!important;color:#00008f;font-weight:600!important;letter-spacing:1px;display:flex;justify-content:space-between}table.resume[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border-spacing:0 19px}table.resume[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:17px;padding:12px 19px;border:1px solid rgba(0,0,0,.12)}.mat-column-expandedDetail[_ngcontent-%COMP%]{padding-left:0!important;padding-right:0!important}.example-element-detail[_ngcontent-%COMP%]{overflow:hidden;display:flex}tr.example-detail-row[_ngcontent-%COMP%]{height:0}.mat-column-expandedDetail[_ngcontent-%COMP%]{padding:0}.mat-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]:hover, .mat-header-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]:hover{color:#d14723;cursor:pointer}.mat-cell[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#00008f}.innertable[_ngcontent-%COMP%]{background-color:#f7f7f9}.cdk-column-expandedDetail[_ngcontent-%COMP%]{border-bottom-width:0px}.mat-menu-item[_ngcontent-%COMP%]{font-size:16px}.mat-icon[_ngcontent-%COMP%]{margin-right:16px;font-size:21px;height:-moz-fit-content;height:fit-content}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]){color:#00008f}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled])   .mat-icon[_ngcontent-%COMP%]{color:#00008f}.inner-table[_ngcontent-%COMP%], .inner-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}table.pack-table[_ngcontent-%COMP%]{width:100%;margin-top:1rem}.mat-header-row[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{color:#00008f}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:16px;font-weight:600;border-right:1px solid #e7e7e7;padding-left:1rem}.mat-header-cell[_ngcontent-%COMP%]{color:#333;font-weight:600;letter-spacing:.5px;font-size:15px}.row-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:0 3rem;margin-top:2rem}"],data:{animation:[(0,b.X$)("detailExpand",[(0,b.SB)("collapsed",(0,b.oB)({height:"0px",minHeight:"0",display:"none"})),(0,b.SB)("expanded",(0,b.oB)({height:"*"})),(0,b.eR)("expanded <=> collapsed",(0,b.jt)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),i})();var Xa=A(6308),re=A(6838);function er(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",11),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.hij(" ",t.description," ")}}function tr(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-option",11),e._uU(2),e.qZA(),e.BQk()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("value",t),e.xp6(1),e.hij(" ",t.description," ")}}function ir(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",4)(1,"mat-label"),e._uU(2,"Risque"),e.qZA(),e.TgZ(3,"mat-select",12)(4,"mat-select-filter",13),e.NdJ("filteredReturn",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.filteredcausesRisques=o)}),e.qZA(),e.YNc(5,tr,3,2,"ng-container",6),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("multiple","A11"!=t.typeAvenant.code&&"A23"!=t.typeAvenant.code&&"A25"!=t.typeAvenant.code&&"A24"!=t.typeAvenant.code),e.xp6(1),e.Q6J("displayMember","description")("array",t.risques),e.xp6(1),e.Q6J("ngForOf",t.filteredcausesRisques)}}let nr=(()=>{class i{constructor(t,n,o,l,a,r,c,p){this.formBuilder=t,this.dataTransferService=n,this.contratService=o,this.route=l,this.data=a,this.dialogRef=r,this.avenantService=c,this.router=p,this.types_avenant=[],this.getTypeAvenant={idProduit:"",idAvenantPrecedent:""},this.today=new Date,this.dateExpirationContrat=new Date(this.data.dateExpiration),this.multiRisque=!1,this.risquesArray=[]}ngOnInit(){this.formTypeAvenant=this.formBuilder.group({typeAvenant:["",[u.kI.required]],risque:["",[]]}),this.types_avenant=this.data.types_avenant}getInfoAvenant(){this.dataTransferService.emptyDataArray(),this.avenantService.getAvenantById(this.typeAvenant.idTypeAvenant).subscribe({next:t=>{this.multiRisque=t.multirisque,this.multiRisque?this.formTypeAvenant.get("risque")?.setValidators([u.kI.required]):this.formTypeAvenant.get("risque")?.setValidators([]),this.multiRisque&&this.contratService.getRisquesByContrat(this.data.idContrat,this.data.codeProduit).subscribe({next:n=>{this.risques=n,this.filteredcausesRisques=this.risques.slice(),"A03"==this.typeAvenant.code||"A04"==this.typeAvenant.code||"A23"==this.typeAvenant.code||"A24"==this.typeAvenant.code||"A25"==this.typeAvenant.code?(this.formTypeAvenant.get("risque")?.setValue(n),this.formTypeAvenant.get("risque")?.disable()):(this.formTypeAvenant.get("risque")?.setValue(""),this.formTypeAvenant.get("risque")?.enable())},error:n=>{console.log(n)}})},error:t=>{console.log(t)}})}submitAvenant(){this.formTypeAvenant.valid&&(this.dataTransferService.setDataRisquesArray(this.formTypeAvenant.get("risque")?.value),this.dialogRef.close(),this.router.navigate(["application-avenant/vie/"+this.data.codeProduit+"/"+this.typeAvenant.idTypeAvenant+"/"+this.data.idContrat]))}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(u.qu),e.Y36(G.b),e.Y36(U.H),e.Y36(S.gz),e.Y36(k.WI),e.Y36(k.so),e.Y36(O.n),e.Y36(S.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-soumettre-avenant-vie"]],decls:17,vars:4,consts:[[1,"heading"],[1,"mat-typography"],[1,"login-form","row",3,"formGroup","ngSubmit"],["formDirective","ngForm"],["appearance","outline",1,"col-md-6"],["formControlName","typeAvenant",3,"ngModel","ngModelChange","selectionChange"],[4,"ngFor","ngForOf"],["appearance","outline","class","col-md-6",4,"ngIf"],[1,"row-button"],["mat-dialog-close","",1,"btn","btn-cancel"],["type","submit",1,"btn","btn-action"],[3,"value"],["formControlName","risque",3,"multiple"],[3,"displayMember","array","filteredReturn"]],template:function(t,n){1&t&&(e.TgZ(0,"h2",0),e._uU(1,"Selectionnez le type d'avenant"),e.qZA(),e._UZ(2,"mat-divider"),e.TgZ(3,"mat-dialog-content",1)(4,"form",2,3),e.NdJ("ngSubmit",function(){return n.submitAvenant()}),e.TgZ(6,"mat-form-field",4)(7,"mat-label"),e._uU(8,"Type d'Avenant"),e.qZA(),e.TgZ(9,"mat-select",5),e.NdJ("ngModelChange",function(l){return n.typeAvenant=l})("selectionChange",function(){return n.getInfoAvenant()}),e.YNc(10,er,3,2,"ng-container",6),e.qZA()(),e.YNc(11,ir,6,4,"mat-form-field",7),e.TgZ(12,"div",8)(13,"button",9),e._uU(14,"Annuler"),e.qZA(),e.TgZ(15,"button",10),e._uU(16,"Soumettre"),e.qZA()()()()),2&t&&(e.xp6(4),e.Q6J("formGroup",n.formTypeAvenant),e.xp6(5),e.Q6J("ngModel",n.typeAvenant),e.xp6(1),e.Q6J("ngForOf",n.types_avenant),e.xp6(1),e.Q6J("ngIf",n.multiRisque))},dependencies:[y.sg,y.O5,E.d,u._Y,u.JJ,u.JL,u.sg,u.u,N.KE,N.hX,k.ZT,k.xY,ee.gD,D.ey,re.Fq],styles:["button.btn.btn-action[_ngcontent-%COMP%]{float:right}h2.heading[_ngcontent-%COMP%]{color:#00008f;font-weight:700!important;letter-spacing:.5px}.mat-dialog-content[_ngcontent-%COMP%]{padding-top:15px}.mat-radio-button[_ngcontent-%COMP%]{margin:0 12px}.row-button[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:2rem}"]}),i})();var se=A(7331);function or(i,s){1&i&&(e.TgZ(0,"th",17),e._uU(1," ID "),e.qZA())}function ar(i,s){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.idContratAvenant," ")}}function rr(i,s){1&i&&(e.TgZ(0,"th",17),e._uU(1," Type avenant "),e.qZA())}function sr(i,s){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",t.typeAvenant," ")}}function lr(i,s){1&i&&(e.TgZ(0,"th",17),e._uU(1," Date et heure "),e.qZA())}function ur(i,s){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,t.date,"dd-MM-yyyy HH:mm:ss")," ")}}function cr(i,s){1&i&&(e.TgZ(0,"th",17),e._uU(1," Statut "),e.qZA())}function mr(i,s){if(1&i&&(e.TgZ(0,"td",18)(1,"mat-chip-list",19)(2,"mat-chip",20),e._uU(3),e.qZA()()()),2&i){const t=s.$implicit;e.xp6(3),e.hij(" ",t.statut.description," ")}}function pr(i,s){1&i&&(e.TgZ(0,"th",17),e._uU(1," Action "),e.qZA())}function dr(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"td",18)(1,"button",21)(2,"mat-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",22,23)(6,"button",24),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.consulterAvenant(null==l?null:l.idContratAvenant))}),e.TgZ(7,"mat-icon"),e._uU(8,"zoom_in"),e.qZA(),e.TgZ(9,"span"),e._uU(10,"Consulter avenant"),e.qZA()(),e.TgZ(11,"button",24),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.consultContratAvenant(null==l?null:l.idContratAvenant))}),e.TgZ(12,"mat-icon"),e._uU(13,"zoom_in"),e.qZA(),e.TgZ(14,"span"),e._uU(15,"Consulter image contrat"),e.qZA()(),e.TgZ(16,"button",24),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.consultQuittance(null==l?null:l.idQuittance))}),e.TgZ(17,"mat-icon"),e._uU(18,"zoom_in"),e.qZA(),e.TgZ(19,"span"),e._uU(20,"Consulter quittance"),e.qZA()(),e.TgZ(21,"button",24),e.NdJ("click",function(){const o=e.CHM(t),l=o.$implicit,a=o.index,r=e.oxw();return e.KtG(r.outputAvenant(l,a))}),e.TgZ(22,"mat-icon"),e._uU(23,"print"),e.qZA(),e.TgZ(24,"span"),e._uU(25,"Imprimer"),e.qZA()()()()}if(2&i){const t=s.$implicit,n=e.MAs(5);e.xp6(1),e.Q6J("matMenuTriggerFor",n),e.xp6(5),e.Q6J("disabled","Affaire nouvelle"==(null==t?null:t.typeAvenant)),e.xp6(5),e.Q6J("disabled","S05"==t.statut.code),e.xp6(5),e.Q6J("disabled",!t.quittance||"S05"==t.statut.code),e.xp6(5),e.Q6J("disabled",!t.quittance&&!t.cp&&!t.attestation||"S05"==t.statut.code||"S09"==t.statut.code)}}function _r(i,s){1&i&&e._UZ(0,"tr",25)}function fr(i,s){1&i&&e._UZ(0,"tr",26)}const vr=function(i){return[i]},gr=function(){return[5,10]};let hr=(()=>{class i{constructor(t,n,o,l,a,r,c){this.route=t,this.packService=n,this.devisService=o,this.dialog=l,this.avenantService=a,this.contratService=r,this.router=c,this.displayedColumns=["id","typeAvenant","dateAvenant","statut","action"]}ngOnInit(){this.idContrat=this.route.snapshot.paramMap.get("idContrat"),this.getContratById(),this.getAvenantByContrat()}getContratById(){this.contratService.getContratById(this.idContrat).subscribe({next:t=>{this.contrat=t},error:t=>{console.log(t)}})}getAvenantByContrat(){this.avenantService.getAvenantByContrat(this.idContrat).subscribe({next:t=>{this.dataSource=new P.by(t)},error:t=>{console.log(t)}})}consulterAvenant(t){this.router.navigate(["consultation-avenant/vie/"+this.route.snapshot.paramMap.get("codeProduit")+"/"+t])}consultContratAvenant(t){this.router.navigate(["consultation-contrat-avenant/vie/"+this.route.snapshot.paramMap.get("codeProduit")+"/"+t])}consultQuittance(t){this.router.navigate(["consultation-quittance/vie/"+this.route.snapshot.paramMap.get("codeProduit")+"/"+t])}outputAvenant(t,n){var o=this;let l;l=this.route.snapshot.paramMap.get("codeProduit"),this.avenantService.getAttributsAvenant(t.idContratAvenant).subscribe({next:p=>{this.contratService.getContratHistoriqueById(t.hisContrat).subscribe({next:m=>{var d;console.log("hisContrat 10",m),this.contratService.getParamContratByIdRisqueHisto(m.idHistorique,m.groupesList?.[0]?.idGroupe,m?.groupesList?.[0]?.risques?.[0]?.idRisque).subscribe({next:(d=(0,T.Z)(function*(f){m.risqueList=Object.values(f);let v=[];for(const _ of m?.groupesList?.[0]?.risques||[])try{(yield o.contratService.getPackIdRisqueHistorique(m?.idHistorique,_.idRisque).toPromise())?.primeList?.forEach(h=>{"CP101"===h?.typePrime?.code&&v.push({prime:h?.primeProrata,id:_?.idRisque})})}catch(g){console.log(g)}var _;o.contratService.getPaysList().subscribe({next:(_=(0,T.Z)(function*(g){console.log("payy",m),m.isShengen=g.find(h=>h.idPays==m?.risqueList?.find(q=>"P182"===q?.codeRisque)?.reponse?.valeur)?.isShengen}),function(h){return _.apply(this,arguments)}),error:_=>{console.log(_)}}),m.primeListRisques=v,yield o.contratService.getPackIdRisqueHistorique(m.idHistorique,m.groupesList[0].risques[0].idRisque).subscribe({next:function(){var _=(0,T.Z)(function*(g){m.paramContratList=g.garantieList,m.pack=g.pack,o.contratService.getQuittanceById(t.idQuittance).subscribe({next:h=>{0==n?o.outputAffaireNouvelle():t.cp&&o.avenantService.outputAvenant(m,p,h,n),t.quittance&&o.contratService.outputQuittance(m,h,p),t.attestation&&o.contratService.outputAttestation(m,h,p)},error:h=>{console.log(h)}})});return function(h){return _.apply(this,arguments)}}(),error:_=>{console.log(_)}})}),function(v){return d.apply(this,arguments)}),error:d=>{console.log(d)}})},error:m=>{console.log(m)}})},error:p=>{console.log(p)}})}outputAffaireNouvelle(){var n,t=this;this.contratService.getParamContratByIdRisque(this.contrat.idContrat,this?.contrat?.groupeList?.[0]?.idGroupe,this.contrat?.groupeList?.[0]?.risques?.[0]?.idRisque).subscribe({next:(n=(0,T.Z)(function*(o){t.contrat.risqueList=yield Object.values(o);let l=[],a={};for(const r of t.contrat?.groupeList?.[0]?.risques||[])try{const c=yield t.contratService.getPackIdRisque(t.contrat.idContrat,r.idRisque).toPromise();c?.primeList?.forEach(p=>{"CP101"===p?.typePrime?.code&&l.push({prime:p?.prime,id:r?.idRisque})}),c.garantieList.forEach(p=>{"G44"!==p?.codeGarantie&&(a[p?.description]=p?.categorieList?.[0]?.valeur)})}catch(c){console.log(c)}var r;t.contratService.getPaysList().subscribe({next:(r=(0,T.Z)(function*(c){console.log("pays",c.find(p=>p.idPays==t.contrat?.risqueList?.find(m=>"P182"===m?.codeRisque)?.reponse?.valeur)),t.contrat.isShengen=c.find(p=>p.idPays==t.contrat?.risqueList?.find(m=>"P182"===m?.codeRisque)?.reponse?.valeur)?.isShengen}),function(p){return r.apply(this,arguments)}),error:r=>{console.log(r)}}),t.contrat.primeListRisques=l,t.contrat.garantiePlafond=a,yield t.contratService.getPackIdRisque(t.contrat.idContrat,t.contrat?.groupeList?.[0]?.risques?.[0]?.idRisque).subscribe({next:function(){var r=(0,T.Z)(function*(c){t.contrat.paramContratList=c.garantieList,t.contrat.pack=c.pack;const p=t.contrat?.groupeList.map(m=>t.packService.getPackById(m.pack.idPack0));(0,$.D)(p).subscribe(function(){var m=(0,T.Z)(function*(d){const v=[{title:"D\xe9c\xe8s accidentel (*)",garantieIndex:0},{title:"Incapacit\xe9 Permanente Totale / Partielle (*)",garantieIndex:1},{title:"Frais d\u2019hospitalisation, m\xe9dicaux et pharmaceutiques",garantieIndex:2},{title:"Bris de lunettes en cas d\u2019accident",garantieIndex:3},{title:"Proth\xe8se dentaire en cas d\u2019accident",garantieIndex:4},{title:"Assistance",garantieIndex:4}].map(({title:_,garantieIndex:g})=>t.devisService.gavRows(d,g,_));t.contrat.gavGarantieTable=v,console.log("contract: ",t.contrat),yield t.contratService.outputContrat(t.contrat)});return function(d){return m.apply(this,arguments)}}())});return function(p){return r.apply(this,arguments)}}(),error:r=>{console.log(r)}})}),function(l){return n.apply(this,arguments)}),error:n=>{console.log(n)}})}openDialogAdd(){this.avenantService.getTypeAvenantbyAvenantPrecedent({idProduit:this.dataSource.data[0].idProduit,idAvenantPrecedent:this.dataSource.data[this.dataSource.data.length-1].idTypeAvenant,statut:this.dataSource.data[this.dataSource.data.length-1].statut.idParam}).subscribe({next:n=>{this.dialog.open(nr,{width:"40%",data:{types_avenant:n,idContrat:this.idContrat,dateExpiration:this.contrat.dateExpiration,codeProduit:this.route.snapshot.paramMap.get("codeProduit")}}).afterClosed().subscribe(l=>{this.getAvenantByContrat()})},error:n=>{console.log(n)}})}paginate(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(S.gz),e.Y36(z.F),e.Y36(K.J),e.Y36(k.uw),e.Y36(O.n),e.Y36(U.H),e.Y36(S.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-gestion-avenant-vie"]],viewQuery:function(t,n){if(1&t&&(e.Gf(w.NW,5),e.Gf(Xa.YE,5)),2&t){let o;e.iGM(o=e.CRH())&&(n.paginator=o.first),e.iGM(o=e.CRH())&&(n.sort=o.first)}},decls:30,vars:13,consts:[[1,"container"],[1,"header"],["aria-hidden","false","matTooltip","Retour","matTooltipPosition","left",1,"material-symbols-outlined",3,"routerLink"],[1,"title-table"],[2,"display","flex","align-items","center",3,"disabled","click"],["aria-hidden","false","aria-label","ajouter une risque ",1,"material-symbols-outlined"],["mat-table","",1,"gestion-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","typeAvenant"],["matColumnDef","dateAvenant"],["matColumnDef","statut"],["matColumnDef","action"],["mat-header-row","","class","example-second-header-row",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select\n      page of users",3,"pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["aria-label","Fish selection"],["color","primary"],["mat-icon-button","","type","button","aria-label","menu contrat list",3,"matMenuTriggerFor"],["xPosition","after",1,"menu-contrat"],["menu","matMenu"],["mat-menu-item","","type","button",3,"disabled","click"],["mat-header-row","",1,"example-second-header-row"],["mat-row",""]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"mat-icon",2),e._uU(3,"arrow_circle_left"),e.qZA(),e.TgZ(4,"h2",3),e._uU(5),e.qZA(),e.TgZ(6,"button",4),e.NdJ("click",function(){return n.openDialogAdd()}),e.TgZ(7,"mat-icon",5),e._uU(8,"add_circle"),e.qZA(),e._uU(9," Soumettre un avenant "),e.qZA()(),e._UZ(10,"mat-divider"),e.TgZ(11,"table",6),e.ynx(12,7),e.YNc(13,or,2,0,"th",8),e.YNc(14,ar,2,1,"td",9),e.BQk(),e.ynx(15,10),e.YNc(16,rr,2,0,"th",8),e.YNc(17,sr,2,1,"td",9),e.BQk(),e.ynx(18,11),e.YNc(19,lr,2,0,"th",8),e.YNc(20,ur,3,4,"td",9),e.BQk(),e.ynx(21,12),e.YNc(22,cr,2,0,"th",8),e.YNc(23,mr,4,1,"td",9),e.BQk(),e.ynx(24,13),e.YNc(25,pr,2,0,"th",8),e.YNc(26,dr,26,5,"td",9),e.BQk(),e.YNc(27,_r,1,0,"tr",14),e.YNc(28,fr,1,0,"tr",15),e.qZA(),e._UZ(29,"mat-paginator",16),e.qZA()),2&t&&(e.xp6(2),e.Q6J("routerLink",e.VKq(10,vr,"/consultation-police/vie/"+(null==n.contrat||null==n.contrat.produit?null:n.contrat.produit.codeProduit)+"/"+(null==n.contrat||null==n.contrat.produit?null:n.contrat.produit.description))),e.xp6(3),e.hij("Liste des avenant li\xe9 au contrat N\xb0 ",n.idContrat,""),e.xp6(1),e.Tol("S01"==(null==n.contrat||null==n.contrat.statue?null:n.contrat.statue.code)||"S09"==(null==n.contrat||null==n.contrat.statue?null:n.contrat.statue.code)?"btn btn-disable":"btn btn-secondary"),e.Q6J("disabled","S01"==(null==n.contrat||null==n.contrat.statue?null:n.contrat.statue.code)||"S09"==(null==n.contrat||null==n.contrat.statue?null:n.contrat.statue.code)),e.xp6(5),e.Q6J("dataSource",n.dataSource),e.xp6(16),e.Q6J("matHeaderRowDef",n.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",n.displayedColumns),e.xp6(1),e.Q6J("pageSize",10)("pageSizeOptions",e.DdM(12,gr)))},dependencies:[E.d,J.Hw,L.VK,L.OP,L.p6,P.BZ,P.fO,P.as,P.w1,P.Dz,P.nj,P.ge,P.ev,P.XQ,P.Gk,Q.gM,w.NW,B.lW,se.qn,se.HS,S.rH,y.uU],styles:[".container[_ngcontent-%COMP%]{background-color:#fff;padding:40px 0;height:100%;overflow-y:auto;overflow-x:hidden}.gestion-table[_ngcontent-%COMP%]{width:100%}.gestion-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .gestion-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:16px}.gestion-table[_ngcontent-%COMP%]   .mat-header-cell[_ngcontent-%COMP%]{color:#00008f;font-weight:600}.gestion-table[_ngcontent-%COMP%]   .mat-row[_ngcontent-%COMP%]:nth-child(even), .gestion-table[_ngcontent-%COMP%]   .mat-header-row[_ngcontent-%COMP%]{background-color:#f7f7f9}.gestion-table[_ngcontent-%COMP%]   .mat-paginator[_ngcontent-%COMP%]{background-color:transparent;margin:20px auto auto;width:80%}.gestion-table[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:100%;font-size:26px;color:#00008f;width:-moz-fit-content;width:fit-content}.mat-menu-item[_ngcontent-%COMP%]{font-size:15px}.mat-menu-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:18px;height:-moz-fit-content;height:fit-content}.mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]), .mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled])   .mat-icon[_ngcontent-%COMP%]{color:#00008f}.header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0px 2rem}.header[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;font-size:29px;margin-right:1rem;width:-moz-fit-content;width:fit-content}.title-table[_ngcontent-%COMP%]{margin-bottom:0rem;font-weight:800!important;font-size:23px!important;color:#00008f!important}"]}),i})();var Cr=A(3412);const Ar=[{path:"consultation-avenants/vie/:codeProduit/:idContrat",component:hr,canActivate:[V.k],data:{roles:["CDC_BEA","COURTIER","ADMIN","ROLE_SUPER_ADMIN","ANALYSTE","METIER","BACKOFFICE","GESTION_SINISTRE","DA","BO","GESTIONNAIRE_JUNIOR","GESTIONNAIRE_SINISTRE","CHEF_PROJET","RESPONSABLE_SINISTRE","DIRECTEUR","CDC","CONSULTATION"]}},{path:"application-avenant/vie/:codeProduit/:idTypeAvenant/:idContrat",component:ta,canActivate:[V.k],data:{roles:["CDC_BEA","COURTIER","ADMIN","ROLE_SUPER_ADMIN","ANALYSTE","METIER","BACKOFFICE","DA","BO","GESTIONNAIRE_SINISTRE","CDC"]}},{path:"consultation-avenant/vie/:codeProduit/:idContratAvenant",component:ae,canActivate:[V.k],data:{roles:["CDC_BEA","COURTIER","ADMIN","ROLE_SUPER_ADMIN","ANALYSTE","METIER","BACKOFFICE","DA","BO","GESTIONNAIRE_JUNIOR","GESTIONNAIRE_SINISTRE","CHEF_PROJET","RESPONSABLE_SINISTRE","DIRECTEUR","CDC"]}},{path:"consultation-contrat-avenant/vie/:codeProduit/:idContratAvenant",component:ae,canActivate:[V.k],data:{roles:["CDC_BEA","COURTIER","ADMIN","ROLE_SUPER_ADMIN","ANALYSTE","METIER","BACKOFFICE","GESTION_SINISTRE","DA","BO","GESTIONNAIRE_JUNIOR","GESTIONNAIRE_SINISTRE","CHEF_PROJET","RESPONSABLE_SINISTRE","DIRECTEUR","CDC","CONSULTATION"]}},{path:"consultation-quittance/vie/:codeProduit/:idQuittance",component:Cr.D,canActivate:[V.k],data:{roles:["CDC_BEA","COURTIER","ROLE_SUPER_ADMIN","ANALYSTE","METIER","BACKOFFICE","DA","BO","GESTIONNAIRE_JUNIOR","GESTIONNAIRE_SINISTRE","CHEF_PROJET","RESPONSABLE_SINISTRE","DIRECTEUR","CDC","CONSULTATION"]}}];let Pr=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[S.Bz.forChild(Ar),S.Bz]}),i})();var qr=A(4466),xr=A(4092),br=A(294);const le={parse:{dateInput:"DD/MM/YYYY"},display:{dateInput:"DD/MM/YYYY",monthYearLabel:"MMMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let Rr=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:D._A,useClass:ue.t},{provide:D.sG,useValue:le},G.b],imports:[y.ez,qr.m,xr.q,br.I,Pr,re.FF]}),i})()}}]);