
<div class="container">
    <h2 class="header-title">
        <mat-icon aria-hidden="false"
            class="material-symbols-outlined"
            matTooltip="Retour"
            matTooltipPosition="left"
            [routerLink]="['/consultation-avenants/vie/' + codeProduit +'/' +attributsAvenant?.idContrat]">arrow_circle_left</mat-icon>
        Consultation {{attributsAvenant?.typeAvenant.libelle}}
        <!-- {{informationsContrat.idContrat}} -->
    </h2>
    <mat-accordion class="example-headers-align" multi>
        <!-- Information avenant -->
        <mat-expansion-panel hideToggle [expanded]="true">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Information avenant
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="container " style="padding: 1rem 2rem;">

                <div class="row infos">
                    <!-- <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">N° Attestation: </div>
                            <div
                                class="col-md-6 value">{{attributsAvenant?.numAttestation}}
                            </div>
                        </div>
                    </div> -->
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Motif: </div>
                            <div
                                class="col-md-6 value">{{attributsAvenant?.motif?.motif?.description}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row infos">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Commentaire: </div>
                            <div
                                class="col-md-6 value">{{attributsAvenant?.motif.Commentaire}}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Date avenant: </div>
                            <div
                                class="col-md-6 value">{{attributsAvenant?.dateAvenant
                                | dateFormatPipe}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row infos"
                    *ngFor="let attribut of attributsAvenant?.attributList">
                    <div class="col-md-6">
                        <div class="row">
                            <div
                                class="col-md-6 key">{{attribut.attribut.attribut}}:
                            </div>
                            <div class="col-md-6 value"
                                *ngIf="attribut.attribut.type?.description == 'date'">
                                {{attribut?.reponse | dateFormatPipe}} </div>
                            <div class="col-md-6 value"
                                *ngIf="attribut.attribut.type?.description != 'date'">{{attribut?.reponse}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </mat-expansion-panel>
        <!--information assuree-->
        <mat-expansion-panel hideToggle [expanded]="true"
            *ngIf="attributsAvenant?.typeAvenant?.assuree && hisReady">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Information assuré
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="container " style="padding: 1rem 2rem;">

                <div class="row infos">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Type Client: </div>
                            <div
                                class="col-md-6 value">{{informationsAssure.typeClient}}</div>
                        </div>
                    </div>
                </div>
                <div class="row infos"
                    *ngIf="informationsAssure.typeClient=='personne physique';
                    else personneMoral">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Nom: </div>
                            <div
                                class="col-md-6 value">{{informationsAssure.nom}}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Prénom:</div>
                            <div
                                class="col-md-6 value">{{informationsAssure.prenom}}
                            </div>
                        </div>
                    </div>
                </div>
                <ng-template #personneMoral>
                    <div class="row infos">
                        <div class="col-md-6">
                            <div class="row">
                                <div class="col-md-6 key">Raison Social: </div>
                                <div
                                    class="col-md-6 value">{{informationsAssure.raisonSocial}}</div>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <div class="row infos">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Email: </div>
                            <div
                                class="col-md-6 value">{{informationsAssure.email}}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Téléphone:</div>
                            <div
                                class="col-md-6 value">{{informationsAssure.tel}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </mat-expansion-panel>
        <!--Information Souscripteuer-->
        <mat-expansion-panel hideToggle [expanded]="true" *ngIf="attributsAvenant?.typeAvenant?.souscripteur && this.hisReady">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Information souscripteur
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="container " style="padding: 1rem 2rem;">
                <div class="row infos">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Nom: </div>
                            <div
                                class="col-md-6 value">{{informationsSouscripteur.nom}}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Prénom:</div>
                            <div
                                class="col-md-6 value">{{informationsSouscripteur.prenom}}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row infos">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Email: </div>
                            <div
                                class="col-md-6 value">{{informationsSouscripteur.email}}</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-6 key">Téléphone:</div>
                            <div
                                class="col-md-6 value">{{informationsSouscripteur.tel}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </mat-expansion-panel>
        <!--Informations Risque-->
        <mat-expansion-panel hideToggle [expanded]="true">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Informations du risque
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="container " style="padding: 1rem 2rem;">
                <mat-accordion multi *ngIf="!multiRisque;else multirisque">
                    <mat-expansion-panel hideToggle
                        *ngFor="let risque of informationsRisque; let i= index"
                        [expanded]="true" class="panel-risque">
                        <ng-container>
                            <mat-expansion-panel-header>
                                <mat-panel-title class="categoryTitle">
                                    {{risque[i]?.categorieParamRisque}}
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="row infos " *ngFor="let rs of risque">
                                <div class="col-md-6">
                                    <div class="row">
                                        <div
                                            class="col-md-6 key">{{rs.libelle}}</div>
                                        <div class="col-md-6 value"
                                            *ngIf="rs.codeRisque=='P25' || rs.codeRisque=='P26'">{{rs.reponse.idParamReponse.description}}</div>
                                        <div class="col-md-6 value"
                                            *ngIf="rs.typeChamp=='date'">{{rs.reponse.valeur| dateFormatPipe}}</div>
                                        <div class="col-md-6 value"
                                            *ngIf="rs.typeChamp=='Number' || rs.typeChamp=='String'">{{rs.reponse.valeur}}</div>

                                        <div class="col-md-6 value"
                                            *ngIf="rs.typeChamp=='Liste of values'">{{rs.reponse.idParamReponse.description}}</div>
                                        <div class="col-md-6 value"
                                            *ngIf="rs.typeChamp=='From Table'">{{rs.reponse.description}}</div>
                                        <!-- <div class="col-md-6 value"
                                            *ngIf="rs.typeChamp!='Liste of values' && rs.typeChamp!='Number' && rs.typeChamp!='date' && rs.libelle!='Marque' && rs.libelle!='Modèle '">{{rs.reponse.valeur
                                            }}</div> -->
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </mat-expansion-panel>
                </mat-accordion>
                <ng-template #multirisque>
                    <mat-accordion multi>
                        <table
                            mat-table
                            [dataSource]="dataSourceGroupes"
                            class="gestion-table"
                            multiTemplateDataRows>
                            <!-- idInstance Column -->
                            <ng-container matColumnDef="description">
                                <th mat-header-cell *matHeaderCellDef>Description</th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.description }}
                                </td>
                            </ng-container>

                            <!-- more Column -->
                            <ng-container matColumnDef="more">
                                <th mat-header-cell *matHeaderCellDef></th>

                                <td mat-cell *matCellDef="let element">
                                    <button
                                        mat-icon-button
                                        type="button"
                                        aria-label
                                        (click)="toggleRow(element)">
                                        <mat-icon>{{
                                            expandedElement === element ?
                                            "expand_less" : "expand_more"
                                            }}</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="expandedDetail">
                                <td
                                    mat-cell
                                    *matCellDef="let element"
                                    [attr.colspan]="displayedColumnsRs.length">
                                    <div
                                        class="example-element-detail"
                                        *ngIf="element.risques?.data?.length"
                                        [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                        <div
                                            class="inner-table mat-elevation-z8"
                                            *ngIf="expandedElement">
                                            <table
                                                #innerTables
                                                mat-table
                                                class
                                                [dataSource]="element.risques"
                                                matSort>
                                                <!-- <ng-container
                                                    matColumnDef="description">
                                                    <th mat-header-cell
                                                        *matHeaderCellDef>N°
                                                        risque</th>
                                                    <td mat-cell
                                                        *matCellDef="let element">
                                                        {{
                                                        element.idRisque
                                                        }}
                                                    </td>
                                                </ng-container> -->
                                                <ng-container
                                                    *ngFor="let column of displayedColumnsCol; let i = index"
                                                    [matColumnDef]="column">

                                                    <th mat-header-cell
                                                        *matHeaderCellDef>
                                                        {{column}}</th>                                               
                                                    <td mat-cell *matCellDef="let element">
                                                        {{column !='DateDeNaissance'? element.risque[i][column] : element.risque[i][column] | dateFormatPipe}}
                                                    </td>
                                                </ng-container>
                                                <ng-container
                                                    matColumnDef="action">
                                                    <th mat-header-cell
                                                        *matHeaderCellDef>
                                                        Action </th>

                                                    <td mat-cell
                                                        *matCellDef="let element">
                                                        <button mat-icon-button
                                                            type="button"
                                                            [matMenuTriggerFor]="menu"
                                                            aria-label="menu contrat list">
                                                            <mat-icon>more_vert</mat-icon>
                                                        </button>
                                                        <mat-menu
                                                            #menu="matMenu"
                                                            xPosition="after"
                                                            class="menu-contrat">
                                                            <button
                                                                mat-menu-item
                                                                (click)="consultRisque(element.idRisque,idGroupe)"
                                                                type="button">
                                                                <mat-icon>zoom_in</mat-icon>
                                                                <span>Consulter
                                                                    risque</span>
                                                            </button>
                                                        </mat-menu>
                                                    </td>
                                                </ng-container>
                                                <tr mat-header-row
                                                    *matHeaderRowDef="displayedColumnsRsInner"></tr>
                                                <tr
                                                    mat-row
                                                    *matRowDef="let row; columns: displayedColumnsRsInner"></tr>
                                            </table>
                                        </div>
                                    </div>
                                </td>
                            </ng-container>

                            <tr mat-header-row
                                *matHeaderRowDef="displayedColumnsRs"></tr>
                            <tr
                                mat-row
                                *matRowDef="let element; columns: displayedColumnsRs"
                                [class.example-element-row]="element.risques?.data?.length"
                                [class.example-expanded-row]="expandedElement === element"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: ['expandedDetail']"
                                class="example-detail-row"></tr>
                        </table>
                        <mat-paginator
                            [pageSize]="10"
                            [pageSizeOptions]="[5, 10]"
                            aria-label="Select page of users"></mat-paginator>
                    </mat-accordion>
                </ng-template>

            </div>
        </mat-expansion-panel>
        <!--Prime-->
        <mat-expansion-panel hideToggle [expanded]="true">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Prime
                </mat-panel-title>
            </mat-expansion-panel-header>
            <table class="resume">

                <tr *ngFor="let element of dataSourcePrime">
                    <ng-container *ngIf="element.typePrime.idParam==101">
                        <td>{{element.typePrime.description}}</td>
                        <td>{{element.primeProrata | number : '1.0-0' | money}}
                            <sup>DA</sup></td>
                    </ng-container>
                </tr>
                <tr *ngFor="let element of dataSourceTaxe">
                    <td>{{element.taxe.description}}</td>
                    <td>{{element.primeProrata | number : '1.0-0' | money}}
                        <sup>DA</sup></td>
                </tr>
                <tr *ngFor="let element of dataSourcePrime">
                    <ng-container *ngIf="element.typePrime.idParam==186">
                        <td
                            class="primeTotale">{{element.typePrime.description}}</td>
                        <td class="primeTotale">{{element.primeProrata | number
                            :
                            '1.0-0' | money}} <sup>DA</sup></td>
                    </ng-container>
                </tr>
            </table>

        </mat-expansion-panel>
        <div class="row-button">
            <button class="btn btn-cancel" [routerLink]="['/consultation-avenants/vie/' + codeProduit +'/' +attributsAvenant?.idContrat]">Retour</button>
            <button class="btn btn-action"
                *ngIf="attributsAvenant?.statut.code == 'S09' && hasRights"
                (click)="approuverAvenant()">Approuver</button>
        </div>
    </mat-accordion>
</div>