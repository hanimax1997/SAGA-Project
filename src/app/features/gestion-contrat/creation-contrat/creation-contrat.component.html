<div class="container" *ngIf="renderGlobal">
    <h2 class="header-title"><mat-icon class="mat-icon notranslate
            material-symbols-outlined material-icons mat-icon-no-color"
            aria-label="directions_car">{{produitInfo.icon}}</mat-icon>
        Contrat {{produitInfo.description}} </h2>
    <mat-stepper #stepper [linear]="true">
        <!-- <mat-stepper #stepper linear>  -->
        <mat-step [stepControl]="formCreationContrat" [editable]="true">
            <ng-template matStepLabel>Informations contrat, souscripteur, assuré
            </ng-template>
            <mat-accordion class="example-headers-align" multi>
                <!-- Contrat -->
                <form [formGroup]="formCreationContrat"
                    *ngIf="formCreationContrat">
                    <!--INFORMATION Contrat -->
                    <mat-expansion-panel [expanded]="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Informations contrat
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <!-- body bloc -->
                        <div class="row" style="padding: 1rem 2rem;">
                            <mat-form-field appearance="outline"
                                class="col-md-6">
                                <mat-label>Agence</mat-label>
                                <mat-select formControlName="agence">
                                    <ng-container *ngFor="let agence of agences">
                                        <mat-option
                                            [value]="agence.idAgence">
                                            {{agence.nomAgence}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-6">
                                <mat-label>Produit</mat-label>
                                <mat-select formControlName="produit">
                                    <ng-container
                                        *ngFor="let produit of produits">
                                        <mat-option
                                            [value]="produit.idCodeProduit">
                                            {{produit.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-6">
                                <mat-label>Durée</mat-label>
                                <mat-select formControlName="duree">
                                    <ng-container *ngFor="let duree of durees">
                                        <mat-option
                                            [value]="duree.id_duree">
                                            {{duree.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>   
                            <!-- [min]="!isBOUser? now : null"
                                    [max]="codeProduit =='45F' || (codeProduit=='97' && isBOUser)  ?null : month" -->

                            <mat-form-field class="col-md-6"
                                appearance="outline">
                                <mat-label>Date d'Effet</mat-label>
                                <input matInput
                                    [matDatepicker]="pickerDateEffet"
                                    [min]="codeProduit == '45L' ? null : (!isBOUser ? now : null)"
                                    [max]="codeProduit == '45L' ? null : (codeProduit == '45F' || (codeProduit == '97' && isBOUser) ? null : month)"
                                 
                                    formControlName="dateEffet">
                                <mat-datepicker-toggle matSuffix
                                    [for]="pickerDateEffet"></mat-datepicker-toggle>
                                <mat-datepicker #pickerDateEffet></mat-datepicker>
                                <mat-error
                                    *ngIf="formCreationContrat.controls.dateEffet.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationContrat.controls.dateEffet.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </mat-expansion-panel>
                </form>

                <!-- assuré -->
                <form
                    [formGroup]="formCreationAssure"
                    *ngIf="formCreationAssure">
                    <mat-expansion-panel [expanded]="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                {{ 'Informations de assuré(e)'}}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <!-- body bloc -->
                        <div class="row" style="padding: 1rem 2rem;"
                            *ngIf="devis?.typeClient?.description == 'personne morale'">
                            <div class="row"
                                style="display: flex;align-items: center;justify-content: space-between;">
                                <mat-form-field class="col-md-6"
                                    appearance="outline">
                                    <mat-label>Raison social</mat-label>
                                    <input type="text" matInput placeholder
                                        formControlName="raisonSocial"
                                        [readonly]="true">
                                    <mat-error
                                        *ngIf="formCreationAssure.controls.raisonSocial.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationAssure.controls.raisonSocial.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>
                                <button
                                    *ngIf="formCreationAssure.value.raisonSocial != ''"
                                    class="btn btn-secondary"
                                    (mouseup)="recherchePersonne('assure')"
                                    style="display: flex; width: auto;">
                                    Rechercher
                                </button>
                                <button
                                    *ngIf="formCreationAssure.value.raisonSocial == ''"
                                    class="btn btn-disable" disabled
                                    (mouseup)="recherchePersonne('assure')"
                                    style="display: flex; width: auto;">
                                    Rechercher
                                </button>
                            </div>

                            <mat-form-field class="col-md-6"
                                appearance="outline">
                                <mat-label>N° RIB</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="rib">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.rib.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.rib.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.rib.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.rib.errors?.['maxlength'] || formCreationAssure.controls.rib.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-6"
                                pattern="[0-9]{15}" appearance="outline">
                                <mat-label>NIF</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="nif">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.nif.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.nif.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                 <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationAssure.controls.nif.errors?.['maxlength'] || formCreationAssure.controls.nif.errors?.['minlength'] 
                                    ">
                                ce champs n'est pas conforme
                                </mat-error> 
                                 <!-- <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.nif.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.nif.errors?.['maxlength'] || formCreationAssure.controls.nif.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>  -->
                            </mat-form-field>

                            <mat-form-field class="col-md-6"
                                appearance="outline">
                                <mat-label>Mobile</mat-label>
                                <span matPrefix>+213 &nbsp;</span>
                                <input type="text" matInput placeholder
                                    formControlName="telephone">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.telephone.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.telephone.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.telephone.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.telephone.errors?.['maxlength'] || formCreationAssure.controls.telephone.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-6"
                                appearance="outline">
                                <mat-label>Email</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="email">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.email.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.email.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.email.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.email.errors?.['maxlength'] || formCreationAssure.controls.email.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Adresse</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="adresse">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.adresse.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.adresse.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Wilaya</mat-label>
                                <mat-select formControlName="wilaya"
                                    (selectionChange)="getCommune($event.value, 'Assure')">
                                    <ng-container *ngFor="let wilaya of wilayas">
                                        <mat-option
                                            [value]="wilaya.idWilaya">
                                            {{wilaya.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="formCreationAssure.controls.wilaya.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.wilaya.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Commune</mat-label>
                                <mat-select formControlName="commune">
                                    <ng-container
                                        *ngFor="let commune of communes_assure">
                                        <mat-option
                                            [value]="commune.idCommune">
                                            {{commune.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="formCreationAssure.controls.commune.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.commune.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                            appearance="outline" *ngIf="codeProduit == '97'">
                                <mat-label>Ligne de  Business</mat-label>
                                <mat-select (selectionChange)="onLineOfBusinessSelected($event.value)" formControlName="lineOfBusiness">
                                  <mat-option *ngFor="let lineOfBusiness of lineOfBusinessList" [value]="lineOfBusiness.idParam">
                                    {{ lineOfBusiness.description }}  
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                              

                              <mat-form-field class="col-md-4"
                              appearance="outline" *ngIf="codeProduit == '97'">
                                <mat-label>Secteur d'activité </mat-label>
                                <mat-select (selectionChange)="onSecteurActiviteSelected($event.value)" formControlName="secteurActivite">
                                  <mat-option *ngFor="let secteurActivite of secteurActiviteList" [value]="secteurActivite.idParam">
                                    {{ secteurActivite.description }}  
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>


                              <mat-form-field class="col-md-4"
                              appearance="outline" *ngIf="codeProduit == '97'">
                                <mat-label>Occupation </mat-label>
                                <mat-select (selectionChange)="onOccupationSelected($event.value)" formControlName="occupation">
                                  <mat-option *ngFor="let occupation of occupationList" [value]="occupation.idParam">
                                    {{ occupation.description }}  
                                  </mat-option>
                                </mat-select>
                              </mat-form-field>
                        </div>

                        <div class="row" style="padding: 1rem 2rem;"
                            *ngIf="devis?.typeClient?.description == 'personne physique'">
                            <div class="row"
                                style="display: flex;align-items: center;justify-content: space-between;">
                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Nom</mat-label>
                                    <input type="text" matInput placeholder
                                        formControlName="nom" [readonly]="true">
                                    <mat-error
                                        *ngIf="formCreationAssure.controls.nom.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationAssure.controls.nom.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Prénom</mat-label>
                                    <input type="text" matInput placeholder
                                        formControlName="prenom"
                                        [readonly]="true">
                                    <mat-error
                                        *ngIf="formCreationAssure.controls.prenom.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationAssure.controls.prenom.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Date de naissance</mat-label>
                                    <input matInput [max]="now"
                                        [matDatepicker]="pickerdateNaissance"
                                        formControlName="dateNaissance">
                                    <mat-datepicker-toggle matSuffix
                                        [for]="pickerdateNaissance"></mat-datepicker-toggle>
                                    <mat-datepicker #pickerdateNaissance></mat-datepicker>
                                    <mat-error
                                        *ngIf="formCreationAssure.controls.dateNaissance.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationAssure.controls.dateNaissance.errors.ageInf18">
                                            L'age du souscripteur doit etre
                                            supérieur à 18 ans</div>
                                        <div
                                            *ngIf="formCreationAssure.controls.dateNaissance.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <button
                                    *ngIf="formCreationAssure.value.nom != '' && formCreationAssure.value.prenom != '' && formCreationAssure.value.dateNaissance != null"
                                    class="btn btn-secondary"
                                    (mouseup)="recherchePersonne('assure')"
                                    style="display: flex; width: auto;">
                                    Rechercher
                                </button>
                                <button
                                    *ngIf="formCreationAssure.value.nom == '' || formCreationAssure.value.prenom == '' || formCreationAssure.value.dateNaissance == null"
                                    disabled class="btn btn-disable"
                                    (mouseup)="recherchePersonne('assure')"
                                    style="display: flex; width: auto;">
                                    Rechercher
                                </button>
                            </div>

                            <mat-form-field  *ngIf="codeProduit=='97' && typeClient=='personne physique'" class="col-md-4"
                                pattern="[0-9]{18}" appearance="outline">
                                <mat-label>NIN</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="nin">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.nin.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.nin.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>

                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.nin.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.nin.errors?.['maxlength'] || formCreationAssure.controls.nin.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Mobile</mat-label>
                                <span matPrefix>+213 &nbsp;</span>
                                <input type="text" matInput placeholder
                                    formControlName="telephone">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.telephone.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.telephone.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.telephone.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.telephone.errors?.['maxlength'] || formCreationAssure.controls.telephone.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Email</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="email">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.email.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.email.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationAssure.controls.email.errors?.['pattern']
                                        ||
                                        formCreationAssure.controls.email.errors?.['maxlength'] || formCreationAssure.controls.email.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Adresse</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="adresse">
                                <mat-error
                                    *ngIf="formCreationAssure.controls.adresse.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.adresse.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Wilaya</mat-label>
                                <mat-select formControlName="wilaya"
                                    (selectionChange)="getCommune($event.value, 'Assure')">
                                    <ng-container *ngFor="let wilaya of wilayas">
                                        <mat-option
                                            [value]="wilaya.idWilaya">
                                            {{wilaya.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="formCreationAssure.controls.wilaya.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.wilaya.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Commune</mat-label>
                                <mat-select formControlName="commune">
                                    <ng-container
                                        *ngFor="let commune of communes_assure">
                                        <mat-option
                                            [value]="commune.idCommune">
                                            {{commune.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="formCreationAssure.controls.commune.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.commune.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Genre </mat-label>
                                <mat-select formControlName="genre">
                                    <ng-container *ngFor="let genre of genres">
                                        <mat-option [value]="genre.idParam">{{genre.description}}</mat-option>
                                    </ng-container>
                                </mat-select>
                                <mat-error
                                    *ngIf="formCreationAssure.controls.genre.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationAssure.controls.genre.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Situation Familiale </mat-label>
                                <mat-select formControlName="situation">
                                    <ng-container
                                        *ngFor="let situation of situations">
                                        <mat-option [value]="situation.idParam">{{situation.description}}</mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Profession </mat-label>
                                <mat-select formControlName="profession">
                                    <ng-container
                                        *ngFor="let profession of professions">
                                        <mat-option
                                            [value]="profession.idProfession">{{profession.description}}</mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-expansion-panel>
                </form>

                <!-- Souscripteur -->
                <!-- <form
                    [formGroup]="formCreationSouscripteur"
                    *ngIf="formCreationSouscripteur && !multiRisque">
                    <mat-expansion-panel [expanded]="true">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                {{ 'Informations souscripteur' }}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                       

                        <div class="row" style="padding: 1rem 2rem;">
                            <mat-checkbox class="col-md-12"
                                style="padding: 1rem 2rem;"
                                *ngIf="devis?.typeClient?.description == 'personne physique'"
                                (change)="changeRoleClient($event.checked, 'Souscripteur')">Cette
                                personne est-elle l'assuré</mat-checkbox>

                            <div class="row"
                                style="display: flex;align-items: center;justify-content: space-between;">
                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Nom</mat-label>
                                    <input type="text" matInput placeholder
                                        formControlName="nom">

                                    <mat-error
                                        *ngIf="formCreationSouscripteur.controls.nom.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationSouscripteur.controls.nom.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Prénom</mat-label>
                                    <input type="text" matInput placeholder
                                        formControlName="prenom">

                                    <mat-error
                                        *ngIf="formCreationSouscripteur.controls.prenom.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationSouscripteur.controls.prenom.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="col-md-3"
                                    appearance="outline">
                                    <mat-label>Date de naissance</mat-label>
                                    <input matInput [max]="now"
                                        [matDatepicker]="pickerdateNaissance"
                                        formControlName="dateNaissance">
                                    <mat-datepicker-toggle matSuffix
                                        [for]="pickerdateNaissance"></mat-datepicker-toggle>
                                    <mat-datepicker #pickerdateNaissance></mat-datepicker>
                                    <mat-error
                                        *ngIf="formCreationSouscripteur.controls.dateNaissance.errors"
                                        class="invalid-feedback">
                                        <div
                                            *ngIf="formCreationSouscripteur.controls.dateNaissance.errors.ageInf18">
                                            L'age du souscripteur doit etre
                                            supérieur à 18 ans</div>
                                        <div
                                            *ngIf="formCreationSouscripteur.controls.dateNaissance.errors.required">
                                            ce champs est obligatoire</div>
                                    </mat-error>
                                </mat-form-field>

                                <div style="display: flex; width: auto;">
                                    <button
                                        *ngIf="formCreationSouscripteur.value.nom != '' && formCreationSouscripteur.value.prenom != '' && formCreationSouscripteur.value.dateNaissance != null"
                                        class="btn btn-secondary"
                                        (mouseup)="recherchePersonne('souscripteur')">
                                        Rechercher
                                    </button>
                                    <button
                                        *ngIf="formCreationSouscripteur.value.nom == '' || formCreationSouscripteur.value.prenom == '' || formCreationSouscripteur.value.dateNaissance == null"
                                        disabled class="btn btn-disable"
                                        (mouseup)="recherchePersonne('souscripteur')">
                                        Rechercher
                                    </button>
                                </div>
                            </div>

                            <mat-form-field class="col-md-4"
                                pattern="[0-9]{18}" appearance="outline">
                                <mat-label>NIN</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="nin">
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="(formCreationSouscripteur.controls.nin.errors?.['pattern']
                                        ||
                                        formCreationSouscripteur.controls.nin.errors?.['maxlength'] || formCreationSouscripteur.controls.nin.errors?.['minlength'] ) && devis?.typeClient?.description == 'personne morale'">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Mobile</mat-label>
                                <span matPrefix>+213 &nbsp;</span>
                                <input type="text" matInput placeholder
                                    formControlName="telephone">
                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.telephone.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.telephone.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationSouscripteur.controls.telephone.errors?.['pattern']
                                        ||
                                        formCreationSouscripteur.controls.telephone.errors?.['maxlength'] || formCreationSouscripteur.controls.telephone.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Email</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="email">

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.email.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.email.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                                <mat-error
                                    class="invalid-feedback"
                                    *ngIf="formCreationSouscripteur.controls.email.errors?.['pattern']
                                        ||
                                        formCreationSouscripteur.controls.email.errors?.['maxlength'] || formCreationSouscripteur.controls.email.errors?.['minlength'] 
                                        ">
                                    ce champs n'est pas conforme
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label>Adresse</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="adresse">

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.adresse.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.adresse.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Wilaya</mat-label>
                                <mat-select formControlName="wilaya"
                                    (selectionChange)="getCommune($event.value, 'Souscripteur')">
                                    <ng-container *ngFor="let wilaya of wilayas">
                                        <mat-option
                                            [value]="wilaya.idWilaya">
                                            {{wilaya.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.wilaya.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.wilaya.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline"
                                class="col-md-4">
                                <mat-label>Commune</mat-label>
                                <mat-select formControlName="commune">
                                    <ng-container
                                        *ngFor="let commune of communes_sous">
                                        <mat-option
                                            [value]="commune.idCommune">
                                            {{commune.description}}
                                        </mat-option>
                                    </ng-container>
                                </mat-select>

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.commune.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.commune.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Genre </mat-label>
                                <mat-select formControlName="genre">
                                    <ng-container *ngFor="let genre of genres">
                                        <mat-option [value]="genre.idParam">{{genre.description}}</mat-option>
                                    </ng-container>
                                </mat-select>

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.genre.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.genre.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Situation Familiale </mat-label>
                                <mat-select formControlName="situation">
                                    <ng-container
                                        *ngFor="let situation of situations">
                                        <mat-option [value]="situation.idParam">{{situation.description}}</mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>

                            <mat-form-field class="col-md-4"
                                appearance="outline">
                                <mat-label> Profession </mat-label>
                                <mat-select formControlName="profession">
                                    <ng-container
                                        *ngFor="let profession of professions">
                                        <mat-option
                                            [value]="profession.idProfession">{{profession.description}}</mat-option>
                                    </ng-container>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </mat-expansion-panel>
                </form> -->
           
            
                <form
                [formGroup]="formCreationSouscripteur"
                *ngIf="(codeProduit!='97'&& formCreationSouscripteur && !multiRisque)|| (codeProduit=='97'&& formCreationSouscripteur )">
                <mat-expansion-panel [expanded]="true">
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{ 'Informations souscripteur' }}
                        </mat-panel-title>
                    </mat-expansion-panel-header>
                    <!-- body bloc -->
                    

                    <div class="row" style="padding: 1rem 2rem;">


                      



                        <mat-checkbox class="col-md-12"
                            style="padding: 1rem 2rem;"
                            *ngIf="(devis?.typeClient?.description == 'personne physique' && codeProduit!='97')||(codeProduit=='97')"
                            (change)="changeRoleClient($event.checked, 'Souscripteur')">Cette
                            personne est-elle l'assuré</mat-checkbox>




                            <div class="row" >

                                <!-- {{ typeClient=='personne morale'}} -->
                            <mat-form-field 
                            *ngIf="codeProduit == '97'"
                            appearance="outline" 
                            class="col-md-5">
                            <mat-label>Type client </mat-label>
                            <mat-select 
                              formControlName="typeClient"
                              (selectionChange)="changeTypeClient($event.value)">
                              <ng-container *ngFor="let type of typeClients">
                                <mat-option
                                 
                                  [value]="type">
                                  {{type.description}}
                                </mat-option>
                              </ng-container>
                            </mat-select>
                          
                        
                          </mat-form-field>




                          <!-- hahaha -->




                          <div class="row" *ngIf="(codeProduit=='97' && typeClientSous=='personne physique') ||(codeProduit!='97')"
                            style="display: flex;align-items: center;justify-content: space-between;">


                           
                            <mat-form-field class="col-md-3"
                                appearance="outline">
                                <mat-label>Nom</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="nom">

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.nom.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.nom.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-3"
                                appearance="outline">
                                <mat-label>Prénom</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="prenom">

                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.prenom.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.prenom.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="col-md-3"
                                appearance="outline">
                                <mat-label>Date de naissance</mat-label>
                                <input matInput [max]="now"
                                    [matDatepicker]="pickerdateNaissance"
                                    formControlName="dateNaissance">
                                <mat-datepicker-toggle matSuffix
                                    [for]="pickerdateNaissance"></mat-datepicker-toggle>
                                <mat-datepicker #pickerdateNaissance></mat-datepicker>
                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.dateNaissance.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.dateNaissance.errors.ageInf18">
                                        L'age du souscripteur doit etre
                                        supérieur à 18 ans</div>
                                        <div
                                        *ngIf="formCreationSouscripteur.controls.dateNaissance.errors.ageSup107">
                                        L'age du souscripteur ne doit pas etre
                                        supérieur à 107 ans</div>
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.dateNaissance.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>

                            <div style="display: flex; width: auto;">
                                <button
                                    *ngIf="formCreationSouscripteur.value.nom != '' && formCreationSouscripteur.value.prenom != '' && formCreationSouscripteur.value.dateNaissance != null"
                                    class="btn btn-secondary"
                                    (mouseup)="recherchePersonne('souscripteur')">
                                    Rechercher
                                </button>
                                <button
                                    *ngIf="formCreationSouscripteur.value.nom == '' || formCreationSouscripteur.value.prenom == '' || formCreationSouscripteur.value.dateNaissance == null"
                                    disabled class="btn btn-disable"
                                    (mouseup)="recherchePersonne('souscripteur')">
                                    Rechercher
                                </button>
                            </div>
                        </div>

                        <div class="row"  *ngIf="codeProduit=='97' && typeClientSous=='personne morale'"
                            style="display: flex;align-items: center;justify-content: space-between;">
                            <mat-form-field class="col-md-6"
                                appearance="outline">
                                <mat-label>Raison social</mat-label>
                                <input type="text" matInput placeholder
                                    formControlName="raisonSocial"
                                    [readonly]="false">
                                <mat-error
                                    *ngIf="formCreationSouscripteur.controls.raisonSocial.errors"
                                    class="invalid-feedback">
                                    <div
                                        *ngIf="formCreationSouscripteur.controls.raisonSocial.errors.required">
                                        ce champs est obligatoire</div>
                                </mat-error>
                            </mat-form-field>
                            <button
                                *ngIf="formCreationSouscripteur.value.raisonSocial != ''"
                                class="btn btn-secondary"
                                (mouseup)="recherchePersonne('assure')"
                                style="display: flex; width: auto;">
                                Rechercher
                            </button>
                            <button
                                *ngIf="formCreationSouscripteur.value.raisonSocial == ''"
                                class="btn btn-disable" disabled
                                (mouseup)="recherchePersonne('assure')"
                                style="display: flex; width: auto;">
                                Rechercher
                            </button>
                        </div>
















                          <!-- hahaha -->
                         
                        </div>
                          
                        <!-- //FINADDIN --><!-- dagui personne moral -->

                     


                        <div class="row" style="padding: 1rem 2rem;"
                       >
                        

                        <mat-form-field class="col-md-6"
                            appearance="outline">
                            <mat-label>N° RIB</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="rib">
                            <!-- <mat-error
                                *ngIf="formCreationAssure.controls.rib.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationAssure.controls.rib.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error> -->
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationSouscripteur.controls.rib.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.rib.errors?.['maxlength'] || formCreationAssure.controls.rib.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field  *ngIf="codeProduit=='97' && typeClientSous=='personne morale'" class="col-md-6"
                            pattern="[0-9]{15}" appearance="outline">
                            <mat-label>NIF</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="nif">
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.nif.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.nif.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                             <mat-error
                            class="invalid-feedback"
                            *ngIf="formCreationSouscripteur.controls.nif.errors?.['maxlength'] || formCreationSouscripteur.controls.nif.errors?.['minlength']
                                ">
                            ce champs n'est pas conforme
                            </mat-error>
                             <!-- <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationAssure.controls.nif.errors?.['pattern']
                                    ||
                                    formCreationAssure.controls.nif.errors?.['maxlength'] || formCreationAssure.controls.nif.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>  -->
                        </mat-form-field>

                        <!-- <mat-form-field class="col-md-6"
                            appearance="outline">
                            <mat-label>Mobile</mat-label>
                            <span matPrefix>+213 &nbsp;</span>
                            <input type="text" matInput placeholder
                                formControlName="telephone">
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.telephone.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.telephone.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationSouscripteur.controls.telephone.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.telephone.errors?.['maxlength'] || formCreationSouscripteur.controls.telephone.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field> -->

                        <!-- <mat-form-field class="col-md-6"
                            appearance="outline">
                            <mat-label>Email</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="email">
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.email.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.email.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationSouscripteur.controls.email.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.email.errors?.['maxlength'] || formCreationSouscripteur.controls.email.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field> -->

                        <!-- <mat-form-field class="col-md-4"
                            appearance="outline">
                            <mat-label>Adresse</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="adresse">
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.adresse.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.adresse.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field> -->

                        <!-- <mat-form-field appearance="outline"
                            class="col-md-4">
                            <mat-label>Wilaya</mat-label>
                            <mat-select formControlName="wilaya"
                                (selectionChange)="getCommune($event.value, 'Assure')">
                                <ng-container *ngFor="let wilaya of wilayas">
                                    <mat-option
                                        [value]="wilaya.idWilaya">
                                        {{wilaya.description}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.wilaya.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.wilaya.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field> -->

                        <!-- <mat-form-field appearance="outline"
                            class="col-md-4">
                            <mat-label>Commune</mat-label>
                            <mat-select formControlName="commune">
                                <ng-container
                                    *ngFor="let commune of communes_assure">
                                    <mat-option
                                        [value]="commune.idCommune">
                                        {{commune.description}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.commune.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.commune.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field> -->





                        <!-- test -->
                        


                    </div>










                        <!-- la tu affiche la partiie pour rasion sociale que tu prend de form assurée  -->

                        <mat-form-field  *ngIf="codeProduit=='97' && typeClientSous=='personne physique'" class="col-md-4"
                            pattern="[0-9]{18}" appearance="outline">
                            <mat-label>NIN</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="nin">
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="(formCreationSouscripteur.controls.nin.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.nin.errors?.['maxlength'] || formCreationSouscripteur.controls.nin.errors?.['minlength'] ) && devis?.typeClient?.description == 'personne morale'">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-md-4"
                            appearance="outline">
                            <mat-label>Mobile</mat-label>
                            <span matPrefix>+213 &nbsp;</span>
                            <input type="text" matInput placeholder
                                formControlName="telephone">
                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.telephone.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.telephone.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationSouscripteur.controls.telephone.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.telephone.errors?.['maxlength'] || formCreationSouscripteur.controls.telephone.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-md-4"
                            appearance="outline">
                            <mat-label>Email</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="email">

                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.email.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.email.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                            <mat-error
                                class="invalid-feedback"
                                *ngIf="formCreationSouscripteur.controls.email.errors?.['pattern']
                                    ||
                                    formCreationSouscripteur.controls.email.errors?.['maxlength'] || formCreationSouscripteur.controls.email.errors?.['minlength']
                                    ">
                                ce champs n'est pas conforme
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field class="col-md-4"
                            appearance="outline">
                            <mat-label>Adresse</mat-label>
                            <input type="text" matInput placeholder
                                formControlName="adresse">

                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.adresse.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.adresse.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline"
                            class="col-md-4">
                            <mat-label>Wilaya</mat-label>
                            <mat-select formControlName="wilaya"
                                (selectionChange)="getCommune($event.value, 'Souscripteur')">
                                <ng-container *ngFor="let wilaya of wilayas">
                                    <mat-option
                                        [value]="wilaya.idWilaya">
                                        {{wilaya.description}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>

                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.wilaya.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.wilaya.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="outline"
                            class="col-md-4">
                            <mat-label>Commune</mat-label>
                            <mat-select formControlName="commune">
                                <ng-container
                                    *ngFor="let commune of communes_sous">
                                    <mat-option
                                        [value]="commune.idCommune">
                                        {{commune.description}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>

                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.commune.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.commune.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field  *ngIf="typeClientSous=='personne physique'" class="col-md-4"
                            appearance="outline">
                            <mat-label> Genre </mat-label>
                            <mat-select formControlName="genre">
                                <ng-container *ngFor="let genre of genres">
                                    <mat-option [value]="genre.idParam">{{genre.description}}</mat-option>
                                </ng-container>
                            </mat-select>

                            <mat-error
                                *ngIf="formCreationSouscripteur.controls.genre.errors"
                                class="invalid-feedback">
                                <div
                                    *ngIf="formCreationSouscripteur.controls.genre.errors.required">
                                    ce champs est obligatoire</div>
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field *ngIf="typeClientSous=='personne physique'" class="col-md-4"
                            appearance="outline">
                            <mat-label> Situation Familiale </mat-label>
                            <mat-select formControlName="situation">
                                <ng-container
                                    *ngFor="let situation of situations">
                                    <mat-option [value]="situation.idParam">{{situation.description}}</mat-option>
                                </ng-container>
                            </mat-select>
                        </mat-form-field>

                        <mat-form-field *ngIf="typeClientSous=='personne physique'" class="col-md-4"
                            appearance="outline">
                            <mat-label> Profession </mat-label>
                            <mat-select formControlName="profession">
                                <ng-container
                                    *ngFor="let profession of professions">
                                    <mat-option
                                        [value]="profession.idProfession">{{profession.description}}</mat-option>
                                </ng-container>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>
            </form>
            
            </mat-accordion>
            <div class="row-button">
                <button class="btn btn-cancel"
                    (mouseup)="redirectConsultation()">Annuler</button>
                <button (click)="nextStep()" class="btn btn-action">Suivant</button>
            </div>
        </mat-step>

        <mat-step [stepControl]="formCreationConducteur && formCreationRisque"
            [editable]="true" *ngIf="devisReady">
            <ng-template matStepLabel>Informations du risque</ng-template>
            <ng-container *ngIf="!multiRisque;else multirisque">
                <mat-accordion class="example-headers-align" multi>
                    <mat-expansion-panel hideToggle
                        *ngFor="let param of paraRisqueProduitCategory ; let i=index"
                        [expanded]="true" class="panel-risque">
                        <mat-expansion-panel-header>
                            <mat-panel-title class="categoryTitle">
                                Informations {{param[i].category}}
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <form
                            [formGroup]="param[i].category == 'Conducteur' ?formCreationConducteur :formCreationRisque"
                            *ngIf="formCreationRisque">
                            <!--FIX PK *ngIf="formCreationRisque || formCreationConducteur" -->

                            <div class="row" style="padding: 1rem 2rem;">
                                <ng-container
                                    *ngIf="param[i].category == 'Conducteur'">
                                    <mat-checkbox class="col-md-12 Conducteur"
                                        [checked]="isConducteur"
                                        style="padding: 1rem 2rem;"
                                        (change)="changeRoleClient($event.checked, 'Conducteur')">Cette
                                        personne est-elle le souscripteur</mat-checkbox>
                                    <mat-checkbox
                                        class="col-md-12 ConducteurAssure"
                                        [checked]="isConducteurAssure"
                                        style="padding: 1rem 2rem;"
                                        (change)="changeRoleClient($event.checked, 'ConducteurAssure')"
                                        *ngIf="devis?.typeClient?.description == 'personne physique'">Cette
                                        personne est-elle l'assuré</mat-checkbox>

                                    <div class="row"
                                        style="display: flex;align-items: center;justify-content: space-between;">
                                        <mat-form-field class="col-md-3"
                                            appearance="outline">
                                            <mat-label>Nom</mat-label>
                                            <input type="text" matInput
                                                placeholder
                                                formControlName="nom">
                                            <mat-error
                                                *ngIf="formCreationConducteur.controls.nom.errors"
                                                class="invalid-feedback">
                                                <div
                                                    *ngIf="formCreationConducteur.controls.nom.errors.required">
                                                    ce champs est obligatoire</div>
                                            </mat-error>
                                        </mat-form-field>

                                        <mat-form-field class="col-md-3"
                                            appearance="outline">
                                            <mat-label>Prénom</mat-label>
                                            <input type="text" matInput
                                                placeholder
                                                formControlName="prenom">
                                            <mat-error
                                                *ngIf="formCreationConducteur.controls.prenom.errors"
                                                class="invalid-feedback">
                                                <div
                                                    *ngIf="formCreationConducteur.controls.prenom.errors.required">
                                                    ce champs est obligatoire</div>
                                            </mat-error>
                                        </mat-form-field>
                                        <ng-container *ngFor="let rs of param">
                                            <mat-form-field class="col-md-3"
                                                appearance="outline"
                                                *ngIf="rs.formName=='DateDeNaissance' && formCreationConducteur.get(rs.formName) != undefined">
                                                <mat-label>Date de naissance</mat-label>
                                                <input matInput [max]="now"
                                                    [matDatepicker]="pickerdateNaissance"
                                                    formControlName="{{ rs.formName }}"
                                                    [disabled]="true">
                                                <mat-datepicker-toggle matSuffix
                                                    [for]="pickerdateNaissance"></mat-datepicker-toggle>
                                                <mat-datepicker
                                                    #pickerdateNaissance></mat-datepicker>
                                                <!-- <mat-error *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['required']" class="invalid-feedback">
                                                    ce champs est obligatoire
    
                                                    <div *ngIf="formCreationConducteur.controls.dateNaissance.errors.ageInf18">
                                                        L'age du souscripteur doit etre supérieur à 18 ans</div>
                                                </mat-error> -->
                                                <mat-error
                                                    *ngIf="formCreationConducteur.get(rs.formName)?.errors"
                                                    class="invalid-feedback">
                                                    <div
                                                        *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['ageInf18']">
                                                        L'age du souscripteur
                                                        doit
                                                        etre supérieur à 18 ans</div>
                                                    <div
                                                        *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['required']">
                                                        ce champs est
                                                        obligatoire</div>
                                                </mat-error>
                                            </mat-form-field>
                                        </ng-container>

                                        <button
                                            *ngIf="formCreationConducteur.get('nom').value != null && formCreationConducteur.get('prenom').value != null && formCreationConducteur.get('DateDeNaissance').value != null"
                                            class="btn btn-secondary"
                                            (mouseup)="recherchePersonne('Conducteur')"
                                            style="display: flex; width: auto;">
                                            Rechercher
                                        </button>
                                        <button
                                            *ngIf="formCreationConducteur.get('nom').value == null || formCreationConducteur.get('prenom').value == null || formCreationConducteur.get('DateDeNaissance').value == null"
                                            disabled class="btn btn-disable"
                                            (mouseup)="recherchePersonne('Conducteur')"
                                            style="display: flex; width: auto;">
                                            Rechercher
                                        </button>
                                    </div>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label>Mobile</mat-label>
                                        <span matPrefix>+213 &nbsp;</span>
                                        <input type="text" matInput placeholder
                                            formControlName="telephone">
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.telephone.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.telephone.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationConducteur.controls.telephone.errors?.['pattern']
                                            ||
                                            formCreationConducteur.controls.telephone.errors?.['maxlength'] || formCreationConducteur.controls.telephone.errors?.['minlength'] 
                                            ">
                                            ce champs n'est pas conforme
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label>Email</mat-label>
                                        <input type="text" matInput placeholder
                                            formControlName="email">
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.email.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.email.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationConducteur.controls.email.errors?.['pattern']
                                            ||
                                            formCreationConducteur.controls.email.errors?.['maxlength'] || formCreationConducteur.controls.email.errors?.['minlength'] 
                                            ">
                                            ce champs n'est pas conforme
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label>Adresse</mat-label>
                                        <input type="text" matInput placeholder
                                            formControlName="adresse">
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.adresse.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.adresse.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline"
                                        class="col-md-5">
                                        <mat-label>Wilaya</mat-label>
                                        <mat-select formControlName="wilaya"
                                            (selectionChange)="getCommune($event.value, 'Conducteur')">
                                            <ng-container
                                                *ngFor="let wilaya of wilayas">
                                                <mat-option
                                                    [value]="wilaya.idWilaya">
                                                    {{wilaya.description}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.wilaya.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.wilaya.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field appearance="outline"
                                        class="col-md-5">
                                        <mat-label>Commune</mat-label>
                                        <mat-select formControlName="commune">
                                            <ng-container
                                                *ngFor="let commune of communes_cond">
                                                <mat-option
                                                    [value]="commune.idCommune">
                                                    {{commune.description}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.commune.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.commune.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label> Situation Familiale
                                        </mat-label>
                                        <mat-select formControlName="situation">
                                            <ng-container
                                                *ngFor="let situation of situations">
                                                <mat-option
                                                    [value]="situation.idParam">{{situation.description}}</mat-option>
                                            </ng-container>
                                        </mat-select>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label> Profession </mat-label>
                                        <mat-select formControlName="profession">
                                            <ng-container
                                                *ngFor="let profession of professions">
                                                <mat-option
                                                    [value]="profession.idProfession">{{profession.description}}</mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.profession.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.profession.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label>Numero Permis</mat-label>
                                        <input type="text" matInput placeholder
                                            formControlName="numeroPermis">
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.numeroPermis.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.numeroPermis.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <mat-form-field class="col-md-5"
                                        appearance="outline">
                                        <mat-label> Catégorie Permis
                                        </mat-label>
                                        <mat-select
                                            formControlName="categoriePermis">
                                            <ng-container
                                                *ngFor="let cat of categories">
                                                <mat-option [value]="cat">{{cat}}</mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationConducteur.controls.categoriePermis.errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationConducteur.controls.categoriePermis.errors.required">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>
                                </ng-container>
                                <!-- <ng-container *ngIf="param[i].category == 'vehicule'">
                                        <ng-container *ngFor="let rs of param">
                                            Marque
                                            <mat-form-field appearance="outline" class="col-md-5" *ngIf="rs.formName == 'Marque' && formCreationRisque.get(rs.formName) != undefined">
                                                <mat-label> {{rs.libelle}} </mat-label>
                                                <mat-select formControlName="{{rs.formName}}" (selectionChange)="getModeleByMarque($event.value)">
                                                    <ng-container *ngFor="let marque of marques">
                                                        <mat-option [value]="marque.idParam">
                                                            {{marque.marque}}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                                <mat-error *ngIf="formCreationRisque.get('Marque').errors"
                                                            class="invalid-feedback">
                                                     <div
                                                    *ngIf="formCreationRisque.get('Marque').errors?.['required']">
                                                    ce champs est obligatoire</div>
                                                </mat-error>
                                            </mat-form-field>
        
                                        Modèle
                                            <mat-form-field appearance="outline" class="col-md-5" *ngIf="rs.formName == 'Modèle' && formCreationRisque.get(rs.formName) != undefined">
                                                <mat-label> {{rs.libelle}} </mat-label>
                                                <mat-select formControlName="{{rs.formName}}" (selectionChange)="vehiculeExist = false">
                                                    <ng-container *ngFor="let modele of modeles">
                                                        <mat-option [value]="modele.idParam">
                                                            {{modele.modele}}
                                                        </mat-option>
                                                    </ng-container>
                                                </mat-select>
                                                <mat-error *ngIf="formCreationRisque.get('Modèle').errors"
                                                            class="invalid-feedback">
                                                     <div
                                                    *ngIf="formCreationRisque.get('Modèle').errors?.['required']">
                                                    ce champs est obligatoire</div>
                                                </mat-error>
                                            </mat-form-field>
                                        </ng-container>
                                </ng-container> -->

                                <ng-container *ngFor="let rs of param">
                                    <!--select-->
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="rs.typeChamp?.description=='Liste of values' && (formCreationRisque.get(rs.formName) != undefined || formCreationConducteur.get(rs.formName) != undefined)">
                                        <mat-label>{{rs.libelle}}
                                        </mat-label>
                                        <mat-select [disabled]="rs.readonly"
                                            formControlName="{{rs.formName}}">
                                            <ng-container *ngFor="let
                                                response of
                                                rs.reponses">
                                                <mat-option
                                                    [value]="response.idParam">
                                                    {{response.description}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationRisque.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                    </mat-form-field>

                                    <!--input text -->
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="(rs.typeChamp?.code=='L02'|| rs.typeChamp?.code=='L07')
                                        &&
                                        rs.formName!='Marque'
                                        &&
                                        rs.formName!='Modèle' && (formCreationRisque.get(rs.formName) != undefined || formCreationConducteur.get(rs.formName) != undefined)">
                                        <mat-label>{{rs.libelle}}</mat-label>
                                        <input
                                            type="text"
                                            matInput [disabled]="rs.readonly"
                                            formControlName={{rs.formName}}>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['pattern']
                                            ||
                                            formCreationRisque.get(rs.formName)?.errors?.['maxlength'] || formCreationRisque.get(rs.formName)?.errors?.['minlength'] 
                                            ">
                                            ce champs n'est pas conforme
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationRisque.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                        <ng-container
                                            *ngIf="param[i].category == 'Conducteur'">
                                            <mat-error
                                                class="invalid-feedback"
                                                *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['pattern']
                                            ||
                                            formCreationConducteur.get(rs.formName)?.errors?.['maxlength'] || formCreationConducteur.get(rs.formName)?.errors?.['minlength'] 
                                            ">
                                                ce champs n'est pas conforme
                                            </mat-error>
                                            <mat-error
                                                *ngIf="formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                                {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                            </mat-error>
                                        </ng-container>
                                    </mat-form-field>
                                    <!--input number -->
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="rs.typeChamp?.code=='L03' &&   rs.formName!='Marque'
                                        &&
                                        rs.formName!='Modèle' && (formCreationRisque.get(rs.formName) != undefined || formCreationConducteur.get(rs.formName) != undefined)">
                                        <mat-label>{{rs.libelle}}</mat-label>
                                        <!--FIX ME  pattern="^[1-9]+[0-9]*([.][0-9]*)?$" -->
                                        <input
                                            type="number"
                                            matInput [disabled]="rs.readonly"
                                            formControlName={{rs.formName}}
                                            pattern="^[0-9]+[0-9]*([.][0-9]*)?$">
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['pattern']
                                            ||
                                            formCreationRisque.get(rs.formName)?.errors?.['maxlength'] || formCreationRisque.get(rs.formName)?.errors?.['minlength'] 
                                            ">
                                            ce champs n'est pas conforme
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationRisque.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                        <ng-container
                                            *ngIf="param[i].category == 'Conducteur'">
                                            <mat-error
                                                class="invalid-feedback"
                                                *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['pattern']
                                            ||
                                            formCreationConducteur.get(rs.formName)?.errors?.['maxlength'] || formCreationConducteur.get(rs.formName)?.errors?.['minlength'] 
                                            ">
                                                ce champs n'est pas conforme
                                            </mat-error>
                                            <mat-error
                                                *ngIf="formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                                {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                            </mat-error>
                                        </ng-container>
                                    </mat-form-field>

                                    <!--from table -->
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf=" rs.typeChamp?.code=='L08'  && (formCreationRisque.get(rs.formName) != undefined || formCreationConducteur.get(rs.formName) != undefined)">
                                        <mat-label> {{rs.libelle}}
                                        </mat-label>
                                        <mat-select
                                            formControlName="{{rs.formName}}">
                                            <ng-container *ngFor="let
                                                 response of
                                                 rs.reponses">
                                                <mat-option
                                                    [value]="''+response.id">{{response.description}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationRisque.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                    </mat-form-field>

                                    <!--Date-->
                                    <mat-form-field class="col-md-5"
                                        appearance="outline"
                                        *ngIf="rs.formName!='DateDeNaissance' && rs.typeChamp?.description=='date' && (formCreationRisque?.get(rs.formName) != undefined || formCreationConducteur?.get(rs.formName) != undefined)">
                                        <mat-label>{{rs.libelle}}</mat-label>
                                        <input matInput
                                            [matDatepicker]="picker"
                                            formControlName="{{rs.formName}}"
                                            [disabled]="rs.readonly"
                                            placeholder="">
                                        <mat-datepicker-toggle matSuffix
                                            [for]="picker"></mat-datepicker-toggle>
                                        <mat-datepicker #picker></mat-datepicker>

                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationConducteur && formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                        " class="invalid-feedback">
                                            {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                        <mat-error
                                            class="invalid-feedback"
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.['required']">
                                            ce champs est obligatoire
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationRisque.get(rs.formName)?.errors?.bloquant
                                        " class="invalid-feedback">
                                            {{formCreationRisque.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                    </mat-form-field>

                                    <!--wilaya Délivrance
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="rs.formName=='WilayaDélivrance'&& formCreationConducteur.get(rs.formName) != undefined ">
                                        <mat-label>{{rs.libelle}}
                                        </mat-label>
                                        <mat-select [disabled]="rs.readonly"
                                            formControlName="{{rs.formName}}">
                                            <ng-container
                                                *ngFor="let wilaya of wilayas">
                                                <mat-option
                                                    [value]="''+wilaya.idWilaya">
                                                    {{wilaya.codeWilaya}}.
                                                    {{wilaya.description}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationConducteur.get(rs.formName)?.errors?.['required']"
                                            class="invalid-feedback">
                                            <div> ce champs est obligatoire</div>
                                        </mat-error>
                                        <mat-error
                                            *ngIf="formCreationConducteur.get(rs.formName)?.errors?.bloquant
                                            " class="invalid-feedback">
                                            {{formCreationConducteur.get(rs.formName)?.errors?.msg}}
                                        </mat-error>
                                    </mat-form-field>-->

                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="rs.codeParam == 'P25' && formCreationRisque.get(rs.formName) != undefined">
                                        <mat-label> {{rs.libelle}} </mat-label>
                                        <mat-select
                                            formControlName="{{rs.formName}}"
                                            (selectionChange)="getModeleByMarque($event.value)">
                                            <ng-container
                                                *ngFor="let marque of marques">
                                                <mat-option
                                                    [value]="marque.idParam">
                                                    {{marque.marque}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationRisque.get('Marque').errors"
                                            class="invalid-feedback">
                                            <div
                                            *ngIf="formCreationRisque.get('Marque').errors">
                                            conforme ! </div>
                                            <div
                                                *ngIf="formCreationRisque.get('Marque').errors?.['required']">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>

                                    <!--Modèle-->
                                    <mat-form-field appearance="outline"
                                        class="col-md-5"
                                        *ngIf="rs.codeParam == 'P26' && formCreationRisque.get(rs.formName) != undefined">
                                        <mat-label> {{rs.libelle}} </mat-label>
                                        <mat-select
                                            formControlName="{{rs.formName}}"
                                            (selectionChange)="vehiculeExist = false">
                                            <ng-container
                                                *ngFor="let modele of modeles">
                                                <mat-option
                                                    [value]="modele.idParam">
                                                    {{modele.modele}}
                                                </mat-option>
                                            </ng-container>
                                        </mat-select>
                                        <mat-error
                                            *ngIf="formCreationRisque.get('Modèle').errors"
                                            class="invalid-feedback">
                                            <div
                                                *ngIf="formCreationRisque.get('Modèle').errors?.['required']">
                                                ce champs est obligatoire</div>
                                        </mat-error>
                                    </mat-form-field>
                                </ng-container>
                            </div>
                        </form>
                    </mat-expansion-panel>
                </mat-accordion>
                <div class="row-button">
                    <button matStepperPrevious class="btn btn-cancel">Retour</button>
                    <button (mouseup)="checkDateNaissance(stepper)"
                        class="btn btn-action">Suivant</button>
                </div>
            </ng-container>
            <!-- multirisque param -->
            <ng-template #multirisque>
                <mat-accordion class="main-multirisque">
                    <mat-expansion-panel [expanded]="true"
                        *ngFor="let groupe of devis.groupes; index as i ">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Groupe {{i +1 }}
                            </mat-panel-title>
                            <mat-panel-description>
                                {{groupe.description}}
                            </mat-panel-description>
                        </mat-expansion-panel-header>
                        <table class="gestion-risques">
                            <thead>
                                <tr>

                                    <th
                                        *ngFor="let risque of groupe.risques[0].risque">
                                        {{ risque.colonne }}
                                    </th>
                                    <th>
                                        Action
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- <tr>
                                    <ng-container *ngFor="let risques of groupe.risques">
                                        <td *ngFor="let risque of risques.risque">
                                            {{ risque.valeur }}
                                        </td>
                                    </ng-container>
                                </tr> -->
                                <tr *ngFor="let risque of groupe.risques">

                                    <td *ngFor="let colonne of risque.risque">
                                        {{ colonne.valeur }}
                                    </td>
                                    <td>
                                        <button mat-icon-button
                                            type="button"
                                            [matMenuTriggerFor]="menu"
                                            aria-label="menu risque list">
                                            <mat-icon>more_vert</mat-icon>
                                        </button>
                                        <mat-menu #menu="matMenu"
                                            xPosition="after">
                                            <button mat-menu-item type="button"
                                                (click)="openDialog(risque.idRisque,groupe.idGroupe)">
                                                <mat-icon>zoom_in</mat-icon>
                                                <span>Afficher détails</span>
                                            </button>


                                        </mat-menu>
                                    </td>
                                </tr>
                            </tbody>


                        </table>
                    </mat-expansion-panel>

                </mat-accordion>
                <div class="row-button">
                    <button matStepperPrevious class="btn btn-cancel">Retour</button>
                    <button
                        class="btn btn-action" matStepperNext>Suivant</button>
                </div>
            </ng-template>
        </mat-step>

        <mat-step [editable]="true" *ngIf="devisReady">
            <ng-template matStepLabel>Pack et Garanties</ng-template>
            <mat-accordion class="example-headers-align" multi
                *ngIf="!multiRisque;else multirisque">
                <div class="row"
                    style="display: flex;align-items: center;justify-content: space-between;margin:2rem 1rem">
                    <mat-form-field appearance="outline" class="col-md-5">
                        <mat-label>Pack</mat-label>
                        <mat-select [value]="devis?.groupes[0].pack?.idPack0"
                            [disabled]="true">
                            <ng-container *ngFor="let pack of
                                packs">
                                <mat-option
                                    [value]="pack.idPack0">
                                    {{pack.description}}
                                </mat-option>
                            </ng-container>
                        </mat-select>
                    </mat-form-field>
                </div>
                <table mat-table [dataSource]="dataSourcePack"
                    multiTemplateDataRows
                    class="mat-elevation-z8 pack-table">

                    <!-- description Column -->
                    <ng-container matColumnDef="description">
                        <th mat-header-cell *matHeaderCellDef> Garantie</th>
                        <td mat-cell *matCellDef="let element">
                            {{element.description}}
                        </td>
                    </ng-container>
                    <!-- plafond  Column -->
                    <ng-container matColumnDef="plafond">
                        <th mat-header-cell *matHeaderCellDef> Plafond
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.plafond != '0' ? element.plafond : '-'}}
                        </td>
                    </ng-container>
                    <!-- franchise Column -->
                    <ng-container matColumnDef="franchise">
                        <th mat-header-cell *matHeaderCellDef> Franchise
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.franchise}}
                        </td>
                    </ng-container>
                    <!-- formule Column -->
                    <ng-container matColumnDef="formule">
                        <th mat-header-cell *matHeaderCellDef> Formule
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.formule}}
                        </td>
                    </ng-container>
                    <!-- prime Column -->
                    <ng-container matColumnDef="prime">
                        <th mat-header-cell *matHeaderCellDef> Prime
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{element.prime}}<sup>DA</sup>
                        </td>
                    </ng-container>
                    <!-- Afficher sous garantie  Column -->
                    <ng-container matColumnDef="sousGaranties">
                        <th mat-header-cell *matHeaderCellDef> </th>
                        <td mat-cell *matCellDef="let element"
                            class="example-element-row"
                            [class.example-expanded-row]="expandedElement === element">
                            <button mat-icon-button class="expandButton"
                                *ngIf="element.sousGarantieList.data.length!=0"
                                type="button"
                                aria-label
                                (click)="expandedElement = expandedElement === element ? null : element">
                                <mat-icon>{{expandedElement === element ?
                                    'indeterminate_check_box' :
                                    'add_box'}}</mat-icon>
                            </button>
                        </td>
                    </ng-container>
                    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element"
                            [attr.colspan]="displayedColumnsPack.length">
                            <div class="example-element-detail"
                                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                <table mat-table
                                    [dataSource]="element.sousGarantieList"
                                    class="example-element-diagram pack-table innertable">
                                    <!-- description Column -->
                                    <ng-container matColumnDef="description">
                                        <th mat-header-cell *matHeaderCellDef>
                                            Garantie</th>
                                        <td mat-cell *matCellDef="let element">
                                            {{element.description}}
                                        </td>
                                    </ng-container>
                                    <!-- plafond  Column -->
                                    <ng-container matColumnDef="plafond">
                                        <th mat-header-cell *matHeaderCellDef>
                                            Plafond
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{element.plafond != '0' ?
                                            element.plafond : '-'}}
                                        </td>
                                    </ng-container>
                                    <!-- franchise Column -->
                                    <ng-container matColumnDef="franchise">
                                        <th mat-header-cell *matHeaderCellDef>
                                            Franchise
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{element.franchise}}
                                        </td>
                                    </ng-container>
                                    <!-- formule Column -->
                                    <ng-container matColumnDef="formule">
                                        <th mat-header-cell *matHeaderCellDef>
                                            Formule
                                        </th>
                                        <td mat-cell *matCellDef="let element">
                                            {{element.formule}}
                                        </td>
                                    </ng-container>
                                    <!-- prime Column -->
                                    <ng-container matColumnDef="prime">
                                        <th mat-header-cell *matHeaderCellDef>

                                        </th>
                                        <td mat-cell *matCellDef="let element">

                                        </td>
                                    </ng-container>
                                    <!-- sousGaranties Column -->
                                    <ng-container matColumnDef="sousGaranties">
                                        <th mat-header-cell *matHeaderCellDef>

                                        </th>
                                        <td mat-cell *matCellDef="let element">

                                        </td>
                                    </ng-container>
                                    <tr mat-header-row
                                        *matHeaderRowDef="displayedColumnsPack"></tr>
                                    <tr mat-row
                                        *matRowDef="let row; columns: displayedColumnsPack;"></tr>
                                </table>

                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsPack"></tr>
                    <tr mat-row
                        *matRowDef="let element; columns: displayedColumnsPack;">
                    </tr>
                    <tr mat-row
                        *matRowDef="let row; columns: ['expandedDetail']"
                        class="example-detail-row">
                    </tr>
                </table>
                <div class="row card">
                    <div class="prime-card">
                        <div style="
                        font-size: 21px;
                        color: #00008f;
                        font-weight: 600;">
                            <span style="font-size: 18px;font-weight:
                            600;margin-right:12px">Prime
                                Totale:</span>
                            <span style="float: right;">{{PrimeNette| number :
                                '1.0-0' | money}}
                                <sup>DA</sup></span></div>
                    </div>
                </div>
            </mat-accordion>
            <!-- multirisque pack -->
            <ng-template #multirisque>
                <mat-accordion class="main-multirisque">
                    <mat-expansion-panel [expanded]="true"
                        *ngFor="let groupe of devis.groupes; index as i ">
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                Groupe {{i +1}}
                            </mat-panel-title>
                            <mat-panel-description>
                                {{groupe.description}}
                            </mat-panel-description>
                        </mat-expansion-panel-header>
                        <table class="gestion-risques">
                            <thead>
                                <tr>

                                    <th>Garantie </th>
                                    <th> Prime </th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr *ngFor="let garantie of groupe.garantieList">

                                    <td>
                                        {{garantie.description}}
                                    </td>
                                    <td>
                                        {{garantie.prime}}
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </mat-expansion-panel>

                </mat-accordion>
            </ng-template>
            <div class="row-button">
                <button matStepperPrevious class="btn btn-cancel">Retour</button>
                <button matStepperNext class="btn btn-action">Suivant</button>
            </div>
        </mat-step>

        <!-- ********** reduction   **********-->
        <mat-step [editable]="true">
            <ng-template matStepLabel>Réduction</ng-template>
            <form [formGroup]="formReduction"
                class="row" *ngIf="formReduction">
                <mat-form-field class="col-md-5" appearance="outline">
                    <mat-label> Convention</mat-label>
                    <input matInput formControlName="convention" >
                    <!-- <mat-select formControlName="convention" [disabled]="true">
                        <mat-option
                            [value]="'aucuneConvention'">
                            Aucune Convention
                        </mat-option>
                        <ng-container
                            *ngFor="let convention of conventions">

                            <mat-option
                                [value]="convention.idConvention">
                                {{convention.nomConvention}}
                            </mat-option>
                        </ng-container>
                    </mat-select> -->
                </mat-form-field>
                <mat-form-field class="col-md-5" appearance="outline">
                    <mat-label> Réduction</mat-label>
              
                    <input matInput formControlName="reduction" >
                  
                    <!-- <mat-select formControlName="reduction" [disabled]="true">
                        <mat-option [value]="'aucuneReduction'"> Aucune
                            Reduction </mat-option>
                        <ng-container
                            *ngFor="let reduction of reductions">
                            <mat-option
                                [value]="reduction.idReduction">
                                {{reduction.nomReduction}}
                            </mat-option>
                        </ng-container>
                    </mat-select> -->
                </mat-form-field>
                <div class>
                    <button class="btn btn-action" matStepperNext>
                        <span>Suivant</span></button>
                    <button class="btn btn-cancel" matStepperPrevious
                        type="button">Retour</button>
                </div>
            </form>
        </mat-step>

        <mat-step [editable]="true">
            <ng-template matStepLabel>Résumé</ng-template>
            <mat-accordion class="example-headers-align" multi>
                <table class="resume">
                    <tr *ngFor="let element of devis?.primeList">
                        <ng-container *ngIf="element.typePrime.idParam==101">
                            <td class="primeTotale">{{element.typePrime.description}}</td>
                            <td class="primeTotale">{{element.prime | number :
                                '1.0-0' | money}} <sup>DZD</sup></td>
                        </ng-container>
                    </tr>

                    <tr *ngFor="let element of devis?.taxeList">
                        <td>{{element.taxe?.description}}</td>
                        <td>{{element.prime| number :
                            '1.0-0' | money}} <sup>DZD</sup></td>
                    </tr>

                    <td>Prime Totale</td>
                    <td>{{PrimeTotale| number :
                        '1.0-0' | money}}<sup>DZD</sup></td>
                </table>
            </mat-accordion>
            <div class="row-button">
                <button matStepperPrevious class="btn btn-cancel">Retour</button>
                <button class="btn btn-action" (click)="submitContrat()">
                    <mat-spinner color="white" diameter=30 *ngIf="valider"></mat-spinner>
                    <span *ngIf="!valider"> Valider </span>
                </button>
            </div>
        </mat-step>
    </mat-stepper>
</div>