<div class="container ">
    <div class="header">
        <h2 class="title-table">Listes des polices {{nomProduit}}</h2>
    </div>
    <div class="filtre">
        <form #formDirective="ngForm" [formGroup]="formFilterContrat"
            class="row
            formFiltre"
            (ngSubmit)="submitFilter(0,10)">

            <div class="row">
                <!--num contrat-->
                <mat-form-field appearance="outline"
                    class="col-md-4">
                    <mat-label>N° Police</mat-label>
                    <input type="text" matInput placeholder
                        formControlName="idContrat">
                </mat-form-field>
                <!--nom client contrat-->
                <mat-form-field appearance="outline"
                    class="col-md-4">
                    <mat-label>Nom</mat-label>
                    <input type="text" matInput placeholder
                        formControlName="nom">
                </mat-form-field>
                <!--raison contrat-->
                <mat-form-field appearance="outline"
                    class="col-md-4">
                    <mat-label>Raison Sociale</mat-label>
                    <input type="text" matInput placeholder
                        formControlName="raisonSocial">
                </mat-form-field>
            </div>
            <div class="row">
                <!-- agence-->
                <mat-form-field class="col-md-4"
                    appearance="outline">
                    <mat-label>Agence</mat-label>
                    <mat-select formControlName="agence">
                        <ng-container *ngFor="let agence of agences">
                            <mat-option [value]="agence.idAgence">
                                {{agence.nomAgence}}
                            </mat-option>
                        </ng-container>
                    </mat-select>
                </mat-form-field>
                <!-- date du  -->
                <mat-form-field class="col-md-4"
                    appearance="outline">
                    <mat-label>Du </mat-label>
                    <input matInput
                        [matDatepicker]="pickerDu"
                        formControlName="dateDebut">
                    <mat-datepicker-toggle matSuffix
                        [for]="pickerDu"></mat-datepicker-toggle>
                    <mat-datepicker #pickerDu></mat-datepicker>
                </mat-form-field>
                <!-- date au  -->
                <mat-form-field class="col-md-4"
                    appearance="outline">
                    <mat-label>Au </mat-label>
                    <input matInput
                        [matDatepicker]="pickerAu"
                        formControlName="dateFin">
                    <mat-datepicker-toggle matSuffix
                        [for]="pickerAu"></mat-datepicker-toggle>
                    <mat-datepicker #pickerAu></mat-datepicker>
                </mat-form-field>
            </div>
            <div class="row buttons">
                <button class="btn btn-action" type="submit">Filtrer</button>
                <mat-icon class="material-symbols-outlined"
                    (click)="resetTable(formDirective)"
                    matTooltip="Rénitialisation"
                    matTooltipPosition="right">restart_alt</mat-icon>
            </div>

        </form>
    </div>
    <div class="alert alert-danger"
        *ngIf="errorHandler.error">{{errorHandler.msg}}</div>
    <table mat-table [dataSource]="dataSource" class="
        contrat-table"  *ngIf="dataSource.data.length!=0">

        <!-- N°Police Column -->
        <ng-container matColumnDef="N°Police">
            <th mat-header-cell *matHeaderCellDef> N°. </th>
            <td mat-cell *matCellDef="let element"> {{element.idContrat}} </td>
        </ng-container>
        <!-- dateEffet Column -->
        <ng-container matColumnDef="dateEffet">
            <th mat-header-cell *matHeaderCellDef> Date d'effet </th>
            <td mat-cell *matCellDef="let element"> {{element.dateEffet |
                dateFormatPipe}} </td>
        </ng-container>
        <!-- agence Column -->
        <ng-container matColumnDef="agence">
            <th mat-header-cell *matHeaderCellDef> Agence </th>
            <td mat-cell *matCellDef="let element"> {{element.agence}} </td>
        </ng-container>
        <!-- nom raison social Column -->
        <ng-container matColumnDef="raisonSocialOuNom">

            <th mat-header-cell *matHeaderCellDef> Nom ou Raison sociale</th>
            <td mat-cell *matCellDef="let element">
                <ng-container *ngIf="element.raisonSocial==null;else
                    personneMoral">{{element?.nom | slice:0:50 }}
                    {{element?.prenom | slice:0:50}}</ng-container>
                <ng-template #personneMoral>{{element?.raisonSocial |
                    slice:0:50}}
                </ng-template>
            </td>
        </ng-container>
        <!-- status Column -->
        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Statut </th>
            <td mat-cell *matCellDef="let element">
                <mat-chip-list aria-label="Fish selection">
                    <mat-chip [style]="(element.statut.idParam | statutColor)"
                        color="primary">
                        {{ element.statut.description }}
                    </mat-chip>
                </mat-chip-list>
            </td>
        </ng-container>
        <!-- Action Column -->
        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef> Action </th>

            <td mat-cell *matCellDef="let element">
                <button mat-icon-button
                    type="button"
                    [matMenuTriggerFor]="menu"
                    aria-label="menu contrat list">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu"
                    xPosition="after"
                    class="menu-contrat">
                    <button mat-menu-item
                        (click)="printContrat(element.idContrat)"
                        type="button">
                        <mat-icon>print</mat-icon>
                        <span>Imprimer contrat</span>
                    </button>
                    <button mat-menu-item
                        (click)="consultContrat(element.idContrat)"
                        type="button">
                        <mat-icon>zoom_in</mat-icon>
                        <span>Consulter police</span>
                    </button>
                    <button mat-menu-item
                        (click)="avenant(element.idContrat)"
                        type="button">
                        <mat-icon>edit</mat-icon>
                        <span>Avenant</span>
                    </button>

                    <button mat-menu-item
                    (click)="ExtraireFichierExcel(element.idContrat)"
                    type="button">
                    <mat-icon>save_alt</mat-icon>
                    <span>Extraire Données</span>
                </button>


                    <button mat-menu-item
                     *ngIf="codeProduit=='45F'||codeProduit=='45L'"
                    (click)="ExtraireFichierExcel(element.idContrat)"
                    type="button">
                    <mat-icon>save_alt</mat-icon>
                    <span>Extraire Données</span>
                </button>

                </mat-menu>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"
            class="example-second-header-row">
        </tr>

        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
    <!-- <mat-paginator [pageSize]="10" [pageSizeOptions]="[5, 10,50]"
        aria-label="Select page of users"></mat-paginator> -->
    <mat-paginator  [length]="lengthElement"
         [pageSize]="10" *ngIf="dataSource.data.length!=0"
        (page)="onPageChange($event)">
        
    </mat-paginator>

</div>